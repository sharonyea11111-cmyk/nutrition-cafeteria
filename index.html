<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平衡膳食自助食堂</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        /* 莫兰迪色系配色方案 */
        :root {
            --morandi-sage: #9CAF88;
            --morandi-dusty-rose: #D4A5A5;
            --morandi-warm-gray: #C7B299;
            --morandi-soft-blue: #A8B8D8;
            --morandi-muted-purple: #B8A9C9;
            --morandi-cream: #F5F1E8;
            --morandi-taupe: #D6C7B8;
            --morandi-soft-green: #B8C5A6;
            --text-primary: #5A5A5A;
            --text-secondary: #8A8A8A;
            --background-light: #FAFAF9;
            --border-light: #E8E6E1;
            
            /* 补充缺失的颜色变量 */
            --morandi-sage-green: #9CAF88;
            --morandi-warm-orange: #E6A85C;
            --morandi-light-gray: #F0F0F0;
            --morandi-soft-white: #FEFEFE;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--background-light) 0%, var(--morandi-cream) 100%);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 头部样式 */
        .header {
            background: linear-gradient(135deg, var(--morandi-soft-blue) 0%, var(--morandi-muted-purple) 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(168, 184, 216, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* 预算选择器 */
        .budget-selector {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
        }

        .budget-selector h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .budget-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .budget-option {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            border: 2px solid var(--morandi-warm-gray);
            border-radius: 12px;
            background: var(--morandi-cream);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .budget-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(199, 178, 153, 0.3);
        }

        .budget-option.active {
            background: var(--morandi-soft-blue);
            color: white;
            border-color: var(--morandi-soft-blue);
        }

        /* 主要内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            max-width: 100%;
            overflow: hidden;
        }

        /* 菜品区域 */
        .menu-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
            min-width: 0;
            overflow: hidden;
        }

        .menu-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 12px 20px;
            border: 2px solid var(--morandi-sage);
            border-radius: 25px;
            background: var(--morandi-cream);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-primary);
        }

        .category-tab:hover {
            background: var(--morandi-sage);
            color: white;
        }

        .category-tab.active {
            background: var(--morandi-sage);
            color: white;
        }

        /* 精品自助小厨房选菜区分类标签特定样式 */
        #custom-kitchen-section .menu-categories .category-tab {
            font-size: 0.85rem;
            padding: 10px 16px;
            white-space: nowrap;
            min-width: auto;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 100%;
        }

        .dish-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .top20-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        /* 食材卡片专用样式 */
        .ingredient-card {
            border-left: 4px solid var(--morandi-soft-green);
            background: linear-gradient(135deg, #f8fffe 0%, #f0fdf4 100%);
        }

        .ingredient-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .ingredient-category {
            margin: 8px 0;
            padding: 4px 8px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--morandi-soft-green);
        }

        .category-label {
            font-size: 11px;
            color: #059669;
            font-weight: 600;
        }

        .vitamin-highlights, .mineral-highlights {
            margin: 10px 0;
        }

        .vitamin-highlights h5, .mineral-highlights h5 {
            font-size: 11px;
            margin: 0 0 6px 0;
            color: #333;
            font-weight: 600;
        }

        .highlights-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .highlight-tag {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }

        .highlight-tag.vitamin {
            background: linear-gradient(135deg, #fef3c7, #fbbf24);
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .highlight-tag.mineral {
            background: linear-gradient(135deg, #e0e7ff, #8b5cf6);
            color: #5b21b6;
            border: 1px solid #7c3aed;
        }

        .dish-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--morandi-dusty-rose);
        }

        .dish-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .dish-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--morandi-dusty-rose);
            margin-bottom: 15px;
        }

        .nutrition-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nutrition-item {
            display: flex;
            justify-content: space-between;
        }

        .macronutrients {
            margin-top: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 11px;
        }

        .macro-title {
            margin: 0 0 8px 0;
            font-size: 12px;
            font-weight: 600;
            color: #333;
        }

        .macro-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            color: #555;
        }

        .macro-label {
            font-weight: 500;
        }

        .macro-value {
            color: #007bff;
            font-weight: 600;
        }

        .add-btn {
            width: 100%;
            padding: 10px;
            background: var(--morandi-soft-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
        }

        .add-btn:hover:not(:disabled) {
            background: var(--morandi-sage);
            transform: translateY(-1px);
        }

        .add-btn.budget-insufficient {
            background: #e74c3c;
            cursor: not-allowed;
        }

        .add-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .add-btn .add-icon {
            font-size: 16px;
            font-weight: bold;
        }

        .add-btn .add-text {
            font-size: 13px;
            font-weight: 500;
        }

        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            gap: 10px;
        }

        /* 菜品网格下方的分页控件样式 */
        #custom-kitchen-section .pagination-container {
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid #e8f5e8;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 40px;
            text-align: center;
        }

        .pagination-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
            color: #007bff;
        }

        .pagination-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination-btn:disabled {
            background: #f8f9fa;
            color: #ccc;
            border-color: #eee;
            cursor: not-allowed;
        }

        .pagination-btn:disabled:hover {
            background: #f8f9fa;
            color: #ccc;
            border-color: #eee;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 300px;
                gap: 20px;
            }
        }

        /* 平板设备 (768px - 992px) - 保持双列布局 */
        @media (max-width: 992px) and (min-width: 769px) {
            .main-content {
                grid-template-columns: 1fr 280px;
                gap: 16px;
            }
            
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .sidebar {
                gap: 12px;
            }
            
            .nutrition-panel, .cart-panel, .oil-salt-panel {
                padding: 16px;
            }
            
            .dish-card {
                padding: 16px;
            }
        }

        /* 手机设备 (768px及以下) - 单列布局 */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 15px;
            }
            
            .menu-section {
                padding: 15px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .budget-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .budget-option {
                min-width: auto;
            }
        }

        /* 侧边栏 */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .nutrition-panel, .cart-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
        }
        
        .nutrition-panel {
            max-height: 600px;
            overflow-y: auto;
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 营养进度条 */
        .nutrition-progress {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--border-light);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--morandi-soft-green), var(--morandi-sage));
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        /* 购物车 */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .cart-item-price {
            color: var(--morandi-dusty-rose);
            font-size: 0.9rem;
        }

        .meal-tags {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .meal-tags::before {
            content: '';
            display: block;
            width: 100%;
        }

        .meal-tags {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: var(--morandi-cream);
            padding: 2px 6px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            display: inline-block;
            margin-top: 4px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            width: 24px;
            height: 24px;
            border: 1px solid var(--morandi-warm-gray);
            background: var(--morandi-cream);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .quantity-btn:hover {
            background: var(--morandi-warm-gray);
            color: white;
        }

        .cart-total {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border-light);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
        }

        /* 油盐摄入量显示栏样式 */
        .oil-salt-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
            margin-bottom: 16px;
        }

        .oil-salt-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .intake-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .intake-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .intake-label {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .intake-recommendation {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--morandi-cream);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--border-light);
        }

        .intake-progress {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .intake-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .intake-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .oil-progress {
            background: linear-gradient(90deg, var(--morandi-warm-orange), #E6A85C);
        }

        .salt-progress {
            background: linear-gradient(90deg, var(--morandi-soft-blue), #A8B8D8);
        }

        /* 视觉提示颜色 */
        .oil-progress.warning {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .oil-progress.danger {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .salt-progress.warning {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .salt-progress.danger {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .intake-value {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .intake-value span:first-child {
            font-weight: 600;
            color: var(--text-primary);
        }

        .intake-target {
            color: var(--text-secondary);
        }

        /* 图表容器 */
        .chart-container {
            width: 100%;
            height: 150px;
            margin-top: 12px;
            margin-bottom: 6px;
        }

        /* 图例样式 */
        .chart-legend {
            margin-top: 6px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            border: 1px solid var(--border-light);
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .legend-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-light);
        }

        .legend-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .baseline-note {
            font-size: 12px;
            color: var(--morandi-taupe);
            background: rgba(214, 199, 184, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 6px;
            border-radius: 4px;
            background: rgba(248, 248, 248, 0.5);
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            background: rgba(139, 125, 107, 0.1);
            transform: translateX(2px);
        }

        .legend-item-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .legend-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .legend-value {
            font-size: 12px;
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .legend-percentage {
            font-size: 11px;
            color: var(--morandi-taupe);
            margin-left: 4px;
            font-family: 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        /* 新的图表样式 */
        .chart-row {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .chart-item {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid var(--border-light);
        }

        .chart-item canvas {
            width: 100% !important;
            height: 120px !important;
        }

        /* 响应式图表布局 */
        @media (max-width: 768px) {
            .chart-row {
                flex-direction: column;
            }
            
            .chart-item canvas {
                height: 200px !important;
            }
            
            .chart-container {
                height: 120px;
                margin-top: 8px;
                margin-bottom: 4px;
            }
            
            .chart-legend {
                margin-top: 4px;
                padding: 6px;
            }
            
            .legend-header {
                margin-bottom: 4px;
                padding-bottom: 3px;
            }
            
            .legend-items {
                gap: 2px;
            }
            
            .legend-item {
                padding: 2px 3px;
            }
            
            .nutrition-panel {
                max-height: 400px;
                padding: 16px;
            }
            
            .cart-panel {
                padding: 16px;
            }
            
            .panel-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            
            .sidebar {
                gap: 12px;
            }
        }

        /* 预算进度表组件样式 */
        .budget-progress-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
            font-family: 'Source Han Sans CN', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .budget-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .progress-stats {
            display: flex;
            gap: 24px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .budget-progress-bar {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .progress-track {
            flex: 1;
            height: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #a8b8d8 0%, #c7b299 50%, #d4a574 100%);
            border-radius: 6px;
            transition: width 0.3s ease, background-color 0.3s ease;
            position: relative;
        }

        .progress-fill.safe {
            background: linear-gradient(90deg, #a8b8d8 0%, #9bb5d1 100%);
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #c7b299 0%, #d4a574 100%);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #d4a574 0%, #e8b4a0 100%);
        }

        .progress-percentage {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 48px;
            text-align: right;
        }

        .progress-indicators {
            display: flex;
            justify-content: center;
            gap: 32px;
        }

        .indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .indicator.safe .indicator-dot {
            background: #a8b8d8;
        }

        .indicator.warning .indicator-dot {
            background: #c7b299;
        }

        .indicator.danger .indicator-dot {
            background: #d4a574;
        }

        .indicator-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* 合并预算边栏组件样式 */
        .budget-sidebar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
            font-family: 'Source Han Sans CN', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 紧凑预算选择器 */
        .budget-selector-compact {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-light);
        }

        .budget-options-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .budget-option-compact {
            padding: 12px 16px;
            border: 2px solid var(--morandi-warm-gray);
            border-radius: 8px;
            background: var(--morandi-cream);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
        }

        .budget-option-compact:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(199, 178, 153, 0.3);
        }

        .budget-option-compact.active {
            background: var(--morandi-soft-blue);
            color: white;
            border-color: var(--morandi-soft-blue);
        }

        .budget-label {
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .budget-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* 紧凑预算使用情况 */

        .usage-stats {
            margin-bottom: 16px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-row .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-row .stat-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        /* 紧凑进度条 */
        .progress-bar-compact {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .progress-bar-compact .progress-track {
            flex: 1;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-compact .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #a8b8d8 0%, #c7b299 50%, #d4a574 100%);
            border-radius: 4px;
            transition: width 0.3s ease, background-color 0.3s ease;
            position: relative;
        }

        .progress-bar-compact .progress-percentage {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 36px;
            text-align: right;
        }

        /* 紧凑图例 */
        .progress-legend {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .legend-item.safe .legend-dot {
            background: #a8b8d8;
        }

        .legend-item.warning .legend-dot {
            background: #c7b299;
        }

        .legend-item.danger .legend-dot {
            background: #d4a574;
        }

        .legend-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .budget-progress-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .progress-stats {
                justify-content: space-around;
            }

            .progress-indicators {
                flex-direction: column;
                gap: 8px;
                align-items: center;
            }

            .budget-options-compact {
                grid-template-columns: 1fr;
            }

            .progress-legend {
                flex-direction: column;
                gap: 6px;
            }
        }

        /* 响应式设计 - 仅对手机设备应用单列布局 */
        @media (max-width: 768px) {
            .sidebar {
                order: -1;
            }
        }
        
        @media (max-width: 900px) {
             .chart-container {
                 height: 140px;
             }
             
             .nutrition-panel {
                 max-height: 500px;
                 padding: 18px;
             }
             
             .cart-panel {
                 padding: 18px;
             }
             
             .sidebar {
                 gap: 14px;
             }
         }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .budget-options {
                flex-direction: column;
            }
        }



        /* 建议面板 */
        .suggestions-panel {
            background: linear-gradient(135deg, var(--morandi-dusty-rose), var(--morandi-muted-purple));
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .suggestion-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        /* 膳食指导提示框 */
        .dietary-guide-box {
            background: linear-gradient(135deg, var(--morandi-cream) 0%, var(--morandi-soft-white) 100%);
            border: 2px solid var(--morandi-warm-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(199, 178, 153, 0.2);
            position: relative;
            overflow: hidden;
        }

        .dietary-guide-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--morandi-sage) 0%, var(--morandi-soft-blue) 50%, var(--morandi-dusty-rose) 100%);
        }

        .dietary-guide-title {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dietary-guide-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            color: var(--text-primary);
        }

        .guide-item {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 12px 15px;
            border-left: 4px solid var(--morandi-sage);
            transition: all 0.3s ease;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
        }

        .guide-item:nth-child(2) {
            border-left-color: var(--morandi-soft-blue);
        }

        .guide-item:nth-child(3) {
            border-left-color: var(--morandi-dusty-rose);
        }

        .guide-item:nth-child(4) {
            border-left-color: var(--morandi-warm-gray);
        }

        .guide-item:nth-child(5) {
            border-left-color: var(--morandi-muted-purple);
        }

        .guide-item:nth-child(6) {
            border-left-color: var(--morandi-taupe);
        }

        .guide-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.9);
        }

        .guide-emoji {
            font-size: 1.2rem;
            margin-right: 6px;
        }

        @media (max-width: 768px) {
            .dietary-guide-content {
                grid-template-columns: 1fr;
            }
            
            .guide-item {
                font-size: 0.9rem;
                padding: 10px 12px;
            }
        }

        /* 保存分享按钮 */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: var(--morandi-soft-blue);
            color: white;
        }

        .share-btn {
            background: var(--morandi-muted-purple);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .export-section {
            flex: 1;
            position: relative;
        }

        .export-btn.primary {
            background: var(--morandi-warm-gray);
            color: white;
            width: 100%;
            font-size: 1rem;
            text-align: center;
            white-space: nowrap;
            overflow: visible;
            min-width: 180px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .export-btn.primary:hover {
            background: var(--morandi-taupe);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .export-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            margin-top: 4px;
            padding: 12px;
        }

        .format-selector label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .format-buttons {
            display: flex;
            gap: 8px;
        }

        .format-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--morandi-warm-orange);
            background: white;
            color: var(--morandi-warm-orange);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .format-btn:hover {
             background: var(--morandi-warm-orange);
             color: white;
         }

         /* 响应式设计 - 导出功能 */
         @media (max-width: 768px) {
             .export-options {
                 position: static;
                 margin-top: 8px;
                 box-shadow: none;
                 border: 1px solid #e0e0e0;
             }

             .format-buttons {
                 flex-direction: column;
                 gap: 6px;
             }



             .action-buttons {
                 flex-direction: column;
                 gap: 8px;
             }

             .export-section {
                 width: 100%;
             }
         }

         @media (max-width: 480px) {
             .export-btn.primary {
                 font-size: 0.9rem;
                 padding: 10px;
             }

             .format-selector label {
                 font-size: 0.85rem;
             }
         }

         /* 无障碍访问 - 屏幕阅读器专用 */
          .sr-only {
              position: absolute;
              width: 1px;
              height: 1px;
              padding: 0;
              margin: -1px;
              overflow: hidden;
              clip: rect(0, 0, 0, 0);
              white-space: nowrap;
              border: 0;
          }

          /* 焦点可见性增强 */
           .format-btn:focus,
           .action-btn:focus,
           #nutritionBarChart:focus,
           .legend-item:focus {
               outline: 2px solid var(--morandi-warm-orange);
               outline-offset: 2px;
           }

           /* 图例项焦点状态 */
        .legend-item:focus {
            background-color: rgba(255, 107, 53, 0.1);
            border-radius: 4px;
        }

        /* 能量进度条样式 */
        .energy-progress-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--morandi-soft-white);
            border-radius: 8px;
            border: 1px solid var(--morandi-light-gray);
        }

        .energy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .energy-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .energy-value {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .energy-progress-bar {
            width: 100%;
            height: 12px;
            background-color: var(--morandi-light-gray);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .energy-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--morandi-sage-green), var(--morandi-warm-orange));
            border-radius: 6px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .energy-progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .energy-progress-fill.safe {
            background: linear-gradient(90deg, var(--morandi-sage-green), #4CAF50);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }

        .energy-progress-fill.warning {
            background: linear-gradient(90deg, #FFA726, var(--morandi-warm-orange));
            box-shadow: 0 0 10px rgba(255, 167, 38, 0.3);
        }

        .energy-progress-fill.danger {
            background: linear-gradient(90deg, #FF5722, #F44336);
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
        }

        .energy-percentage {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* 三餐监控样式 */
        .meal-monitoring-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--morandi-soft-white);
            border-radius: 8px;
            border: 1px solid var(--morandi-light-gray);
        }

        .meal-monitoring-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 15px 0;
            text-align: center;
        }

        .meal-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            background: var(--morandi-light-gray);
            border-radius: 6px;
            padding: 3px;
        }

        .meal-tab {
            flex: 1;
            padding: 8px 6px;
            border: none;
            background: transparent;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .meal-tab.active {
            background: var(--morandi-sage-green);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .meal-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.7);
            color: var(--text-primary);
        }

        .meal-details {
            position: relative;
            min-height: 80px;
        }

        .meal-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .meal-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .meal-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .meal-target {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .meal-progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--morandi-light-gray);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .meal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--morandi-sage-green), var(--morandi-warm-orange));
            border-radius: 5px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .meal-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meal-current {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .meal-percentage {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .meal-summary {
            background: var(--morandi-light-gray);
            border-radius: 6px;
            padding: 12px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0 4px 0;
            margin-top: 8px;
            border-top: 2px solid var(--morandi-sage-green);
            font-weight: 600;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        .summary-value {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .summary-total .summary-value {
            color: var(--morandi-sage-green);
            font-weight: 600;
        }

        .current-meal-display {
            margin-top: 15px;
            padding: 10px;
            background: var(--morandi-light-gray);
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .current-meal-label {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .current-meal-value {
            padding: 4px 8px;
            border: 1px solid var(--morandi-sage-green);
            border-radius: 4px;
            background: var(--morandi-sage-green);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .meal-hint {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* 营养条形图样式 */
        .nutrition-bars-container {
            margin-top: 15px;
            padding: 15px;
            background: var(--morandi-soft-white);
            border-radius: 8px;
            border: 1px solid var(--morandi-light-gray);
        }

        .nutrition-bars-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 15px 0;
            text-align: center;
        }

        .nutrition-bar-item {
            margin-bottom: 12px;
        }

        .nutrition-bar-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .nutrition-name {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .nutrition-value {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .nutrition-bar-track {
            width: 100%;
            height: 10px;
            background-color: var(--morandi-light-gray);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 2px;
        }

        .nutrition-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.4s ease;
            position: relative;
        }

        .nutrition-bar-percentage {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: right;
            font-weight: 500;
        }

        .empty-state {
             text-align: center;
             color: var(--text-secondary);
             font-size: 0.85rem;
             margin: 20px 0;
             font-style: italic;
         }

        /* 大分类选择器样式 */
        .main-category-selector {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--border-light);
        }

        .main-category-title {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
            font-weight: 700;
        }

        .main-category-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .main-category-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            background: var(--morandi-cream);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .main-category-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .main-category-option.active {
            background: var(--morandi-soft-blue);
            color: white;
            border-color: var(--morandi-soft-blue);
        }

        .category-icon {
            font-size: 2.5rem;
            line-height: 1;
        }

        .category-info h4 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .category-info p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* 分类区域样式 */
        .category-section {
            display: none;
        }

        .category-section.active {
            display: block;
        }

        /* 精品自助小厨房样式 */
        .ingredient-selection, .cooking-method-selection, .beverage-selection {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 烹调方式样式 */
        .cooking-methods {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cooking-category {
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 15px;
            background: var(--background-light);
        }

        .cooking-category-title {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cooking-subcategories {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cooking-subcategory {
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border-light);
        }

        .subcategory-title {
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .cooking-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .cooking-method {
            padding: 8px 12px;
            background: var(--morandi-cream);
            border: 1px solid var(--morandi-warm-gray);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .cooking-method:hover {
            background: var(--morandi-soft-green);
            color: white;
            transform: translateY(-1px);
        }

        .cooking-method.selected {
            background: var(--morandi-sage);
            color: white;
            border-color: var(--morandi-sage);
        }

        .safety-note {
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--morandi-dusty-rose);
            font-style: italic;
            text-align: center;
        }

        /* 小厨房板块样式 */
        .kitchen-section {
            background: var(--morandi-cream);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--morandi-warm-gray);
        }

        .subsection-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--morandi-charcoal);
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selected-ingredients {
            margin-bottom: 20px;
        }

        .ingredients-list {
            min-height: 80px;
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--morandi-warm-gray);
        }

        .empty-kitchen {
            text-align: center;
            color: var(--morandi-warm-gray);
            font-style: italic;
            padding: 20px;
        }

        .kitchen-ingredient-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--morandi-cream);
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid var(--morandi-warm-gray);
        }

        .ingredient-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ingredient-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: var(--morandi-sage);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            background: var(--morandi-dusty-rose);
            transform: scale(1.1);
        }

        .cooking-method-selection {
            margin-bottom: 20px;
        }

        .cooking-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cooking-category-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--morandi-sage);
            margin-bottom: 8px;
            padding-left: 5px;
            border-left: 3px solid var(--morandi-sage);
        }

        .cooking-method {
            background: var(--morandi-cream);
            border: 2px solid var(--morandi-warm-gray);
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .cooking-method:hover {
            background: var(--morandi-soft-blue);
            color: white;
            transform: translateY(-2px);
        }

        .cooking-method.active {
            background: var(--morandi-sage);
            color: white;
            border-color: var(--morandi-sage);
        }

        /* 营养预览区域样式 */
        .nutrition-preview {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid var(--morandi-soft-green);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .nutrition-preview-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .nutrition-preview .nutrition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--morandi-cream);
            border-radius: 6px;
            border: 1px solid var(--morandi-warm-gray);
        }

        .nutrition-preview .nutrition-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--morandi-charcoal);
        }

        .nutrition-preview .nutrition-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--morandi-sage);
        }

        .synthesis-section {
            text-align: center;
        }

        .synthesize-btn {
            background: linear-gradient(135deg, var(--morandi-sage), var(--morandi-soft-blue));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .synthesize-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .synthesize-btn:disabled {
            background: var(--morandi-warm-gray);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .synthesis-note {
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--morandi-warm-gray);
            font-style: italic;
        }

        /* 食材分类过滤栏样式 */
        .ingredient-category-filter {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--morandi-cream);
            border-radius: 12px;
            border: 1px solid var(--morandi-warm-gray);
        }

        .filter-title {
            margin: 0 0 12px 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--morandi-sage);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ingredient-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .ingredient-category-tab {
            background: white;
            border: 2px solid var(--morandi-warm-gray);
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            min-height: 60px;
            justify-content: center;
        }

        .ingredient-category-tab:hover {
            background: var(--morandi-soft-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .ingredient-category-tab.active {
            background: var(--morandi-sage);
            color: white;
            border-color: var(--morandi-sage);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .category-emoji {
            font-size: 1.2rem;
            line-height: 1;
        }

        .category-name {
            font-size: 0.85rem;
            font-weight: 500;
            line-height: 1;
        }

        /* 烹调方式工具提示 */
        .cooking-method[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .cooking-method {
            position: relative;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-category-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .main-category-option {
                padding: 15px;
                gap: 12px;
            }

            .category-icon {
                font-size: 2rem;
            }

            .cooking-methods-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 6px;
            }

            .cooking-method {
                padding: 6px 8px;
                font-size: 0.8rem;
            }

            .cooking-subcategories {
                gap: 10px;
            }

            .cooking-subcategory {
                padding: 8px;
            }

            .beverage-categories {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
            }

            .beverage-categories .category-tab {
                padding: 10px 12px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1>🍽️ 平衡膳食自助食堂</h1>
            <p>科学搭配，健康生活 - 让每一餐都营养均衡</p>
        </header>



        <div class="main-content">
            <!-- 菜品选择区域 -->
            <div class="menu-section">
                <!-- 大分类选择器 -->
                <div class="main-category-selector">
                    <h3 class="main-category-title">🍽️ 选择用餐方式</h3>
                    <div class="main-category-options">
                        <div class="main-category-option active" data-main-category="ready-meals">
                            <div class="category-icon">🍱</div>
                            <div class="category-info">
                                <h4>成品大锅菜</h4>
                                <p>精选现成菜品，快速便捷</p>
                            </div>
                        </div>
                        <div class="main-category-option" data-main-category="custom-kitchen">
                            <div class="category-icon">👨‍🍳</div>
                            <div class="category-info">
                                <h4>精品自助小厨房</h4>
                                <p>自选食材，个性化烹调</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 成品大锅菜区域 -->
                <div id="ready-meals-section" class="category-section active">

                    <!-- 成品菜分类标签 -->
                    <div id="ready-category-tabs" class="menu-categories">
                        <div class="category-tab active" data-category="all">🍽️ 全部</div>
                    <div class="category-tab" data-category="top20">🏆 Top20</div>
                    <div class="category-tab" data-category="staple">🍚 主食</div>
                    <div class="category-tab" data-category="main">🍖 主菜</div>
                    <div class="category-tab" data-category="side">🥬 配菜</div>
                    <div class="category-tab" data-category="soup">🍲 汤品</div>
                    <div class="category-tab" data-category="drinks">🥤 饮品</div>
                    <div class="category-tab" data-category="snacks">🍿 小吃</div>
                    </div>

                    <!-- 菜品网格 -->
                    <div class="menu-grid" id="readyMealsGrid">
                        <!-- 菜品将通过JavaScript动态生成 -->
                    </div>

                    <!-- 分页控制 -->
                    <div class="pagination-container">
                        <div class="pagination" id="pagination">
                            <!-- 分页按钮将通过JavaScript动态生成 -->
                        </div>
                    </div>

                </div>

                <!-- 精品自助小厨房区域 -->
                <div id="custom-kitchen-section" class="category-section">
                    <!-- 选菜区 -->
                    <div class="ingredient-selection">
                        <h4 class="section-title">🥬 选菜区</h4>
                        
                        <!-- 食材分类标签 -->
                        <div id="ingredient-category-tabs" class="menu-categories">
                            <!-- 食材分类按钮将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 菜品网格 -->
                    <div class="menu-grid" id="menuGrid">
                        <!-- 菜品将通过JavaScript动态生成 -->
                    </div>

                    <!-- 分页控制 -->
                    <div id="customKitchenPagination" class="pagination-container">
                        <!-- 分页按钮将通过JavaScript动态生成 -->
                    </div>

                    <!-- 小厨房板块 -->
                    <div class="kitchen-section">
                        <h4 class="section-title">👨‍🍳 小厨房</h4>
                        
                        <!-- 已选食材展示 -->
                        <div class="selected-ingredients">
                            <h5 class="subsection-title">📦 已选食材</h5>
                            <div id="kitchen-ingredients-list" class="ingredients-list">
                                <div class="empty-kitchen">
                                    <p>🥬 还没有选择食材，去选菜区挑选吧！</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 烹饪方式选择 -->
                        <div class="cooking-method-selection">
                            <h5 class="subsection-title">🔥 烹饪方式</h5>
                            <div id="kitchen-cooking-methods" class="cooking-methods">
                                <!-- 烹饪方式将由JavaScript动态生成 -->
                            </div>
                        </div>
                        
                        <!-- 营养预览区域 -->
                        <div class="nutrition-preview" id="kitchen-nutrition-preview" style="display: none;">
                            <h5 class="subsection-title">📊 营养预览</h5>
                            <div class="nutrition-preview-content">
                                <div class="nutrition-item">
                                    <span class="nutrition-label">总能量</span>
                                    <span class="nutrition-value" id="preview-calories">0 千卡</span>
                                </div>
                                <div class="nutrition-item">
                                    <span class="nutrition-label">蛋白质</span>
                                    <span class="nutrition-value" id="preview-protein">0 克</span>
                                </div>
                                <div class="nutrition-item">
                                    <span class="nutrition-label">脂肪</span>
                                    <span class="nutrition-value" id="preview-fat">0 克</span>
                                </div>
                                <div class="nutrition-item">
                                    <span class="nutrition-label">碳水化合物</span>
                                    <span class="nutrition-value" id="preview-carbs">0 克</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 合成按钮 -->
                        <div class="synthesis-section">
                            <button id="synthesize-dish-btn" class="synthesize-btn" disabled>
                                ✨ 合成成品菜
                            </button>
                            <p class="synthesis-note">选择至少一种食材后可合成</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 侧边栏 -->
            <div class="sidebar">
                <!-- 预算面板 -->
                <div class="budget-sidebar">
                    <!-- 预算选择区域 -->
                    <div class="budget-selector-compact">
                        <h3 class="panel-title">💰 用餐预算</h3>
                        <div class="budget-options-compact">
                            <div class="budget-option-compact" data-budget="55">
                                <span class="budget-value">¥55</span>
                            </div>
                            <div class="budget-option-compact" data-budget="60">
                                <span class="budget-value">¥60</span>
                            </div>
                            <div class="budget-option-compact" data-budget="70">
                                <span class="budget-value">¥70</span>
                            </div>
                            <div class="budget-option-compact active" data-budget="999999">
                                <span class="budget-value">∞</span>
                            </div>
                        </div>
                    </div>

                    <!-- 预算使用情况区域 -->
                    <div class="budget-usage-compact">
                        <div class="usage-stats">
                            <div class="stat-row">
                                <span class="stat-label">总额</span>
                                <span class="stat-value" id="budget-total-compact" data-type="total">¥70</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">已用</span>
                                <span class="stat-value" id="budget-used-compact" data-type="used">¥0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">剩余</span>
                                <span class="stat-value" id="budget-remaining-compact" data-type="remaining">¥70</span>
                            </div>
                        </div>
                        
                        <div class="progress-bar-compact">
                            <div class="progress-track">
                                <div class="progress-fill" id="budget-progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-percentage" id="budget-percentage">0%</div>
                        </div>

                        <div class="progress-legend">
                            <div class="legend-item safe">
                                <span class="legend-dot"></span>
                                <span class="legend-text">安全</span>
                            </div>
                            <div class="legend-item warning">
                                <span class="legend-dot"></span>
                                <span class="legend-text">警告</span>
                            </div>
                            <div class="legend-item danger">
                                <span class="legend-dot"></span>
                                <span class="legend-text">超支</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 营养摄入面板 -->
                <div class="nutrition-panel">
                    <h3 class="panel-title">📊 营养摄入监控</h3>
                    
                    <!-- 三餐分配监控 -->
                    <div class="meal-monitoring-section">
                        <h4 class="meal-monitoring-title">三餐分配监控</h4>
                        <div class="meal-tabs">
                            <button class="meal-tab active" data-meal="breakfast" onclick="app.switchToMeal('breakfast')">
                                🌅 早餐 (30%)
                            </button>
                            <button class="meal-tab" data-meal="lunch" onclick="app.switchToMeal('lunch')">
                                ☀️ 午餐 (40%)
                            </button>
                            <button class="meal-tab" data-meal="dinner" onclick="app.switchToMeal('dinner')">
                                🌙 晚餐 (30%)
                            </button>
                            <button class="meal-tab" data-meal="total" onclick="app.switchMealTab('total')">
                                📊 全天总览
                            </button>
                        </div>
                        
                        <!-- 餐次详情面板 -->
                        <div class="meal-details">
                            <!-- 早餐监控 -->
                            <div class="meal-panel active" id="breakfast-panel">
                                <div class="meal-header">
                                    <span class="meal-name">早餐摄入</span>
                                    <span class="meal-target">目标: 390-660 kcal</span>
                                </div>
                                <div class="meal-progress-bar">
                                    <div class="meal-progress-fill" id="breakfast-progress" style="width: 0%"></div>
                                </div>
                                <div class="meal-stats">
                                    <span class="meal-current" id="breakfast-current">0 kcal</span>
                                    <span class="meal-percentage" id="breakfast-percent">0%</span>
                                </div>
                            </div>
                            
                            <!-- 午餐监控 -->
                            <div class="meal-panel" id="lunch-panel">
                                <div class="meal-header">
                                    <span class="meal-name">午餐摄入</span>
                                    <span class="meal-target">目标: 520-880 kcal</span>
                                </div>
                                <div class="meal-progress-bar">
                                    <div class="meal-progress-fill" id="lunch-progress" style="width: 0%"></div>
                                </div>
                                <div class="meal-stats">
                                    <span class="meal-current" id="lunch-current">0 kcal</span>
                                    <span class="meal-percentage" id="lunch-percent">0%</span>
                                </div>
                            </div>
                            
                            <!-- 晚餐监控 -->
                            <div class="meal-panel" id="dinner-panel">
                                <div class="meal-header">
                                    <span class="meal-name">晚餐摄入</span>
                                    <span class="meal-target">目标: 390-660 kcal</span>
                                </div>
                                <div class="meal-progress-bar">
                                    <div class="meal-progress-fill" id="dinner-progress" style="width: 0%"></div>
                                </div>
                                <div class="meal-stats">
                                    <span class="meal-current" id="dinner-current">0 kcal</span>
                                    <span class="meal-percentage" id="dinner-percent">0%</span>
                                </div>
                            </div>
                            
                            <!-- 全天总览 -->
                            <div class="meal-panel" id="total-panel">
                                <div class="meal-summary">
                                    <div class="summary-item">
                                        <span class="summary-label">早餐</span>
                                        <span class="summary-value" id="total-breakfast">0 kcal</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label">午餐</span>
                                        <span class="summary-value" id="total-lunch">0 kcal</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label">晚餐</span>
                                        <span class="summary-value" id="total-dinner">0 kcal</span>
                                    </div>
                                    <div class="summary-total">
                                        <span class="summary-label">全天总计</span>
                                        <span class="summary-value" id="total-all">0 kcal</span>
                                    </div>
                                </div>
                                
                                <!-- 全天总览进度条 -->
                                <div class="meal-progress-bar">
                                    <div class="meal-progress-fill" id="total-progress" style="width: 0%"></div>
                                </div>
                                <div class="meal-stats">
                                    <span class="meal-current" id="total-current">0 kcal</span>
                                    <span class="meal-percentage" id="total-percent">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 当前餐次显示 -->
                        <div class="current-meal-display">
                            <span class="current-meal-label">当前餐次：</span>
                            <span class="current-meal-value" id="current-meal-display">早餐</span>
                            <span class="meal-hint">点击上方餐次按钮切换，选择菜品时将自动分配到当前餐次</span>
                        </div>
                    </div>


                    
                    <!-- 营养成分条形图 -->
                    <div class="nutrition-bars-container">
                        <h4 class="nutrition-title">营养成分分布</h4>
                        <div class="nutrition-bars" id="nutrition-bars">
                            <!-- 动态生成营养条形图 -->
                        </div>
                    </div>
                </div>

                <!-- 油盐摄入量显示栏 -->
                <div class="oil-salt-panel">
                    <h3 class="panel-title">🧂 油盐摄入监控</h3>
                    <div class="oil-salt-content">
                        <!-- 油摄入量 -->
                        <div class="intake-item">
                            <div class="intake-header">
                                <span class="intake-label">食用油</span>
                                <span class="intake-recommendation">推荐: 25-30g/天</span>
                            </div>
                            <div class="intake-progress">
                                <div class="intake-progress-bar">
                                    <div class="intake-progress-fill oil-progress" id="oil-progress" style="width: 0%"></div>
                                </div>
                                <div class="intake-value">
                                    <span id="oil-current">0.0</span>g / <span class="intake-target">30g</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 盐摄入量 -->
                        <div class="intake-item">
                            <div class="intake-header">
                                <span class="intake-label">食盐</span>
                                <span class="intake-recommendation">推荐: ≤5g/天</span>
                            </div>
                            <div class="intake-progress">
                                <div class="intake-progress-bar">
                                    <div class="intake-progress-fill salt-progress" id="salt-progress" style="width: 0%"></div>
                                </div>
                                <div class="intake-value">
                                    <span id="salt-current">0.0</span>g / <span class="intake-target">5g</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 购物车面板 -->
                <div class="cart-panel">
                    <h3 class="panel-title">🛒 我的选择</h3>
                    <div id="cart-items">
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            还没有选择菜品
                        </div>
                    </div>
                    
                    <div class="cart-total">
                        <div class="total-row">
                            <span>总计：</span>
                            <span id="total-price" class="total-price">¥0.0</span>
                        </div>
                    </div>
                    
                    <!-- 导出分享按钮 -->
                    <div class="action-buttons">
                        <div class="export-section">
                            <button id="export-btn-main" class="action-btn export-btn primary" 
                                    onclick="
                                        console.log('导出按钮被点击');
                                        var exportOptions = document.getElementById('export-options');
                                        if (exportOptions) {
                                            if (exportOptions.style.display === 'none' || exportOptions.style.display === '') {
                                                exportOptions.style.display = 'block';
                                                console.log('显示导出选项');
                                            } else {
                                                exportOptions.style.display = 'none';
                                                console.log('隐藏导出选项');
                                            }
                                        } else {
                                            console.log('未找到导出选项元素');
                                        }
                                    "
                                    aria-label="导出完整营养分析报告，包含购物车商品详情和营养数据，点击选择格式"
                                    aria-expanded="false"
                                    aria-controls="export-options">
                                📊 导出营养分析报告
                            </button>
                            <div id="export-options" 
                                 class="export-options" 
                                 style="display: none;"
                                 role="menu"
                                 aria-label="导出格式选择">
                                <div class="format-selector">
                                    <label for="format-buttons">选择格式：</label>
                                    <div id="format-buttons" class="format-buttons" role="group" aria-label="图片格式选择">
                                        <button class="format-btn" 
                                                onclick="exportNutritionChart('png')" 
                                                role="menuitem"
                                                aria-label="导出完整营养分析报告为PNG格式">
                                            PNG
                                        </button>
                                        <button class="format-btn" 
                                                onclick="exportNutritionChart('jpeg')" 
                                                role="menuitem"
                                                aria-label="导出完整营养分析报告为JPEG格式">
                                            JPEG
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button class="action-btn share-btn" onclick="shareMealPlan()">📤 分享</button>
                    </div>
                </div>

                <!-- 膳食建议面板 -->
                <div class="suggestions-panel">
                    <h3 class="panel-title">💡 膳食搭配建议</h3>
                    
                    <!-- 膳食指导提示框 -->
                    <div class="dietary-guide-box">
                        <div class="dietary-guide-title">
                            <span class="guide-emoji">🥗</span>
                            健康膳食指导原则
                        </div>
                        <div class="dietary-guide-content">
                            <div class="guide-item">
                                <span class="guide-emoji">🥛</span>
                                每天早晚一杯奶
                            </div>
                            <div class="guide-item">
                                <span class="guide-emoji">🍎</span>
                                每餐水果拳头大
                            </div>
                            <div class="guide-item">
                                <span class="guide-emoji">🥬</span>
                                菜比水果多一点
                            </div>
                            <div class="guide-item">
                                <span class="guide-emoji">🍚</span>
                                饭跟蔬菜一样多
                            </div>
                            <div class="guide-item">
                                <span class="guide-emoji">🐟</span>
                                豆鱼蛋肉一掌心
                            </div>
                            <div class="guide-item">
                                <span class="guide-emoji">🌰</span>
                                坚果种子一茶匙
                            </div>
                        </div>
                    </div>
                    
                    <div id="suggestions">
                        <div class="suggestion-item">
                            选择菜品后，系统将为您提供个性化的营养搭配建议
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// 内联 cooking method data.js 内容
// Combined data for cooking method coefficients and condiments
// Basis: per 100 g finished dish for cooking methods; per unit for condiments.
window.NUTRITION_DATA = {
  "meta": {"generated_at": "classroom_tool", "lang": "zh-CN"},
  "cooking_methods": {'version': '1.0', 'basis': 'per_100g_finished_dish', 'units': {'delta_kcal': 'kcal/100g', 'delta_carbs_g': 'g/100g', 'delta_fat_g': 'g/100g', 'delta_water_g': 'g/100g', 'protein_retention': 'fraction(0-1)', 'mineral_retention': 'fraction(0-1)'}, 'categories': [{'id': 'wet', 'name_zh': '湿热烹调'}, {'id': 'dry', 'name_zh': '干热烹调'}, {'id': 'mixed', 'name_zh': '混合烹调'}, {'id': 'cold', 'name_zh': '冷加工'}], 'methods': [{'id': 'steam', 'category_id': 'wet', 'name_zh': '蒸', 'delta_kcal': -2, 'delta_carbs_g': 0, 'delta_fat_g': 0, 'protein_retention': 0.98, 'mineral_retention': 0.95, 'delta_water_g': 5, 'notes_zh': '基本不加油，保留性佳'}, {'id': 'stew_simmer_soup', 'category_id': 'wet', 'name_zh': '炖/煲/煨（煮汤）', 'delta_kcal': -10, 'delta_carbs_g': 0, 'delta_fat_g': 0.5, 'protein_retention': 0.95, 'mineral_retention': 0.85, 'delta_water_g': 20, 'notes_zh': '固形物能量密度↓；喝汤时矿物质≈100%'}, {'id': 'braise_stew_brief', 'category_id': 'wet', 'name_zh': '焖/烩', 'delta_kcal': 20, 'delta_carbs_g': 1, 'delta_fat_g': 2, 'protein_retention': 0.96, 'mineral_retention': 0.92, 'delta_water_g': 8, 'notes_zh': '少量油与芡汁'}, {'id': 'lu_braise', 'category_id': 'wet', 'name_zh': '卤', 'delta_kcal': 25, 'delta_carbs_g': 2, 'delta_fat_g': 1, 'protein_retention': 0.95, 'mineral_retention': 0.9, 'delta_water_g': 10, 'notes_zh': '吸汁增能，钠偏高'}, {'id': 'stir_fry', 'category_id': 'dry', 'name_zh': '炒', 'delta_kcal': 36, 'delta_carbs_g': 0, 'delta_fat_g': 4, 'protein_retention': 0.98, 'mineral_retention': 0.95, 'delta_water_g': -8, 'notes_zh': '常见吸油≈4g/100g'}, {'id': 'pan_fry_sear_griddle', 'category_id': 'dry', 'name_zh': '煎/煎封/烙', 'delta_kcal': 54, 'delta_carbs_g': 0, 'delta_fat_g': 6, 'protein_retention': 0.98, 'mineral_retention': 0.95, 'delta_water_g': -12, 'notes_zh': '表面定型，失水更多'}, {'id': 'deep_fry', 'category_id': 'dry', 'name_zh': '炸', 'delta_kcal': 130, 'delta_carbs_g': 5, 'delta_fat_g': 10, 'protein_retention': 0.97, 'mineral_retention': 0.95, 'delta_water_g': -20, 'notes_zh': '裹粉+吸油，增能显著'}, {'id': 'bake_roast_broil', 'category_id': 'dry', 'name_zh': '烤/焙/焗', 'delta_kcal': 30, 'delta_carbs_g': 0, 'delta_fat_g': 3, 'protein_retention': 0.97, 'mineral_retention': 0.95, 'delta_water_g': -15, 'notes_zh': '刷油少量，失水致能量密度↑'}, {'id': 'shao_braise', 'category_id': 'mixed', 'name_zh': '烧', 'delta_kcal': 55, 'delta_carbs_g': 3, 'delta_fat_g': 4, 'protein_retention': 0.96, 'mineral_retention': 0.92, 'delta_water_g': 5, 'notes_zh': '先煎上色再收汁，油糖兼有'}, {'id': 'liu_velvet_then_sauce', 'category_id': 'mixed', 'name_zh': '熘', 'delta_kcal': 47, 'delta_carbs_g': 5, 'delta_fat_g': 3, 'protein_retention': 0.97, 'mineral_retention': 0.93, 'delta_water_g': 5, 'notes_zh': '过油后勾芡'}, {'id': 'tangcu_sweet_sour', 'category_id': 'mixed', 'name_zh': '烹/糖醋/咕咾', 'delta_kcal': 120, 'delta_carbs_g': 10, 'delta_fat_g': 7, 'protein_retention': 0.96, 'mineral_retention': 0.92, 'delta_water_g': 5, 'notes_zh': '多为先炸后酸甜汁收'}, {'id': 'pa', 'category_id': 'mixed', 'name_zh': '扒', 'delta_kcal': 40, 'delta_carbs_g': 4, 'delta_fat_g': 3, 'protein_retention': 0.97, 'mineral_retention': 0.93, 'delta_water_g': 10, 'notes_zh': '浓汁覆盖，油与淀粉适中'}, {'id': 'claypot_sandpot', 'category_id': 'mixed', 'name_zh': '砂锅类', 'delta_kcal': 10, 'delta_carbs_g': 1, 'delta_fat_g': 1, 'protein_retention': 0.95, 'mineral_retention': 0.9, 'delta_water_g': 25, 'notes_zh': '小火久煨；喝汤矿物质≈100%'}, {'id': 'cold_mix', 'category_id': 'cold', 'name_zh': '拌（凉拌）', 'delta_kcal': 27, 'delta_carbs_g': 0, 'delta_fat_g': 3, 'protein_retention': 1.0, 'mineral_retention': 1.0, 'delta_water_g': 0, 'notes_zh': '以拌油计；注意生食安全'}]},
  "condiments": {'version': '1.0', 'basis': 'per_unit', 'units_note_zh': '每单位为常见家庭量具：1g/1 tsp/1 Tbsp；品牌差异较大，教学参考用。', 'items': [{'id': 'salt_1g', 'name_zh': '食用盐', 'unit': '1g', 'kcal': 0, 'carbs_g': 0, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 393, 'water_g': 0, 'notes_zh': 'NaCl中Na约39.3%'}, {'id': 'iodized_salt_1g', 'name_zh': '加碘盐', 'unit': '1g', 'kcal': 0, 'carbs_g': 0, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 393, 'water_g': 0, 'iodine_ug': 25, 'notes_zh': '碘约20–30 µg/g'}, {'id': 'soy_sauce_light_1tbsp', 'name_zh': '生抽（淡/Light）', 'unit': '1 Tbsp/15 ml', 'kcal': 10, 'carbs_g': 1.5, 'protein_g': 1.3, 'fat_g': 0, 'sodium_mg': 1000, 'water_g': 13, 'notes_zh': '低钠版可按一半钠计'}, {'id': 'soy_sauce_dark_1tbsp', 'name_zh': '老抽（Dark）', 'unit': '1 Tbsp/15 ml', 'kcal': 12, 'carbs_g': 2.5, 'protein_g': 1.2, 'fat_g': 0, 'sodium_mg': 800, 'water_g': 12, 'notes_zh': '着色为主'}, {'id': 'oyster_sauce_1tbsp', 'name_zh': '蚝油', 'unit': '1 Tbsp/15 ml', 'kcal': 20, 'carbs_g': 5, 'protein_g': 0.5, 'fat_g': 0, 'sodium_mg': 600, 'water_g': 9, 'notes_zh': ''}, {'id': 'douban_1tbsp', 'name_zh': '豆瓣酱', 'unit': '1 Tbsp/15 g', 'kcal': 50, 'carbs_g': 5, 'protein_g': 2, 'fat_g': 3, 'sodium_mg': 900, 'water_g': 5, 'notes_zh': '郫县/川式，钠偏高'}, {'id': 'ketchup_1tbsp', 'name_zh': '番茄酱', 'unit': '1 Tbsp/15 g', 'kcal': 15, 'carbs_g': 3.5, 'protein_g': 0.2, 'fat_g': 0, 'sodium_mg': 170, 'water_g': 11, 'notes_zh': ''}, {'id': 'chili_paste_1tbsp', 'name_zh': '辣椒酱', 'unit': '1 Tbsp/15 g', 'kcal': 20, 'carbs_g': 3, 'protein_g': 0.6, 'fat_g': 0.5, 'sodium_mg': 400, 'water_g': 10, 'notes_zh': ''}, {'id': 'msg_1tsp', 'name_zh': '味精', 'unit': '1 tsp/3 g', 'kcal': 10, 'carbs_g': 0, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 360, 'water_g': 0, 'notes_zh': '味精含钠约12%'}, {'id': 'stock_powder_1tsp', 'name_zh': '高汤粉/鸡精', 'unit': '1 tsp/3 g', 'kcal': 8, 'carbs_g': 1.2, 'protein_g': 0.4, 'fat_g': 0.2, 'sodium_mg': 500, 'water_g': 0, 'notes_zh': '品牌差异大'}, {'id': 'sugar_1tsp', 'name_zh': '白砂糖', 'unit': '1 tsp/4 g', 'kcal': 16, 'carbs_g': 4, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 0, 'water_g': 0, 'notes_zh': ''}, {'id': 'honey_1tsp', 'name_zh': '蜂蜜', 'unit': '1 tsp/7 g', 'kcal': 21, 'carbs_g': 5.7, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 1, 'water_g': 1.5, 'notes_zh': ''}, {'id': 'starch_1tsp', 'name_zh': '淀粉（玉米）', 'unit': '1 tsp/3 g', 'kcal': 12, 'carbs_g': 3, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 0, 'water_g': 0, 'notes_zh': '勾芡常用'}, {'id': 'cooking_oil_1tsp', 'name_zh': '植物油', 'unit': '1 tsp/5 g', 'kcal': 45, 'carbs_g': 0, 'protein_g': 0, 'fat_g': 5, 'sodium_mg': 0, 'water_g': 0, 'notes_zh': '换算：1 Tbsp≈15 ml≈13.5 g≈120 kcal'}, {'id': 'butter_1tsp', 'name_zh': '黄油（烹调用）', 'unit': '1 tsp/5 g', 'kcal': 36, 'carbs_g': 0, 'protein_g': 0, 'fat_g': 4.1, 'sodium_mg': 4, 'water_g': 0.8, 'notes_zh': ''}, {'id': 'vinegar_1tbsp', 'name_zh': '食醋', 'unit': '1 Tbsp/15 ml', 'kcal': 3, 'carbs_g': 0.1, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 1, 'water_g': 14, 'notes_zh': '能量与钠很低'}, {'id': 'cooking_wine_1tbsp', 'name_zh': '料酒', 'unit': '1 Tbsp/15 ml', 'kcal': 10, 'carbs_g': 0.5, 'protein_g': 0, 'fat_g': 0, 'sodium_mg': 5, 'water_g': 14, 'notes_zh': '酒精多挥发'}], 'daily_reference': {'sodium_upper_mg': 2000, 'salt_upper_g': 5, 'note_zh': 'WHO与《中国居民膳食指南》建议成年人与青少年日均食盐<5g（≈钠<2000mg）。'}}
};

// 如果使用 ES module：
// export default window.NUTRITION_DATA;
    </script>
<script>
// 菜品数据
const dishesData = [
    {
        id: 1,
        name: "白米饭",
        category: "staple",
        price: 2.0,
        emoji: "🍚",
        portion: "150g/份",
        nutrition: {
            calories: 195,
            carbs: 42.3,
            protein: 3.6,
            fat: {
                total: 0.2,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0.0
            },
            water: 70,
            minerals: 12,  // 主食类基础钠含量
            vitamins: 3.9  // 维生素含量
        },
        tags: ["low-fat"]
    },
    {
        id: 2,
        name: "蛋炒饭",
        category: "staple",
        price: 7.0,
        emoji: "🍳",
        portion: "220g/份",
        nutrition: {
            calories: 315.0,
            carbs: 38.0,
            protein: 11.3,
            fat: {
                total: 4.8,
                unsaturated: 1.6,
                saturated: 1.0,
                trans: 0.3
            },
            water: 40,
            minerals: 305,  // 炒制主食，适量增加钠含量
            vitamins: 10.1  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 3,
        name: "卤肉饭",
        category: "staple",
        price: 10.5,
        emoji: "🍖",
        portion: "280g/份",
        nutrition: {
            calories: 570.0,
            carbs: 52.8,
            protein: 24.7,
            fat: {
                total: 12.5,
                unsaturated: 4.1,
                saturated: 2.8,
                trans: 0.6
            },
            water: 45,
            minerals: 455,  // 卤制菜品，钠含量较高
            vitamins: 11.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 4,
        name: "酱油炒饭",
        category: "staple",
        price: 5.6,
        emoji: "🍚",
        portion: "200g/份",
        nutrition: {
            calories: 277.5,
            carbs: 48.8,
            protein: 6.9,
            fat: {
                total: 3.2,
                unsaturated: 1.1,
                saturated: 0.6,
                trans: 0.2
            },
            water: 50,
            minerals: 370,  // 酱油炒制，钠含量增加
            vitamins: 5.5  // 维生素含量
        },
        tags: ["low-fat"]
    },
    {
        id: 5,
        name: "西班牙海鲜饭",
        category: "staple",
        price: 19.6,
        emoji: "🥘",
        portion: "300g/份",
        nutrition: {
            calories: 630.0,
            carbs: 68.7,
            protein: 30.0,
            fat: {
                total: 10.8,
                unsaturated: 3.8,
                saturated: 2.1,
                trans: 0.6
            },
            water: 60,
            minerals: 535,  // 钠含量
            vitamins: 12.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 6,
        name: "蛋包饭",
        category: "staple",
        price: 8.4,
        emoji: "🥚",
        portion: "250g/份",
        nutrition: {
            calories: 427.5,
            carbs: 42.8,
            protein: 17.1,
            fat: {
                total: 9.5,
                unsaturated: 3.2,
                saturated: 1.9,
                trans: 0.6
            },
            water: 45,
            minerals: 350,  // 钠含量
            vitamins: 13.7  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 7,
        name: "白粥",
        category: "staple",
        price: 2.1,
        emoji: "🍚",
        portion: "200ml/份",
        nutrition: {
            calories: 97.5,
            carbs: 21.3,
            protein: 2.4,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 180,
            minerals: 10,  // 钠含量
            vitamins: 2  // 维生素含量
        },
        tags: ["low-fat"]
    },
    {
        id: 8,
        name: "皮蛋瘦肉粥",
        category: "staple",
        price: 5.6,
        emoji: "🥚",
        portion: "250ml/份",
        nutrition: {
            calories: 187.5,
            carbs: 27.8,
            protein: 10.9,
            fat: {
                total: 1.9,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0.1
            },
            water: 200,
            minerals: 205,  // 钠含量
            vitamins: 6.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 9,
        name: "青菜粥",
        category: "staple",
        price: 4.2,
        emoji: "🥬",
        portion: "250ml/份",
        nutrition: {
            calories: 127.5,
            carbs: 25.2,
            protein: 4.3,
            fat: {
                total: 0.5,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0.0
            },
            water: 210,
            minerals: 285,  // 钠含量
            vitamins: 6.4  // 维生素含量
        },
        tags: ["high-protein", "high-fiber"]
    },
    {
        id: 32,
        name: "鸡蛋全麦三明治",
        category: "staple",
        price: 9.8,
        emoji: "🥪",
        portion: "200g/份",
        nutrition: {
            calories: 397.5,
            carbs: 42.8,
            protein: 20.3,
            fat: {
                total: 7.2,
                unsaturated: 2.6,
                saturated: 1.4,
                trans: 0.3
            },
            water: 50,
            minerals: 285,  // 钠含量
            vitamins: 12.7  // 维生素含量
        },
        tags: ["high-protein", "high-fiber"]
    },
    {
        id: 33,
        name: "面包",
        category: "staple",
        price: 2.8,
        emoji: "🍞",
        portion: "80g/份",
        nutrition: {
            calories: 277.5,
            carbs: 48.8,
            protein: 9.1,
            fat: {
                total: 2.1,
                unsaturated: 0.7,
                saturated: 0.5,
                trans: 0.1
            },
            water: 25,
            minerals: 335,  // 钠含量
            vitamins: 5.5  // 维生素含量
        },
        tags: ["low-fat"]
    },
    {
        id: 34,
        name: "青椒肉丝",
        category: "main",
        price: 9.8,
        emoji: "🫑",
        portion: "250g/份",
        nutrition: {
            calories: 240.0,
            carbs: 11.7,
            protein: 18.9,
            fat: {
                total: 7.0,
                unsaturated: 2.4,
                saturated: 1.5,
                trans: 0.3
            },
            water: 50,
            minerals: 382,  // 钠含量
            vitamins: 19.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 35,
        name: "辣椒炒肉",
        category: "main",
        price: 11.2,
        emoji: "🌶️",
        portion: "250g/份",
        nutrition: {
            calories: 277.5,
            carbs: 12.8,
            protein: 22.4,
            fat: {
                total: 7.5,
                unsaturated: 2.6,
                saturated: 1.6,
                trans: 0.3
            },
            water: 45,
            minerals: 385,  // 钠含量
            vitamins: 22.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 36,
        name: "青椒炒肉",
        category: "main",
        price: 10.5,
        emoji: "🫑",
        portion: "250g/份",
        nutrition: {
            calories: 262.5,
            carbs: 12.3,
            protein: 20.7,
            fat: {
                total: 7.2,
                unsaturated: 2.5,
                saturated: 1.4,
                trans: 0.4
            },
            water: 48,
            minerals: 383,  // 钠含量
            vitamins: 21.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 37,
        name: "小炒肉",
        category: "main",
        price: 12.6,
        emoji: "🥩",
        portion: "220g/份",
        nutrition: {
            calories: 427.5,
            carbs: 9.8,
            protein: 25.1,
            fat: {
                total: 13.7,
                unsaturated: 4.6,
                saturated: 3.1,
                trans: 0.5
            },
            water: 35,
            minerals: 390,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 38,
        name: "小炒黄牛肉",
        category: "main",
        price: 15.4,
        emoji: "🐄",
        portion: "200g/份",
        nutrition: {
            calories: 420.0,
            carbs: 8.7,
            protein: 30.0,
            fat: {
                total: 12.1,
                unsaturated: 4.2,
                saturated: 2.7,
                trans: 0.4
            },
            water: 35,
            minerals: 395,  // 钠含量
            vitamins: 33.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 39,
        name: "红烧牛肉",
        category: "main",
        price: 16.8,
        emoji: "🥩",
        portion: "220g/份",
        nutrition: {
            calories: 457.5,
            carbs: 12.8,
            protein: 27.7,
            fat: {
                total: 13.7,
                unsaturated: 4.7,
                saturated: 3.1,
                trans: 0.4
            },
            water: 40,
            minerals: 450,  // 钠含量
            vitamins: 36.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 40,
        name: "红烧排骨",
        category: "main",
        price: 14.0,
        emoji: "🍖",
        portion: "200g/份",
        nutrition: {
            calories: 435.0,
            carbs: 12.3,
            protein: 25.1,
            fat: {
                total: 13.7,
                unsaturated: 4.4,
                saturated: 3.1,
                trans: 0.7
            },
            water: 40,
            minerals: 445,  // 钠含量
            vitamins: 34.8  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 41,
        name: "糖醋排骨",
        category: "main",
        price: 15.4,
        emoji: "🍖",
        portion: "220g/份",
        nutrition: {
            calories: 487.5,
            carbs: 27.8,
            protein: 22.4,
            fat: {
                total: 15.0,
                unsaturated: 5.0,
                saturated: 3.4,
                trans: 0.6
            },
            water: 35,
            minerals: 360,  // 钠含量
            vitamins: 39.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 42,
        name: "红烧肉圆",
        category: "main",
        price: 11.2,
        emoji: "🍖",
        portion: "200g/份",
        nutrition: {
            calories: 427.5,
            carbs: 19.2,
            protein: 20.7,
            fat: {
                total: 13.9,
                unsaturated: 4.6,
                saturated: 3.3,
                trans: 0.4
            },
            water: 45,
            minerals: 435,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 43,
        name: "红烧大肉",
        category: "main",
        price: 12.6,
        emoji: "🥩",
        portion: "180g/份",
        nutrition: {
            calories: 517.5,
            carbs: 12.3,
            protein: 22.0,
            fat: {
                total: 16.9,
                unsaturated: 4.8,
                saturated: 4.1,
                trans: 1.2
            },
            water: 30,
            minerals: 430,  // 钠含量
            vitamins: 41.4  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 44,
        name: "红烧狮子头",
        category: "main",
        price: 14.0,
        emoji: "🍖",
        portion: "220g/份",
        nutrition: {
            calories: 457.5,
            carbs: 15.8,
            protein: 22.4,
            fat: {
                total: 13.7,
                unsaturated: 4.5,
                saturated: 3.3,
                trans: 0.4
            },
            water: 40,
            minerals: 435,  // 钠含量
            vitamins: 36.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 45,
        name: "土豆炖牛肉",
        category: "main",
        price: 16.8,
        emoji: "🥔",
        portion: "280g/份",
        nutrition: {
            calories: 427.5,
            carbs: 33.8,
            protein: 27.7,
            fat: {
                total: 9.5,
                unsaturated: 3.2,
                saturated: 2.1,
                trans: 0.4
            },
            water: 65,
            minerals: 350,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein", "high-fiber"]
    },
    {
        id: 46,
        name: "酸汤肥牛",
        category: "main",
        price: 18.2,
        emoji: "🐄",
        portion: "250g/份",
        nutrition: {
            calories: 367.5,
            carbs: 12.8,
            protein: 30.0,
            fat: {
                total: 9.5,
                unsaturated: 3.4,
                saturated: 2.5,
                trans: 0.2
            },
            water: 120,
            minerals: 345,  // 钠含量
            vitamins: 29.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 47,
        name: "竹笋烤肉",
        category: "main",
        price: 14.0,
        emoji: "🎋",
        portion: "230g/份",
        nutrition: {
            calories: 367.5,
            carbs: 19.2,
            protein: 24.7,
            fat: {
                total: 9.5,
                unsaturated: 3.2,
                saturated: 2.1,
                trans: 0.4
            },
            water: 55,
            minerals: 340,  // 钠含量
            vitamins: 29.4  // 维生素含量
        },
        tags: ["high-protein", "high-fiber"]
    },
    {
        id: 48,
        name: "烤肉",
        category: "main",
        price: 17.5,
        emoji: "🥩",
        portion: "180g/份",
        nutrition: {
            calories: 577.5,
            carbs: 4.8,
            protein: 30.4,
            fat: {
                total: 19.0,
                unsaturated: 6.1,
                saturated: 4.5,
                trans: 0.8
            },
            water: 30,
            minerals: 340,  // 钠含量
            vitamins: 46.2  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 49,
        name: "牛排",
        category: "main",
        price: 24.5,
        emoji: "🥩",
        portion: "250g/份",
        nutrition: {
            calories: 425,
            carbs: 2.5,
            protein: 28.5,
            fat: {
                total: 12.1,
                unsaturated: 6.8,
                saturated: 4.5,
                trans: 0.8
            },
            water: 25,
            minerals: 345,  // 钠含量
            vitamins: 34.0  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 50,
        name: "炸鸡",
        category: "main",
        price: 12.6,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 427.5,
            carbs: 12.8,
            protein: 24.7,
            fat: {
                total: 13.9,
                unsaturated: 4.8,
                saturated: 3.5,
                trans: 0
            },
            water: 25,
            minerals: 330,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 51,
        name: "烤鸡腿",
        category: "main",
        price: 11.2,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 375.0,
            carbs: 5.7,
            protein: 26.9,
            fat: {
                total: 11.0,
                unsaturated: 3.7,
                saturated: 2.5,
                trans: 0.4
            },
            water: 30,
            minerals: 335,  // 钠含量
            vitamins: 30.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 52,
        name: "烤鸡翅",
        category: "main",
        price: 9.8,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 375.0,
            carbs: 5.7,
            protein: 26.9,
            fat: {
                total: 11.0,
                unsaturated: 3.7,
                saturated: 2.5,
                trans: 0.4
            },
            water: 30,
            minerals: 335,  // 钠含量
            vitamins: 30.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 53,
        name: "口水鸡",
        category: "main",
        price: 12.6,
        emoji: "🍗",
        portion: "160g/份",
        nutrition: {
            calories: 427.5,
            carbs: 9.8,
            protein: 30.0,
            fat: {
                total: 13.0,
                unsaturated: 4.4,
                saturated: 3.0,
                trans: 0.4
            },
            water: 35,
            minerals: 340,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 54,
        name: "宫保鸡丁",
        category: "main",
        price: 11.2,
        emoji: "🍗",
        portion: "160g/份",
        nutrition: {
            calories: 457.5,
            carbs: 19.2,
            protein: 23.7,
            fat: {
                total: 13.7,
                unsaturated: 4.1,
                saturated: 3.3,
                trans: 0.8
            },
            water: 30,
            minerals: 330,  // 钠含量
            vitamins: 36.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 55,
        name: "辣子鸡",
        category: "main",
        price: 12.6,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 367.5,
            carbs: 12.8,
            protein: 26.4,
            fat: {
                total: 10.5,
                unsaturated: 3.6,
                saturated: 2.3,
                trans: 0.4
            },
            water: 25,
            minerals: 335,  // 钠含量
            vitamins: 29.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 56,
        name: "红烧鸡",
        category: "main",
        price: 14.0,
        emoji: "🍗",
        portion: "180g/份",
        nutrition: {
            calories: 427.5,
            carbs: 12.3,
            protein: 32.7,
            fat: {
                total: 11.9,
                unsaturated: 4.1,
                saturated: 2.6,
                trans: 0.4
            },
            water: 40,
            minerals: 440,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 57,
        name: "咖喱鸡",
        category: "main",
        price: 12.6,
        emoji: "🍛",
        portion: "200g/份",
        nutrition: {
            calories: 427.5,
            carbs: 19.2,
            protein: 27.3,
            fat: {
                total: 12.1,
                unsaturated: 4.2,
                saturated: 2.7,
                trans: 0.4
            },
            water: 45,
            minerals: 335,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 58,
        name: "白切鸡",
        category: "main",
        price: 11.2,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 367.5,
            carbs: 3.8,
            protein: 30.4,
            fat: {
                total: 10.1,
                unsaturated: 3.4,
                saturated: 2.3,
                trans: 0.4
            },
            water: 35,
            minerals: 335,  // 钠含量
            vitamins: 29.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 59,
        name: "炸鸡块",
        category: "main",
        price: 10.5,
        emoji: "🍗",
        portion: "150g/份",
        nutrition: {
            calories: 427.5,
            carbs: 15.8,
            protein: 22.4,
            fat: {
                total: 13.7,
                unsaturated: 4.6,
                saturated: 3.2,
                trans: 0.4
            },
            water: 25,
            minerals: 325,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 60,
        name: "酸菜鱼",
        category: "main",
        price: 19.6,
        emoji: "🐟",
        portion: "300g/份",
        nutrition: {
            calories: 367.5,
            carbs: 12.8,
            protein: 34.4,
            fat: {
                total: 8.3,
                unsaturated: 3.3,
                saturated: 1.3,
                trans: 0.4
            },
            water: 180,
            minerals: 345,  // 钠含量
            vitamins: 29.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 61,
        name: "三文鱼",
        category: "main",
        price: 22.4,
        emoji: "🐟",
        portion: "150g/份",
        nutrition: {
            calories: 285,
            carbs: 0.0,
            protein: 22.5,
            fat: {
                total: 7.3,
                unsaturated: 5.7,
                saturated: 1.5,
                trans: 0.1
            },
            water: 35,
            minerals: 340,  // 钠含量
            vitamins: 22.8  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 62,
        name: "三文鱼寿司",
        category: "main",
        price: 17.5,
        emoji: "🍣",
        portion: "120g/份",
        nutrition: {
            calories: 277.5,
            carbs: 27.8,
            protein: 17.1,
            fat: {
                total: 5.5,
                unsaturated: 2.6,
                saturated: 0.6,
                trans: 0.1
            },
            water: 30,
            minerals: 325,  // 钠含量
            vitamins: 22.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 63,
        name: "清蒸虾",
        category: "main",
        price: 15.4,
        emoji: "🦐",
        portion: "150g/份",
        nutrition: {
            calories: 187.5,
            carbs: 3.8,
            protein: 30.4,
            fat: {
                total: 1.2,
                unsaturated: 0.5,
                saturated: 0.2,
                trans: 0.0
            },
            water: 80,
            minerals: 255,  // 钠含量
            vitamins: 15.0  // 维生素含量
        },
        tags: ["high-protein", "low-fat"]
    },
    {
        id: 64,
        name: "清蒸梭子蟹",
        category: "main",
        price: 24.5,
        emoji: "🦀",
        portion: "200g/份",
        nutrition: {
            calories: 217.5,
            carbs: 4.8,
            protein: 34.4,
            fat: {
                total: 1.9,
                unsaturated: 0.7,
                saturated: 0.3,
                trans: 0.1
            },
            water: 120,
            minerals: 265,  // 钠含量
            vitamins: 17.4  // 维生素含量
        },
        tags: ["high-protein", "low-fat"]
    },
    {
        id: 65,
        name: "虾仁炒蛋",
        category: "main",
        price: 12.6,
        emoji: "🦐",
        portion: "180g/份",
        nutrition: {
            calories: 337.5,
            carbs: 5.7,
            protein: 27.3,
            fat: {
                total: 9.5,
                unsaturated: 3.4,
                saturated: 1.4,
                trans: 0.8
            },
            water: 45,
            minerals: 395,  // 钠含量
            vitamins: 43.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 66,
        name: "麻婆豆腐",
        category: "main",
        price: 8.4,
        emoji: "🧈",
        portion: "200g/份",
        nutrition: {
            calories: 225.0,
            carbs: 14.7,
            protein: 16.7,
            fat: {
                total: 5.5,
                unsaturated: 2.0,
                saturated: 1.0,
                trans: 0.3
            },
            water: 85,
            minerals: 335,  // 钠含量
            vitamins: 27.0  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 67,
        name: "臭豆腐",
        category: "main",
        price: 7.0,
        emoji: "🧈",
        portion: "150g/份",
        nutrition: {
            calories: 277.5,
            carbs: 12.8,
            protein: 19.7,
            fat: {
                total: 8.3,
                unsaturated: 3.0,
                saturated: 1.6,
                trans: 0.4
            },
            water: 65,
            minerals: 340,  // 钠含量
            vitamins: 33.3  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 68,
        name: "家常豆腐",
        category: "main",
        price: 7.0,
        emoji: "🧈",
        portion: "200g/份",
        nutrition: {
            calories: 217.5,
            carbs: 12.3,
            protein: 17.1,
            fat: {
                total: 5.7,
                unsaturated: 2.1,
                saturated: 1.1,
                trans: 0.2
            },
            water: 90,
            minerals: 335,  // 钠含量
            vitamins: 26.1  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 69,
        name: "红烧豆腐",
        category: "main",
        price: 5.6,
        emoji: "🧈",
        portion: "180g/份",
        nutrition: {
            calories: 187.5,
            carbs: 12.8,
            protein: 14.9,
            fat: {
                total: 4.5,
                unsaturated: 1.7,
                saturated: 0.8,
                trans: 0.2
            },
            water: 85,
            minerals: 430,  // 钠含量
            vitamins: 22.5  // 维生素含量
        },
        tags: ["high-protein", "low-fat"]
    },
    {
        id: 70,
        name: "地三鲜",
        category: "side",
        price: 8.4,
        emoji: "🍆",
        portion: "250g/份",
        nutrition: {
            calories: 277.5,
            carbs: 33.8,
            protein: 6.4,
            fat: {
                total: 5.7,
                unsaturated: 2.0,
                saturated: 1.1,
                trans: 0.3
            },
            water: 120,
            minerals: 215,  // 钠含量
            vitamins: 41.6  // 维生素含量
        },
        tags: ["high-fiber"]
    },
    {
        id: 71,
        name: "红烧茄子",
        category: "side",
        price: 7.0,
        emoji: "🍆",
        portion: "200g/份",
        nutrition: {
            calories: 217.5,
            carbs: 27.8,
            protein: 5.1,
            fat: {
                total: 4.5,
                unsaturated: 1.6,
                saturated: 0.9,
                trans: 0.2
            },
            water: 110,
            minerals: 210,  // 钠含量
            vitamins: 32.6  // 维生素含量
        },
        tags: ["high-fiber"]
    },
    {
        id: 72,
        name: "干锅花菜",
        category: "side",
        price: 9.8,
        emoji: "🥬",
        portion: "220g/份",
        nutrition: {
            calories: 187.5,
            carbs: 19.2,
            protein: 8.3,
            fat: {
                total: 4.3,
                unsaturated: 1.5,
                saturated: 0.9,
                trans: 0.2
            },
            water: 95,
            minerals: 220,  // 钠含量
            vitamins: 28.1  // 维生素含量
        },
        tags: ["high-fiber", "high-vitamin"]
    },
    {
        id: 73,
        name: "蒜蓉西兰花",
        category: "side",
        price: 5.6,
        emoji: "🥦",
        portion: "180g/份",
        nutrition: {
            calories: 127.5,
            carbs: 12.8,
            protein: 7.7,
            fat: {
                total: 2.1,
                unsaturated: 0.8,
                saturated: 0.4,
                trans: 0.1
            },
            water: 105,
            minerals: 215,  // 钠含量
            vitamins: 19.1  // 维生素含量
        },
        tags: ["low-fat", "high-fiber", "high-vitamin"]
    },
    {
        id: 74,
        name: "清炒小白菜",
        category: "side",
        price: 4.2,
        emoji: "🥬",
        portion: "150g/份",
        nutrition: {
            calories: 67.5,
            carbs: 7.8,
            protein: 5.1,
            fat: {
                total: 1.2,
                unsaturated: 0.5,
                saturated: 0.2,
                trans: 0.0
            },
            water: 125,
            minerals: 280,  // 钠含量
            vitamins: 37.5  // 维生素含量
        },
        tags: ["low-fat", "low-calorie", "high-vitamin"]
    },
    {
        id: 75,
        name: "菠菜",
        category: "side",
        price: 4.9,
        emoji: "🥬",
        portion: "150g/份",
        nutrition: {
            calories: 55,
            carbs: 6.8,
            protein: 4.2,
            fat: {
                total: 0.9,
                unsaturated: 0.6,
                saturated: 0.2,
                trans: 0.0
            },
            water: 120,
            minerals: 225,  // 钠含量
            vitamins: 37.5  // 维生素含量
        },
        tags: ["low-fat", "low-calorie", "high-vitamin"]
    },
    {
        id: 76,
        name: "韭菜炒蛋",
        category: "side",
        price: 7.0,
        emoji: "🥬",
        portion: "180g/份",
        nutrition: {
            calories: 247.5,
            carbs: 10.2,
            protein: 16.7,
            fat: {
                total: 7.2,
                unsaturated: 2.5,
                saturated: 1.4,
                trans: 0.4
            },
            water: 75,
            minerals: 285,  // 钠含量
            vitamins: 59.4  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 77,
        name: "西红柿炒蛋",
        category: "side",
        price: 5.6,
        emoji: "🍅",
        portion: "200g/份",
        nutrition: {
            calories: 217.5,
            carbs: 12.8,
            protein: 13.6,
            fat: {
                total: 6.5,
                unsaturated: 2.2,
                saturated: 1.3,
                trans: 0.4
            },
            water: 95,
            minerals: 280,  // 钠含量
            vitamins: 58.7  // 维生素含量
        },
        tags: ["high-protein", "high-vitamin"]
    },
    {
        id: 78,
        name: "醋溜土豆丝",
        category: "side",
        price: 4.2,
        emoji: "🥔",
        portion: "180g/份",
        nutrition: {
            calories: 187.5,
            carbs: 33.8,
            protein: 4.3,
            fat: {
                total: 2.5,
                unsaturated: 0.9,
                saturated: 0.5,
                trans: 0.1
            },
            water: 85,
            minerals: 205,  // 钠含量
            vitamins: 28.1  // 维生素含量
        },
        tags: ["low-fat", "high-fiber"]
    },
    {
        id: 79,
        name: "炸花生米",
        category: "side",
        price: 5.6,
        emoji: "🥜",
        portion: "80g/份",
        nutrition: {
            calories: 427.5,
            carbs: 18.8,
            protein: 17.1,
            fat: {
                total: 15.0,
                unsaturated: 6.1,
                saturated: 2.5,
                trans: 0.4
            },
            water: 15,
            minerals: 215,  // 钠含量
            vitamins: 64.1  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 80,
        name: "凉拌花生米",
        category: "side",
        price: 4.2,
        emoji: "🥜",
        portion: "80g/份",
        nutrition: {
            calories: 367.5,
            carbs: 19.2,
            protein: 16.3,
            fat: {
                total: 12.3,
                unsaturated: 5.1,
                saturated: 1.9,
                trans: 0.4
            },
            water: 20,
            minerals: 230,  // 钠含量
            vitamins: 55.1  // 维生素含量
        },
        tags: ["high-protein", "high-fat"]
    },
    {
        id: 81,
        name: "水煮花生",
        category: "side",
        price: 3.5,
        emoji: "🥜",
        portion: "80g/份",
        nutrition: {
            calories: 337.5,
            carbs: 18.8,
            protein: 15.7,
            fat: {
                total: 10.8,
                unsaturated: 4.6,
                saturated: 1.7,
                trans: 0.2
            },
            water: 25,
            minerals: 208,  // 钠含量
            vitamins: 50.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 82,
        name: "茶叶蛋",
        category: "side",
        price: 2.1,
        emoji: "🥚",
        portion: "60g/份",
        nutrition: {
            calories: 127.5,
            carbs: 1.8,
            protein: 9.1,
            fat: {
                total: 3.9,
                unsaturated: 1.3,
                saturated: 0.7,
                trans: 0.3
            },
            water: 35,
            minerals: 195,  // 钠含量
            vitamins: 30.6  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 83,
        name: "咸鸭蛋",
        category: "side",
        price: 2.8,
        emoji: "🥚",
        portion: "60g/份",
        nutrition: {
            calories: 157.5,
            carbs: 2.2,
            protein: 9.6,
            fat: {
                total: 5.2,
                unsaturated: 1.7,
                saturated: 1.0,
                trans: 0.4
            },
            water: 30,
            minerals: 200,  // 钠含量
            vitamins: 37.8  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 84,
        name: "松花蛋",
        category: "side",
        price: 3.5,
        emoji: "🥚",
        portion: "60g/份",
        nutrition: {
            calories: 142.5,
            carbs: 3.3,
            protein: 8.7,
            fat: {
                total: 4.5,
                unsaturated: 1.5,
                saturated: 0.9,
                trans: 0.3
            },
            water: 32,
            minerals: 198,  // 钠含量
            vitamins: 34.2  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 85,
        name: "白煮蛋",
        category: "side",
        price: 1.4,
        emoji: "🥚",
        portion: "50g/份",
        nutrition: {
            calories: 112.5,
            carbs: 1.2,
            protein: 8.3,
            fat: {
                total: 3.5,
                unsaturated: 1.1,
                saturated: 0.6,
                trans: 0.3
            },
            water: 35,
            minerals: 192,  // 钠含量
            vitamins: 27.0  // 维生素含量
        },
        tags: ["high-protein", "low-fat"]
    },
    {
        id: 86,
        name: "煎蛋",
        category: "side",
        price: 2.1,
        emoji: "🍳",
        portion: "60g/份",
        nutrition: {
            calories: 157.5,
            carbs: 1.8,
            protein: 10.0,
            fat: {
                total: 5.5,
                unsaturated: 1.8,
                saturated: 1.1,
                trans: 0.4
            },
            water: 30,
            minerals: 195,  // 钠含量
            vitamins: 37.8  // 维生素含量
        },
        tags: ["high-protein"]
    },
    {
        id: 87,
        name: "蒸蛋",
        category: "side",
        price: 2.8,
        emoji: "🥚",
        portion: "80g/份",
        nutrition: {
            calories: 127.5,
            carbs: 3.8,
            protein: 10.4,
            fat: {
                total: 3.5,
                unsaturated: 1.1,
                saturated: 0.7,
                trans: 0.2
            },
            water: 55,
            minerals: 198,  // 钠含量
            vitamins: 30.6  // 维生素含量
        },
        tags: ["high-protein", "low-fat"]
    },
    {
        id: 88,
        name: "紫菜蛋花汤",
        category: "soup",
        price: 4.2,
        emoji: "🍲",
        portion: "300ml/份",
        nutrition: {
            calories: 67.5,
            carbs: 5.7,
            protein: 5.6,
            fat: {
                total: 1.5,
                unsaturated: 0.5,
                saturated: 0.3,
                trans: 0.1
            },
            water: 280,
            minerals: 275,  // 钠含量
            vitamins: 8.0  // 维生素含量
        },
        tags: ["low-fat", "low-calorie"]
    },
    {
        id: 89,
        name: "西红柿蛋花汤",
        category: "soup",
        price: 4.9,
        emoji: "🍲",
        portion: "300ml/份",
        nutrition: {
            calories: 82.5,
            carbs: 7.8,
            protein: 6.4,
            fat: {
                total: 1.9,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0.1
            },
            water: 270,
            minerals: 270,  // 钠含量
            vitamins: 9.0  // 维生素含量
        },
        tags: ["low-fat", "low-calorie", "high-vitamin"]
    },
    {
        id: 90,
        name: "丝瓜蛋汤",
        category: "soup",
        price: 5.6,
        emoji: "🍲",
        portion: "300ml/份",
        nutrition: {
            calories: 97.5,
            carbs: 10.2,
            protein: 6.9,
            fat: {
                total: 2.1,
                unsaturated: 0.7,
                saturated: 0.5,
                trans: 0.1
            },
            water: 265,
            minerals: 225,  // 钠含量
            vitamins: 8.0  // 维生素含量
        },
        tags: ["low-fat", "low-calorie"]
    },
    {
        id: 91,
        name: "蛋汤",
        category: "soup",
        price: 3.5,
        emoji: "🍲",
        portion: "300ml/份",
        nutrition: {
            calories: 67.5,
            carbs: 4.2,
            protein: 6.0,
            fat: {
                total: 1.7,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0.1
            },
            water: 275,
            minerals: 215,  // 钠含量
            vitamins: 8.0  // 维生素含量
        },
        tags: ["low-fat", "high-protein"]
     },
     {
         id: 92,
         name: "冬瓜汤",
         category: "soup",
         price: 2.8,
         emoji: "🥒",
         portion: "300ml/份",
         nutrition: {
             calories: 37.5,
             carbs: 7.2,
             protein: 1.6,
             fat: {
                 total: 0.2,
                 unsaturated: 0.1,
                 saturated: 0.0,
                 trans: 0
             },
             water: 250,
             minerals: 218,  // 钠含量
            vitamins: 5  // 维生素含量
         },
         tags: ["low-fat", "low-calorie"]
     },
     {
         id: 93,
         name: "绿豆汤",
         category: "soup",
         price: 3.5,
         emoji: "🟢",
         portion: "300ml/份",
         nutrition: {
             calories: 52.5,
             carbs: 10.8,
             protein: 3.3,
             fat: {
                 total: 0.1,
                 unsaturated: 0.0,
                 saturated: 0.0,
                 trans: 0
             },
             water: 240,
             minerals: 220,  // 钠含量
            vitamins: 5  // 维生素含量
         },
         tags: ["low-fat", "low-calorie"]
     },
     {
         id: 94,
         name: "排骨汤",
         category: "soup",
         price: 8.4,
         emoji: "🍖",
         portion: "300ml/份",
         nutrition: {
             calories: 127.5,
             carbs: 3.8,
             protein: 11.3,
             fat: {
                 total: 3.2,
                 unsaturated: 1.0,
                 saturated: 0.7,
                 trans: 0.2
             },
             water: 220,
             minerals: 185,  // 钠含量
            vitamins: 6.4  // 维生素含量
         },
         tags: ["high-protein"]
     },
     {
         id: 95,
         name: "水果沙拉",
         category: "side",
         price: 5.6,
         emoji: "🥗",
         portion: "150g/份",
         nutrition: {
             calories: 97.5,
             carbs: 22.8,
             protein: 1.6,
             fat: {
                 total: 0.3,
                 unsaturated: 0.1,
                 saturated: 0.1,
                 trans: 0
             },
             water: 120,
             minerals: 195,  // 钠含量
            vitamins: 15  // 维生素含量
         },
         tags: ["low-fat", "high-fiber", "high-vitamin"]
     },
     {
         id: 96,
         name: "青菜",
         category: "side",
         price: 3.5,
         emoji: "🥬",
         portion: "150g/份",
         nutrition: {
             calories: 37.5,
             carbs: 6.8,
             protein: 3.7,
             fat: {
                 total: 0.2,
                 unsaturated: 0.1,
                 saturated: 0.0,
                 trans: 0
             },
             water: 135,
             minerals: 225,  // 钠含量
            vitamins: 37.5  // 维生素含量
         },
         tags: ["low-fat", "low-calorie", "high-vitamin"]
     },
     {
         id: 97,
         name: "罗宋汤",
         category: "soup",
         price: 8.4,
         emoji: "🍲",
         portion: "350ml/份",
         nutrition: {
             calories: 127.5,
             carbs: 18.8,
             protein: 8.3,
             fat: {
                 total: 1.9,
                 unsaturated: 0.6,
                 saturated: 0.4,
                 trans: 0.1
             },
             water: 290,
             minerals: 235,  // 钠含量
            vitamins: 6.4  // 维生素含量
         },
         tags: ["low-fat", "high-vitamin"]
     },
     {
         id: 98,
         name: "馄饨",
         category: "staple",
         price: 10.5,
         emoji: "🥟",
         portion: "200g/份",
         nutrition: {
             calories: 427.5,
             carbs: 48.8,
             protein: 21.1,
             fat: {
                 total: 8.1,
                 unsaturated: 2.8,
                 saturated: 1.7,
                 trans: 0.4
             },
             water: 120,
             minerals: 180,  // 钠含量
            vitamins: 8.6  // 维生素含量
          },
          tags: ["high-protein", "low-fat"]
      },
      {
          id: 100,
          name: "矿泉水",
          category: "drinks",
          price: 2.0,
          emoji: "💧",
          portion: "500ml/瓶",
          nutrition: {
              calories: 0,
              carbs: 0,
              protein: 0,
              fat: {
              total: 0,
              unsaturated: 0,
              saturated: 0,
              trans: 0
          },
              water: 500,
              minerals: 7,  // 钠含量
            vitamins: 1  // 维生素含量
          },
          tags: ["zero-calorie", "hydrating"]
      },
      {
          id: 101,
          name: "纯牛奶",
          category: "drinks",
          price: 5.0,
          emoji: "🥛",
          portion: "250ml/盒",
          nutrition: {
              calories: 150,
              carbs: 12.0,
              protein: 8.0,
              fat: {
                  total: 8.0,
                  unsaturated: 2.5,
                  saturated: 5.0,
                  trans: 0.5
              },
              water: 220,
              minerals: 80,  // 钠含量
            vitamins: 1.5  // 维生素含量
          },
          tags: ["high-protein", "high-calcium"]
      },
      {
          id: 102,
          name: "酸奶",
          category: "drinks",
          price: 6.0,
          emoji: "🥛",
          portion: "200ml/杯",
          nutrition: {
              calories: 120,
              carbs: 15.0,
              protein: 6.0,
              fat: {
                  total: 4.0,
                  unsaturated: 1.2,
                  saturated: 2.5,
                  trans: 0.3
              },
              water: 170,
              minerals: 75,  // 钠含量
            vitamins: 1.2  // 维生素含量
          },
          tags: ["high-protein", "probiotic"]
      },
      {
          id: 103,
          name: "可乐",
          category: "drinks",
          price: 4.0,
          emoji: "🥤",
          portion: "330ml/罐",
          nutrition: {
              calories: 140,
              carbs: 35.0,
              protein: 0,
              fat: {
                  total: 0,
                  unsaturated: 0,
                  saturated: 0,
                  trans: 0
              },
              water: 290,
              minerals: 12,  // 钠含量
            vitamins: 1.4  // 维生素含量
          },
          tags: ["high-sugar", "carbonated"]
      },
      {
          id: 104,
          name: "橙汁",
          category: "drinks",
          price: 8.0,
          emoji: "🍊",
          portion: "250ml/杯",
          nutrition: {
              calories: 110,
              carbs: 26.0,
              protein: 2.0,
              fat: {
                  total: 0.5,
                  unsaturated: 0.3,
                  saturated: 0.2,
                  trans: 0
              },
              water: 220,
              minerals: 20,  // 钠含量
            vitamins: 2.0  // 维生素含量
          },
          tags: ["high-vitamin", "natural"]
      },
      {
          id: 105,
          name: "豆浆",
          category: "drinks",
          price: 4.0,
          emoji: "🥛",
          portion: "250ml/杯",
          nutrition: {
              calories: 85,
              carbs: 8.0,
              protein: 7.0,
              fat: {
                  total: 3.5,
                  unsaturated: 2.0,
                  saturated: 1.2,
                  trans: 0.3
              },
              water: 230,
              minerals: 50,  // 钠含量
            vitamins: 1  // 维生素含量
          },
          tags: ["high-protein", "plant-based"]
      },
      {
          id: 106,
          name: "混合坚果",
          category: "snacks",
          price: 10.0,
          emoji: "🥜",
          portion: "25g/份",
          nutrition: {
              calories: 150,
              carbs: 5.0,
              protein: 5.0,
              fat: {
                  total: 5.5,
                  unsaturated: 4.0,
                  saturated: 1.0,
                  trans: 0
              },
              water: 1.5,
              minerals: 4.0,
              vitamins: 2.0
          },
          tags: ["high-fat", "healthy-fat"]
      },
      {
          id: 107,
          name: "核桃仁",
          category: "snacks",
          price: 6.0,
          emoji: "🌰",
          portion: "5g/份",
          nutrition: {
              calories: 33,
              carbs: 0.7,
              protein: 0.8,
              fat: {
                  total: 1.3,
                  unsaturated: 1.0,
                  saturated: 0.1,
                  trans: 0
              },
              water: 0.2,
              minerals: 0.3,
              vitamins: 0.2
          },
          tags: ["high-fat", "healthy-fat", "brain-food"]
      },
      {
          id: 108,
          name: "杏仁",
          category: "snacks",
          price: 7.0,
          emoji: "🌰",
          portion: "5g/份",
          nutrition: {
              calories: 29,
              carbs: 1.0,
              protein: 1.1,
              fat: {
                  total: 1.0,
                  unsaturated: 0.8,
                  saturated: 0.1,
                  trans: 0
              },
              water: 0.2,
              minerals: 0.2,
              vitamins: 1.3
          },
          tags: ["high-fat", "healthy-fat", "high-vitamin"]
      },
      {
          id: 122,
          name: "精品蓝莓",
          category: "snacks",
          price: 8.0,
          emoji: "🫐",
          portion: "100g/份",
          nutrition: {
              calories: 53,
              carbs: 13.3,
              protein: 0.7,
              fat: {
                  total: 0.33,
                  unsaturated: 0.20,
                  saturated: 0.07,
                  trans: 0
              },
              water: 85.3,
              minerals: 0.7,
              vitamins: 12.0
          },
          tags: ["high-vitamin", "antioxidant", "low-fat"]
      },
      {
          id: 123,
          name: "有机草莓",
          category: "snacks",
          price: 8.0,
          emoji: "🍓",
          portion: "150g/份",
          nutrition: {
              calories: 45,
              carbs: 11.3,
              protein: 0.8,
              fat: {
                  total: 0.45,
                  unsaturated: 0.30,
                  saturated: 0.08,
                  trans: 0
              },
              water: 136.5,
              minerals: 1.5,
              vitamins: 9.0
          },
          tags: ["high-vitamin", "antioxidant", "natural"]
      },
      {
          id: 124,
          name: "进口车厘子",
          category: "snacks",
          price: 11.0,
          emoji: "🍒",
          portion: "100g/份",
          nutrition: {
              calories: 64,
              carbs: 16.0,
              protein: 1.2,
              fat: {
                  total: 0.20,
                  unsaturated: 0.12,
                  saturated: 0.04,
                  trans: 0
              },
              water: 82.0,
              minerals: 0.8,
              vitamins: 3.2
          },
          tags: ["high-vitamin", "antioxidant", "premium"]
      },
      {
          id: 125,
          name: "新西兰奇异果",
          category: "snacks",
          price: 7.5,
          emoji: "🥝",
          portion: "100g/份",
          nutrition: {
              calories: 60,
              carbs: 14.7,
              protein: 1.0,
              fat: {
                  total: 0.50,
                  unsaturated: 0.30,
                  saturated: 0.10,
                  trans: 0
              },
              water: 84.0,
              minerals: 1.0,
              vitamins: 9.3
          },
          tags: ["high-vitamin", "high-fiber", "natural"]
      },
      {
          id: 126,
          name: "泰国椰子片",
          category: "snacks",
          price: 6.5,
          emoji: "🥥",
          portion: "8g/份",
          nutrition: {
              calories: 28,
              carbs: 1.2,
              protein: 0.3,
              fat: {
                  total: 2.7,
                  unsaturated: 0.2,
                  saturated: 2.4,
                  trans: 0
              },
              water: 0.4,
              minerals: 0.1,
              vitamins: 0.2
          },
          tags: ["high-fat", "natural", "tropical"]
      },
      {
          id: 127,
          name: "蜂蜜烤腰果",
          category: "snacks",
          price: 8.0,
          emoji: "🥜",
          portion: "6g/份",
          nutrition: {
              calories: 33,
              carbs: 1.8,
              protein: 1.1,
              fat: {
                  total: 2.6,
                  unsaturated: 2.0,
                  saturated: 0.5,
                  trans: 0
              },
              water: 0.2,
              minerals: 0.3,
              vitamins: 0.4
          },
          tags: ["high-fat", "healthy-fat", "premium"]
      },
      {
          id: 128,
          name: "盐焗开心果",
          category: "snacks",
          price: 9.5,
          emoji: "🌰",
          portion: "5g/份",
          nutrition: {
              calories: 28,
              carbs: 1.4,
              protein: 1.0,
              fat: {
                  total: 2.3,
                  unsaturated: 1.8,
                  saturated: 0.4,
                  trans: 0
              },
              water: 0.2,
              minerals: 0.4,
              vitamins: 0.6
          },
          tags: ["high-fat", "healthy-fat", "high-mineral"]
      },
      {
          id: 129,
          name: "烘焙夏威夷果",
          category: "snacks",
          price: 12.5,
          emoji: "🥜",
          portion: "4g/份",
          nutrition: {
              calories: 29,
              carbs: 0.6,
              protein: 0.3,
              fat: {
                  total: 3.0,
                  unsaturated: 2.4,
                  saturated: 0.5,
                  trans: 0
              },
              water: 0.1,
              minerals: 0.2,
              vitamins: 0.3
          },
          tags: ["high-fat", "healthy-fat", "premium"]
      },
      {
          id: 130,
          name: "精选松子",
          category: "snacks",
          price: 11.5,
          emoji: "🌰",
          portion: "5g/份",
          nutrition: {
              calories: 34,
              carbs: 0.7,
              protein: 0.7,
              fat: {
                  total: 3.4,
                  unsaturated: 2.6,
                  saturated: 0.6,
                  trans: 0
              },
              water: 0.1,
              minerals: 0.3,
              vitamins: 1.2
          },
          tags: ["high-fat", "healthy-fat", "high-vitamin"]
      },
      {
          id: 131,
          name: "巴西坚果",
          category: "snacks",
          price: 10.5,
          emoji: "🥜",
          portion: "10g/份",
          nutrition: {
              calories: 67,
              carbs: 1.3,
              protein: 1.3,
              fat: {
                  total: 6.7,
                  unsaturated: 5.0,
                  saturated: 1.3,
                  trans: 0
              },
              water: 0.3,
              minerals: 1.7,
              vitamins: 2.7
          },
          tags: ["high-fat", "healthy-fat", "high-mineral"]
      },


];

// 食材营养数据 - 来自CSV文件
const ingredientsData = [
    {
        id: 1001,
        name: "黄油",
        category: "ingredient",
        price: 6.3,
        emoji: "🧈",
        portion: "10g/份",
        nutrition: {
            calories: 72.0,
            carbs: 0.0,
            protein: 0.1,
            fat: {
                total: 3.2,
                unsaturated: 2.0,
                saturated: 1.3,
                trans: 0
            },
            water: 1.6,
            minerals: 226,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['dairy'],
        ingredientCategory: "dairy",
        vitaminHighlights: "维A",
        mineralHighlights: "钠"
    },
    {
        id: 1002,
        name: "奶酪",
        category: "ingredient",
        price: 6.3,
        emoji: "🧀",
        portion: "10g/份",
        nutrition: {
            calories: 40.0,
            carbs: 0.1,
            protein: 2.5,
            fat: {
                total: 1.3,
                unsaturated: 0.8,
                saturated: 0.5,
                trans: 0
            },
            water: 3.6,
            minerals: 221,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['dairy', 'low-calorie'],
        ingredientCategory: "dairy",
        vitaminHighlights: "维B2, 维A",
        mineralHighlights: "钙, 磷, 锌"
    },
    {
        id: 1003,
        name: "苹果",
        category: "ingredient",
        price: 4.2,
        emoji: "🍎",
        portion: "150g/份",
        nutrition: {
            calories: 78.0,
            carbs: 20.7,
            protein: 0.5,
            fat: {
                total: 0.1,
                unsaturated: 0.1,
                saturated: 0.0,
                trans: 0
            },
            water: 129.0,
            minerals: 211,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维C, 果胶",
        mineralHighlights: "钾"
    },
    {
        id: 1004,
        name: "香蕉",
        category: "ingredient",
        price: 4.2,
        emoji: "🍌",
        portion: "150g/份",
        nutrition: {
            calories: 134.0,
            carbs: 34.2,
            protein: 1.7,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.1,
                trans: 0
            },
            water: 112.0,
            minerals: 214,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维B6",
        mineralHighlights: "钾, 镁"
    },
    {
        id: 1005,
        name: "橙子",
        category: "ingredient",
        price: 4.2,
        emoji: "🍊",
        portion: "150g/份",
        nutrition: {
            calories: 70.0,
            carbs: 17.7,
            protein: 1.4,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 130.0,
            minerals: 213,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维C",
        mineralHighlights: "钾"
    },
    {
        id: 1006,
        name: "葡萄",
        category: "ingredient",
        price: 4.2,
        emoji: "🍇",
        portion: "150g/份",
        nutrition: {
            calories: 104.0,
            carbs: 27.2,
            protein: 1.1,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 121.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维K",
        mineralHighlights: "钾"
    },
    {
        id: 1007,
        name: "草莓",
        category: "ingredient",
        price: 7,
        emoji: "🍓",
        portion: "150g/份",
        nutrition: {
            calories: 48.0,
            carbs: 11.6,
            protein: 1.0,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.1,
                trans: 0
            },
            water: 137.0,
            minerals: 213,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat', 'low-calorie'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维C, 叶酸",
        mineralHighlights: "锰, 钾"
    },
    {
        id: 1008,
        name: "蓝莓",
        category: "ingredient",
        price: 7,
        emoji: "🫐",
        portion: "150g/份",
        nutrition: {
            calories: 86.0,
            carbs: 21.8,
            protein: 1.1,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.1,
                trans: 0
            },
            water: 126.0,
            minerals: 213,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维K",
        mineralHighlights: "锰"
    },
    {
        id: 1009,
        name: "猕猴桃",
        category: "ingredient",
        price: 7,
        emoji: "🥝",
        portion: "150g/份",
        nutrition: {
            calories: 92.0,
            carbs: 22.1,
            protein: 1.7,
            fat: {
                total: 0.3,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0
            },
            water: 125.0,
            minerals: 215,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维C, 维E, 叶酸",
        mineralHighlights: "钾"
    },
    {
        id: 1010,
        name: "菠萝",
        category: "ingredient",
        price: 6,
        emoji: "🍍",
        portion: "150g/份",
        nutrition: {
            calories: 75.0,
            carbs: 19.7,
            protein: 0.8,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 129.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维C",
        mineralHighlights: "锰"
    },
    {
        id: 1011,
        name: "芒果",
        category: "ingredient",
        price: 6,
        emoji: "🥭",
        portion: "150g/份",
        nutrition: {
            calories: 90.0,
            carbs: 22.5,
            protein: 1.2,
            fat: {
                total: 0.2,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0
            },
            water: 125.0,
            minerals: 213,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['fruits', 'low-fat'],
        ingredientCategory: "fruits",
        vitaminHighlights: "维A(β-胡萝卜素), 维C",
        mineralHighlights: "钾"
    },
    {
        id: 1012,
        name: "青菜/小白菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 13.0,
            carbs: 2.2,
            protein: 1.5,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 95.0,
            minerals: 213,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维A, 维K, 叶酸",
        mineralHighlights: "钙, 钾"
    },
    {
        id: 1013,
        name: "西红柿",
        category: "ingredient",
        price: 2.7,
        emoji: "🍅",
        portion: "100g/份",
        nutrition: {
            calories: 18.0,
            carbs: 3.9,
            protein: 0.9,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 95.0,
            minerals: 212,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C, 番茄红素",
        mineralHighlights: "钾"
    },
    {
        id: 1014,
        name: "青椒",
        category: "ingredient",
        price: 2.7,
        emoji: "🫑",
        portion: "100g/份",
        nutrition: {
            calories: 20.0,
            carbs: 4.6,
            protein: 0.9,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 94.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C, 维A",
        mineralHighlights: "钾"
    },
    {
        id: 1015,
        name: "黄瓜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥒",
        portion: "100g/份",
        nutrition: {
            calories: 15.0,
            carbs: 3.6,
            protein: 0.7,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0,
                trans: 0
            },
            water: 95.0,
            minerals: 211,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维K",
        mineralHighlights: "钾"
    },
    {
        id: 1016,
        name: "胡萝卜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥕",
        portion: "100g/份",
        nutrition: {
            calories: 41.0,
            carbs: 9.6,
            protein: 0.9,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 88.0,
            minerals: 212,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维A(β-胡萝卜素)",
        mineralHighlights: "钾"
    },
    {
        id: 1017,
        name: "洋葱",
        category: "ingredient",
        price: 2.7,
        emoji: "🧅",
        portion: "100g/份",
        nutrition: {
            calories: 40.0,
            carbs: 9.3,
            protein: 1.1,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0,
                trans: 0
            },
            water: 89.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维B6, 叶酸",
        mineralHighlights: "钾"
    },
    {
        id: 1024,
        name: "茄子",
        category: "ingredient",
        price: 3,
        emoji: "🍆",
        portion: "100g/份",
        nutrition: {
            calories: 25.0,
            carbs: 5.9,
            protein: 1.0,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 92.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维B1, 维B6",
        mineralHighlights: "钾"
    },
    {
        id: 1025,
        name: "花菜",
        category: "ingredient",
        price: 3,
        emoji: "🥦",
        portion: "100g/份",
        nutrition: {
            calories: 25.0,
            carbs: 5.0,
            protein: 1.9,
            fat: {
                total: 0.1,
                unsaturated: 0.1,
                saturated: 0.0,
                trans: 0
            },
            water: 92.0,
            minerals: 214,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C, 维K, 叶酸",
        mineralHighlights: "钾"
    },
    {
        id: 1026,
        name: "西兰花",
        category: "ingredient",
        price: 4,
        emoji: "🥦",
        portion: "100g/份",
        nutrition: {
            calories: 34.0,
            carbs: 6.6,
            protein: 2.8,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.1,
                trans: 0
            },
            water: 89.0,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C, 维K, 叶酸",
        mineralHighlights: "钾"
    },
    {
        id: 1021,
        name: "菠菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 23.0,
            carbs: 3.6,
            protein: 2.9,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.1,
                trans: 0
            },
            water: 91.0,
            minerals: 216,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维A, 维K, 叶酸",
        mineralHighlights: "铁, 镁, 钾"
    },
    {
        id: 1022,
        name: "韭菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 30.0,
            carbs: 4.4,
            protein: 2.3,
            fat: {
                total: 0.3,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0
            },
            water: 90.0,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维K, 维C",
        mineralHighlights: "钾"
    },
    {
        id: 1023,
        name: "丝瓜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥒",
        portion: "100g/份",
        nutrition: {
            calories: 20.0,
            carbs: 4.4,
            protein: 0.7,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 94.0,
            minerals: 211,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C",
        mineralHighlights: "钾"
    },
    {
        id: 1024,
        name: "冬瓜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥒",
        portion: "100g/份",
        nutrition: {
            calories: 13.0,
            carbs: 3.0,
            protein: 0.4,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 96.0,
            minerals: 211,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C",
        mineralHighlights: "钾"
    },
    {
        id: 1025,
        name: "卷心菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 25.0,
            carbs: 5.8,
            protein: 1.3,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0,
                trans: 0
            },
            water: 92.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C, 维K",
        mineralHighlights: "钾"
    },
    {
        id: 1026,
        name: "甜菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 43.0,
            carbs: 10.0,
            protein: 1.6,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 88.0,
            minerals: 213,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "叶酸",
        mineralHighlights: "钾"
    },
    {
        id: 1027,
        name: "竹笋",
        category: "ingredient",
        price: 6,
        emoji: "🎋",
        portion: "100g/份",
        nutrition: {
            calories: 27.0,
            carbs: 5.2,
            protein: 2.6,
            fat: {
                total: 0.1,
                unsaturated: 0.1,
                saturated: 0.0,
                trans: 0
            },
            water: 92.0,
            minerals: 215,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维B6",
        mineralHighlights: "钾"
    },
    {
        id: 1028,
        name: "酸菜",
        category: "ingredient",
        price: 4,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 16.0,
            carbs: 3.0,
            protein: 1.1,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0,
                trans: 0
            },
            water: 93.0,
            minerals: 212,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C(发酵产生), 维K2",
        mineralHighlights: "钠, 钾"
    },
    {
        id: 1029,
        name: "腌萝卜",
        category: "ingredient",
        price: 4,
        emoji: "🥕",
        portion: "100g/份",
        nutrition: {
            calories: 20.0,
            carbs: 4.2,
            protein: 0.6,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0,
                trans: 0
            },
            water: 95.0,
            minerals: 211,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维C(少量)",
        mineralHighlights: "钠, 钾"
    },
    {
        id: 1030,
        name: "生菜",
        category: "ingredient",
        price: 2.7,
        emoji: "🥬",
        portion: "100g/份",
        nutrition: {
            calories: 15.0,
            carbs: 2.9,
            protein: 1.4,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 95.0,
            minerals: 213,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维A, 维K",
        mineralHighlights: "钾"
    },
    {
        id: 1031,
        name: "金针菇",
        category: "ingredient",
        price: 5,
        emoji: "🍄",
        portion: "100g/份",
        nutrition: {
            calories: 37.0,
            carbs: 7.8,
            protein: 2.7,
            fat: {
                total: 0.1,
                unsaturated: 0.1,
                saturated: 0.0,
                trans: 0
            },
            water: 89.0,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维B族",
        mineralHighlights: "钾, 磷"
    },
    {
        id: 1032,
        name: "紫菜/海苔(复水)",
        category: "ingredient",
        price: 3,
        emoji: "🌿",
        portion: "20g/份",
        nutrition: {
            calories: 6.0,
            carbs: 1.0,
            protein: 1.0,
            fat: {
                total: 0.0,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 17.6,
            minerals: 204,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['vegetables', 'low-fat', 'low-calorie'],
        ingredientCategory: "vegetables",
        vitaminHighlights: "维A, 维C, 叶酸",
        mineralHighlights: "碘, 铁"
    },
    {
        id: 1033,
        name: "大米（熟饭）",
        category: "ingredient",
        price: 2,
        emoji: "🌾",
        portion: "150g/份",
        nutrition: {
            calories: 195.0,
            carbs: 42.3,
            protein: 3.6,
            fat: {
                total: 0.2,
                unsaturated: 0.1,
                saturated: 0.0,
                trans: 0
            },
            water: 103.0,
            minerals: 218,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B1(少量)",
        mineralHighlights: "锰"
    },
    {
        id: 1034,
        name: "小米（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🌾",
        portion: "150g/份",
        nutrition: {
            calories: 168.0,
            carbs: 35.6,
            protein: 5.3,
            fat: {
                total: 0.6,
                unsaturated: 0.2,
                saturated: 0.2,
                trans: 0
            },
            water: 107.0,
            minerals: 218,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B1, 叶酸(少量)",
        mineralHighlights: "镁, 磷"
    },
    {
        id: 1035,
        name: "糙米（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🌾",
        portion: "150g/份",
        nutrition: {
            calories: 166.0,
            carbs: 34.5,
            protein: 3.9,
            fat: {
                total: 0.6,
                unsaturated: 0.2,
                saturated: 0.2,
                trans: 0
            },
            water: 108.0,
            minerals: 218,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B族",
        mineralHighlights: "镁, 锰"
    },
    {
        id: 1036,
        name: "燕麦（熟粥）",
        category: "ingredient",
        price: 3.2,
        emoji: "🥣",
        portion: "150g/份",
        nutrition: {
            calories: 102.0,
            carbs: 17.6,
            protein: 3.6,
            fat: {
                total: 0.8,
                unsaturated: 0.5,
                saturated: 0.3,
                trans: 0
            },
            water: 126.0,
            minerals: 221,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B1",
        mineralHighlights: "镁"
    },
    {
        id: 1037,
        name: "面条（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🍜",
        portion: "150g/份",
        nutrition: {
            calories: 207.0,
            carbs: 37.5,
            protein: 6.8,
            fat: {
                total: 1.3,
                unsaturated: 0.8,
                saturated: 0.5,
                trans: 0
            },
            water: 102.0,
            minerals: 230,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains', 'high-protein'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B1(少量)",
        mineralHighlights: "硒"
    },
    {
        id: 1038,
        name: "白吐司",
        category: "ingredient",
        price: 3.2,
        emoji: "🍞",
        portion: "150g/份",
        nutrition: {
            calories: 398.0,
            carbs: 73.5,
            protein: 13.5,
            fat: {
                total: 1.9,
                unsaturated: 1.2,
                saturated: 0.8,
                trans: 0
            },
            water: 53.0,
            minerals: 246,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains', 'high-protein'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B1(强化可更高)",
        mineralHighlights: "钠, 硒"
    },
    {
        id: 1039,
        name: "全麦吐司",
        category: "ingredient",
        price: 5.0,
        emoji: "🍞",
        portion: "150g/份",
        nutrition: {
            calories: 370.0,
            carbs: 61.5,
            protein: 19.5,
            fat: {
                total: 2.5,
                unsaturated: 1.5,
                saturated: 1.0,
                trans: 0
            },
            water: 62.0,
            minerals: 261,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains', 'high-protein'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B族, 维E(少量)",
        mineralHighlights: "镁, 锌"
    },
    {
        id: 1040,
        name: "土豆（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🥔",
        portion: "150g/份",
        nutrition: {
            calories: 130.0,
            carbs: 30.2,
            protein: 2.9,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 113.0,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains', 'low-fat'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维C(熟后部分保留)",
        mineralHighlights: "钾"
    },
    {
        id: 1041,
        name: "南瓜（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🎃",
        portion: "150g/份",
        nutrition: {
            calories: 39.0,
            carbs: 9.8,
            protein: 1.5,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 138.0,
            minerals: 213,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['whole-grains', 'low-fat', 'low-calorie'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维A(β-胡萝卜素)",
        mineralHighlights: "钾"
    },
    {
        id: 1042,
        name: "玉米粒（熟）",
        category: "ingredient",
        price: 3.2,
        emoji: "🌽",
        portion: "150g/份",
        nutrition: {
            calories: 144.0,
            carbs: 31.5,
            protein: 5.1,
            fat: {
                total: 0.9,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0
            },
            water: 110.0,
            minerals: 224,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['whole-grains', 'high-protein'],
        ingredientCategory: "whole-grains",
        vitaminHighlights: "维B族",
        mineralHighlights: "镁, 磷"
    },
    {
        id: 1043,
        name: "猪瘦肉",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 72.0,
            carbs: 0.0,
            protein: 10.5,
            fat: {
                total: 1.3,
                unsaturated: 0.8,
                saturated: 0.5,
                trans: 0
            },
            water: 36.0,
            minerals: 237,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1, 维B3",
        mineralHighlights: "锌, 铁"
    },
    {
        id: 1044,
        name: "五花肉",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 198.0,
            carbs: 0.0,
            protein: 6.0,
            fat: {
                total: 7.6,
                unsaturated: 4.6,
                saturated: 3.0,
                trans: 0
            },
            water: 25.0,
            minerals: 260,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1",
        mineralHighlights: "硒"
    },
    {
        id: 1045,
        name: "猪肉糜",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 110.0,
            carbs: 0.0,
            protein: 9.3,
            fat: {
                total: 3.0,
                unsaturated: 1.8,
                saturated: 1.2,
                trans: 0
            },
            water: 33.0,
            minerals: 243,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1",
        mineralHighlights: "锌"
    },
    {
        id: 1046,
        name: "猪排骨",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 115.0,
            carbs: 0.0,
            protein: 10.0,
            fat: {
                total: 3.4,
                unsaturated: 2.0,
                saturated: 1.4,
                trans: 0
            },
            water: 30.0,
            minerals: 247,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B族",
        mineralHighlights: "磷, 锌"
    },
    {
        id: 1047,
        name: "猪大排",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 108.0,
            carbs: 0.0,
            protein: 10.5,
            fat: {
                total: 2.6,
                unsaturated: 1.6,
                saturated: 1.0,
                trans: 0
            },
            water: 32.0,
            minerals: 244,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1",
        mineralHighlights: "锌"
    },
    {
        id: 1048,
        name: "牛肉",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 540.0,
            carbs: 0.0,
            protein: 49.5,
            fat: {
                total: 14.0,
                unsaturated: 8.4,
                saturated: 5.6,
                trans: 0
            },
            water: 165.0,
            minerals: 415,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12, 维B3",
        mineralHighlights: "铁, 锌"
    },
    {
        id: 1049,
        name: "牛排",
        category: "ingredient",
        price: 18.4,
        emoji: "🥩",
        portion: "250g/份",
        nutrition: {
            calories: 400.0,
            carbs: 0.0,
            protein: 50.0,
            fat: {
                total: 14.0,
                unsaturated: 8.4,
                saturated: 5.6,
                trans: 0
            },
            water: 33.0,
            minerals: 243,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12",
        mineralHighlights: "铁, 锌"
    },
    {
        id: 1050,
        name: "肥牛片",
        category: "ingredient",
        price: 8.4,
        emoji: "🥩",
        portion: "50g/份",
        nutrition: {
            calories: 140.0,
            carbs: 0.0,
            protein: 7.5,
            fat: {
                total: 4.8,
                unsaturated: 2.9,
                saturated: 1.9,
                trans: 0
            },
            water: 28.0,
            minerals: 249,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12",
        mineralHighlights: "锌"
    },
    {
        id: 1051,
        name: "整鸡（半只）",
        category: "ingredient",
        price: 38,
        emoji: "🐔",
        portion: "500g/份",
        nutrition: {
            calories: 700.0,
            carbs: 0.0,
            protein: 59.5,
            fat: {
                total: 19.6,
                unsaturated: 11.8,
                saturated: 7.8,
                trans: 0
            },
            water: 231.0,
            minerals: 487,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B3, 维B6",
        mineralHighlights: "磷, 硒"
    },
    {
        id: 1052,
        name: "鸡腿",
        category: "ingredient",
        price: 5.0,
        emoji: "🍗",
        portion: "120g/支",
        nutrition: {
            calories: 259.2,
            carbs: 0.0,
            protein: 21.6,
            fat: {
                total: 7.2,
                unsaturated: 4.3,
                saturated: 2.9,
                trans: 0
            },
            water: 76.8,
            minerals: 303,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B3",
        mineralHighlights: "铁(少量), 锌"
    },
    {
        id: 1053,
        name: "鸡翅",
        category: "ingredient",
        price: 3.5,
        emoji: "🍗",
        portion: "35g/支",
        nutrition: {
            calories: 77.7,
            carbs: 0.0,
            protein: 5.8,
            fat: {
                total: 2.3,
                unsaturated: 1.4,
                saturated: 0.9,
                trans: 0
            },
            water: 21.0,
            minerals: 229,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B3",
        mineralHighlights: "磷"
    },
    {
        id: 1054,
        name: "鸡胸",
        category: "ingredient",
        price: 8.4,
        emoji: "🐔",
        portion: "50g/份",
        nutrition: {
            calories: 82.0,
            carbs: 0.0,
            protein: 9.5,
            fat: {
                total: 0.8,
                unsaturated: 0.5,
                saturated: 0.3,
                trans: 0
            },
            water: 38.0,
            minerals: 233,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B6, 维B3",
        mineralHighlights: "磷, 硒"
    },
    {
        id: 1055,
        name: "鸡丁",
        category: "ingredient",
        price: 8.4,
        emoji: "🐔",
        portion: "50g/份",
        nutrition: {
            calories: 82.0,
            carbs: 0.0,
            protein: 9.5,
            fat: {
                total: 0.8,
                unsaturated: 0.5,
                saturated: 0.3,
                trans: 0
            },
            water: 38.0,
            minerals: 233,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B6",
        mineralHighlights: "磷"
    },
    {
        id: 1056,
        name: "培根",
        category: "ingredient",
        price: 8.4,
        emoji: "🥓",
        portion: "50g/份",
        nutrition: {
            calories: 270.0,
            carbs: 0.6,
            protein: 9.0,
            fat: {
                total: 9.6,
                unsaturated: 5.8,
                saturated: 3.8,
                trans: 0
            },
            water: 18.0,
            minerals: 276,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1",
        mineralHighlights: "钠, 硒"
    },
    {
        id: 1057,
        name: "三文鱼",
        category: "ingredient",
        price: 8.4,
        emoji: "🐟",
        portion: "50g/份",
        nutrition: {
            calories: 104.0,
            carbs: 0.0,
            protein: 10.5,
            fat: {
                total: 2.8,
                unsaturated: 1.7,
                saturated: 1.1,
                trans: 0
            },
            water: 31.0,
            minerals: 245,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维D, 维B12",
        mineralHighlights: "硒, 钾, ω-3脂肪酸"
    },
    {
        id: 1058,
        name: "虾/虾仁",
        category: "ingredient",
        price: 8.4,
        emoji: "🦐",
        portion: "50g/份",
        nutrition: {
            calories: 50.0,
            carbs: 0.0,
            protein: 11.8,
            fat: {
                total: 0.3,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0
            },
            water: 38.0,
            minerals: 235,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein', 'low-fat'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12(少量)",
        mineralHighlights: "碘, 锌"
    },
    {
        id: 1059,
        name: "梭子蟹",
        category: "ingredient",
        price: 8.4,
        emoji: "🦀",
        portion: "50g/份",
        nutrition: {
            calories: 48.0,
            carbs: 0.0,
            protein: 9.2,
            fat: {
                total: 0.4,
                unsaturated: 0.2,
                saturated: 0.2,
                trans: 0
            },
            water: 39.0,
            minerals: 230,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12(少量)",
        mineralHighlights: "锌, 硒"
    },
    {
        id: 1060,
        name: "草鱼片",
        category: "ingredient",
        price: 8.4,
        emoji: "🐟",
        portion: "50g/份",
        nutrition: {
            calories: 62.0,
            carbs: 0.0,
            protein: 9.0,
            fat: {
                total: 0.8,
                unsaturated: 0.5,
                saturated: 0.3,
                trans: 0
            },
            water: 38.0,
            minerals: 232,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12(少量)",
        mineralHighlights: "磷, 硒"
    },
    {
        id: 1061,
        name: "蛤蜊/青口",
        category: "ingredient",
        price: 8.4,
        emoji: "🦪",
        portion: "50g/份",
        nutrition: {
            calories: 43.0,
            carbs: 2.0,
            protein: 6.0,
            fat: {
                total: 0.4,
                unsaturated: 0.2,
                saturated: 0.2,
                trans: 0
            },
            water: 40.0,
            minerals: 224,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12",
        mineralHighlights: "铁, 锌"
    },
    {
        id: 1062,
        name: "鱿鱼",
        category: "ingredient",
        price: 8.4,
        emoji: "🦑",
        portion: "50g/份",
        nutrition: {
            calories: 46.0,
            carbs: 1.0,
            protein: 8.1,
            fat: {
                total: 0.3,
                unsaturated: 0.2,
                saturated: 0.1,
                trans: 0
            },
            water: 39.0,
            minerals: 227,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein', 'low-fat', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12",
        mineralHighlights: "铜, 硒"
    },
    {
        id: 1063,
        name: "蟹棒",
        category: "ingredient",
        price: 8.4,
        emoji: "🦀",
        portion: "50g/份",
        nutrition: {
            calories: 48.0,
            carbs: 5.0,
            protein: 6.0,
            fat: {
                total: 0.4,
                unsaturated: 0.2,
                saturated: 0.2,
                trans: 0
            },
            water: 38.0,
            minerals: 224,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'high-protein', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "—",
        mineralHighlights: "钠"
    },
    {
        id: 1064,
        name: "鸡蛋",
        category: "ingredient",
        price: 5.0,
        emoji: "🥚",
        portion: "60g/只",
        nutrition: {
            calories: 86.4,
            carbs: 0.5,
            protein: 7.6,
            fat: {
                total: 2.4,
                unsaturated: 1.4,
                saturated: 1.0,
                trans: 0
            },
            water: 45.6,
            minerals: 238,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B12, 维D, 胆碱",
        mineralHighlights: "硒"
    },
    {
        id: 1065,
        name: "鸭蛋",
        category: "ingredient",
        price: 6.0,
        emoji: "🥚",
        portion: "80g/只",
        nutrition: {
            calories: 147.2,
            carbs: 0.6,
            protein: 10.6,
            fat: {
                total: 4.8,
                unsaturated: 2.9,
                saturated: 1.9,
                trans: 0
            },
            water: 54.4,
            minerals: 261,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "维A",
        mineralHighlights: "硒"
    },
    {
        id: 1066,
        name: "皮蛋/松花蛋",
        category: "ingredient",
        price: 7.0,
        emoji: "🥚",
        portion: "60g/只",
        nutrition: {
            calories: 102.0,
            carbs: 0.6,
            protein: 7.68,
            fat: {
                total: 2.7,
                unsaturated: 1.6,
                saturated: 1.1,
                trans: 0
            },
            water: 43.2,
            minerals: 240,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['protein', 'high-protein'],
        ingredientCategory: "protein",
        vitaminHighlights: "—",
        mineralHighlights: "—"
    },
    {
        id: 1067,
        name: "豆腐",
        category: "ingredient",
        price: 2.0,
        emoji: "🥛",
        portion: "50g/份",
        nutrition: {
            calories: 38.0,
            carbs: 1.0,
            protein: 4.1,
            fat: {
                total: 1.0,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0
            },
            water: 42.0,
            minerals: 223,  // 钠含量
            vitamins: 0.0  // 维生素含量
        },
        tags: ['protein', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1(少量)",
        mineralHighlights: "钙, 铁(少量)"
    },
    {
        id: 1068,
        name: "青豆/豌豆（熟）",
        category: "ingredient",
        price: 3.5,
        emoji: "🟢",
        portion: "50g/份",
        nutrition: {
            calories: 42.0,
            carbs: 7.5,
            protein: 2.7,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 39.0,
            minerals: 215,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'low-fat', 'low-calorie'],
        ingredientCategory: "protein",
        vitaminHighlights: "维B1, 叶酸",
        mineralHighlights: "钾, 镁"
    },
    {
        id: 1069,
        name: "绿豆（熟）",
        category: "ingredient",
        price: 3.0,
        emoji: "🟢",
        portion: "50g/份",
        nutrition: {
            calories: 52.0,
            carbs: 9.6,
            protein: 3.5,
            fat: {
                total: 0.1,
                unsaturated: 0.0,
                saturated: 0.0,
                trans: 0
            },
            water: 36.0,
            minerals: 217,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['protein', 'low-fat'],
        ingredientCategory: "protein",
        vitaminHighlights: "叶酸",
        mineralHighlights: "钾, 镁"
    },
    {
        id: 1070,
        name: "花生米",
        category: "ingredient",
        price: 2.0,
        emoji: "🥜",
        portion: "5g/份",
        nutrition: {
            calories: 29.0,
            carbs: 0.8,
            protein: 1.3,
            fat: {
                total: 1.0,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0
            },
            water: 0.1,
            minerals: 217,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['nuts-seeds', 'low-calorie'],
        ingredientCategory: "nuts-seeds",
        vitaminHighlights: "维E(少量), 维B3",
        mineralHighlights: "镁, 锌"
    },
    {
        id: 1071,
        name: "腰果",
        category: "ingredient",
        price: 5.0,
        emoji: "🌰",
        portion: "5g/份",
        nutrition: {
            calories: 28.0,
            carbs: 1.5,
            protein: 0.9,
            fat: {
                total: 0.9,
                unsaturated: 0.5,
                saturated: 0.4,
                trans: 0
            },
            water: 0.3,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['nuts-seeds', 'low-calorie'],
        ingredientCategory: "nuts-seeds",
        vitaminHighlights: "维B1(少量)",
        mineralHighlights: "镁, 锌"
    },
    {
        id: 1072,
        name: "芝麻",
        category: "ingredient",
        price: 2.0,
        emoji: "🌱",
        portion: "5g/份",
        nutrition: {
            calories: 28.0,
            carbs: 1.2,
            protein: 0.9,
            fat: {
                total: 1.0,
                unsaturated: 0.6,
                saturated: 0.4,
                trans: 0
            },
            water: 0.2,
            minerals: 216,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['nuts-seeds', 'low-calorie'],
        ingredientCategory: "nuts-seeds",
        vitaminHighlights: "维B1(少量)",
        mineralHighlights: "钙, 铁"
    },
    {
        id: 1073,
        name: "核桃",
        category: "ingredient",
        price: 5.0,
        emoji: "🌰",
        portion: "5g/份",
        nutrition: {
            calories: 33.0,
            carbs: 0.7,
            protein: 0.8,
            fat: {
                total: 1.3,
                unsaturated: 0.8,
                saturated: 0.5,
                trans: 0
            },
            water: 0.2,
            minerals: 218,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['nuts-seeds', 'low-calorie'],
        ingredientCategory: "nuts-seeds",
        vitaminHighlights: "维E(少量)",
        mineralHighlights: "镁, 锌, ω-3 ALA"
    },
    {
        id: 1074,
        name: "榛子",
        category: "ingredient",
        price: 6.0,
        emoji: "🌰",
        portion: "5g/份",
        nutrition: {
            calories: 31.0,
            carbs: 0.9,
            protein: 0.8,
            fat: {
                total: 1.2,
                unsaturated: 0.7,
                saturated: 0.5,
                trans: 0
            },
            water: 0.2,
            minerals: 217,  // 钠含量
            vitamins: 0  // 维生素含量
        },
        tags: ['nuts-seeds', 'low-calorie'],
        ingredientCategory: "nuts-seeds",
        vitaminHighlights: "维E",
        mineralHighlights: "镁, 锰"
    }
];

// 营养食堂应用类
class NutritionCafeteria {
    constructor() {
        this.budget = 999999; // 默认预算
        this.selectedCategory = 'all';
        this.cart = [];
        this.currentPage = 0; // 当前页码
        this.dishesPerPage = 9; // 每页显示9个菜品
        this.barChart = null; // 条形图实例
        this.pieChart = null; // 饼图实例
        
        // 新增分类相关属性
        this.mainCategory = 'ready-meals'; // 'ready-meals' 或 'custom-kitchen'
        
        // 油盐摄入量相关属性
        this.dailyOilRecommendation = 27.5; // 每日推荐油摄入量（克）25-30g的中值
        this.dailySaltRecommendation = 5; // 每日推荐盐摄入量（克）
        this.selectedCookingMethod = 'all';
        this.selectedBeverageCategory = 'all';
        this.selectedIngredientCategory = 'all'; // 食材分类过滤
        
        // 莫兰迪色系配色方案
        this.morandiColors = {
            primary: ['#D4B5A0', '#C8A882', '#B89B7F', '#A68B5B', '#8B7355', '#7A6B5D'],
            secondary: ['#B8C5D1', '#A4B5C4', '#8FA4B3', '#7A93A2', '#658291', '#507180'],
            light: ['#E8DDD4', '#E0D5C7', '#D8CDBA', '#D0C5AD', '#C8BDA0', '#C0B593'],
            dark: ['#6B5B4F', '#5D4E42', '#4F4135', '#413428', '#33271B', '#251A0E']
        };
        
        // 三餐监控系统
        this.dailyCalorieRange = { min: 1300, max: 2200 };
        this.mealTargets = {
            breakfast: {
                percentage: 30,
                min: Math.round(this.dailyCalorieRange.min * 0.3), // 390
                max: Math.round(this.dailyCalorieRange.max * 0.3)  // 660
            },
            lunch: {
                percentage: 40,
                min: Math.round(this.dailyCalorieRange.min * 0.4), // 520
                max: Math.round(this.dailyCalorieRange.max * 0.4)  // 880
            },
            dinner: {
                percentage: 30,
                min: Math.round(this.dailyCalorieRange.min * 0.3), // 390
                max: Math.round(this.dailyCalorieRange.max * 0.3)  // 660
            }
        };
        
        // 存储各餐次的食物记录
        this.mealRecords = {
            breakfast: [],
            lunch: [],
            dinner: []
        };
        
        // 当前选中的餐次和标签页
        this.currentMeal = 'breakfast';
        this.currentMealTab = 'breakfast';
        
        // 小厨房相关属性
        this.kitchenIngredients = []; // 临时存储选择的食材
        this.selectedCookingMethod = []; // 选中的烹饪方式数组
        this.primaryCookingMethod = null; // 主要烹饪方式（用于营养计算）
        
        this.init();
    }

    init() {
        this.renderBudgetSelector();
        this.renderMainCategorySelector();
        this.toggleCategorySections(); // 确保初始状态正确
        this.renderCategoryTabs();
        this.initCookingMethodSelector();
        this.initKitchenSection(); // 初始化小厨房功能
        this.renderDishes();
        this.updateCartDisplay();
        this.updateNutritionChart();
        this.updateSuggestions();
        this.initMealMonitoring();
    }

    renderBudgetSelector() {
        // 为预算选项按钮添加事件监听器 - 支持新的紧凑样式和原有样式
        const budgetOptions = document.querySelectorAll('.budget-option, .budget-option-compact');
        budgetOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                // 移除所有active类
                budgetOptions.forEach(opt => opt.classList.remove('active'));
                // 为当前点击的选项添加active类
                option.classList.add('active');
                // 更新预算值
                this.budget = parseInt(option.dataset.budget);
                // 更新预算进度表
                const totalPrice = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                this.updateBudgetProgress(totalPrice);
                // 更新按钮状态
                this.updateButtonStates();
                this.updateSuggestions();
            });
        });
    }

    renderMainCategorySelector() {
        // 为大分类选择器添加事件监听器
        const mainCategoryOptions = document.querySelectorAll('.main-category-option');
        mainCategoryOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                // 移除所有active类
                mainCategoryOptions.forEach(opt => opt.classList.remove('active'));
                // 为当前点击的选项添加active类
                option.classList.add('active');
                // 更新大分类
                this.mainCategory = option.dataset.mainCategory;
                // 显示/隐藏对应的分类区域
                this.toggleCategorySections();
                // 重置分类
                this.selectedCategory = 'all';
                this.selectedIngredientCategory = 'all';
                this.selectedCookingMethod = 'all';
                this.resetPagination();
                // 重新渲染相关组件
                this.renderCategoryTabs();
                this.renderDishes();
            });
        });

        // 初始化烹调方式选择器
        this.initCookingMethodSelector();
    }

    toggleCategorySections() {
        const readyMadeSection = document.getElementById('ready-meals-section');
        const selfServiceSection = document.getElementById('custom-kitchen-section');
        
        // 检查DOM元素是否存在，避免在测试页面中出错
        if (!readyMadeSection || !selfServiceSection) {
            return;
        }
        
        if (this.mainCategory === 'ready-meals') {
            readyMadeSection.classList.add('active');
            selfServiceSection.classList.remove('active');
        } else {
            readyMadeSection.classList.remove('active');
            selfServiceSection.classList.add('active');
        }
    }

    initCookingMethodSelector() {
        // 为烹调方式按钮添加事件监听器
        const cookingMethods = document.querySelectorAll('.cooking-method');
        cookingMethods.forEach(method => {
            method.addEventListener('click', (e) => {
                // 切换选中状态
                method.classList.toggle('selected');
                // 更新选中的烹调方式
                this.updateSelectedCookingMethods();
                // 重新渲染菜品
                this.resetPagination();
                this.renderDishes();
            });
        });

        // 为饮品区分类按钮添加事件监听器
        const beverageTabs = document.querySelectorAll('.beverage-categories .category-tab');
        beverageTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                // 移除其他按钮的激活状态
                beverageTabs.forEach(t => t.classList.remove('active'));
                // 激活当前按钮
                tab.classList.add('active');
                // 更新选中的饮品分类
                this.selectedBeverageCategory = tab.dataset.category || 'all';
                // 重新渲染菜品
                this.resetPagination();
                this.renderDishes();
            });
        });
    }

    updateSelectedCookingMethods() {
        const selectedMethods = document.querySelectorAll('.cooking-method.selected');
        const selectedMethodNames = Array.from(selectedMethods).map(method => method.textContent.trim());
        
        // 为了兼容现有代码，保持数组格式，但添加主要烹饪方式属性
        this.selectedCookingMethod = selectedMethodNames;
        // 设置主要烹饪方式（用于营养计算）
        this.primaryCookingMethod = selectedMethodNames.length > 0 ? selectedMethodNames[0] : null;
        
        // 实时更新营养预览
        this.updateKitchenNutritionPreview();
    }

    renderKitchenCookingMethods() {
        const container = document.getElementById('kitchen-cooking-methods');
        if (!container) return;

        // 清空容器
        container.innerHTML = '';

        // 从NUTRITION_DATA获取烹调方式数据
        if (typeof NUTRITION_DATA !== 'undefined' && NUTRITION_DATA.cooking_methods && NUTRITION_DATA.cooking_methods.categories && NUTRITION_DATA.cooking_methods.methods) {
            const categories = NUTRITION_DATA.cooking_methods.categories;
            const methods = NUTRITION_DATA.cooking_methods.methods;
            
            // 按分类组织方法
            categories.forEach((category, categoryIndex) => {
                // 获取该分类下的所有方法
                const categoryMethods = methods.filter(method => method.category_id === category.id);
                
                if (categoryMethods.length > 0) {
                    // 创建分类标题
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'cooking-category-title';
                    categoryTitle.textContent = category.name_zh;
                    container.appendChild(categoryTitle);
                    
                    // 创建方法网格
                    const methodsGrid = document.createElement('div');
                    methodsGrid.className = 'cooking-methods-grid';
                    
                    // 添加该分类下的所有烹调方式
                    categoryMethods.forEach((method, methodIndex) => {
                        const methodElement = document.createElement('div');
                        methodElement.className = 'cooking-method';
                        methodElement.setAttribute('data-method', method.id);
                        methodElement.setAttribute('title', method.notes_zh || '');
                        methodElement.textContent = method.name_zh;
                        
                        // 不设置默认选中状态，保持初始状态为未选择
                        
                        methodsGrid.appendChild(methodElement);
                    });
                    
                    container.appendChild(methodsGrid);
                }
            });
        } else {
            // 如果没有数据，使用默认的简单选项
            const defaultMethods = [
                { key: 'stir-fry', name: '炒' },
                { key: 'steam', name: '蒸' },
                { key: 'cold-mix', name: '拌' }
            ];
            
            const methodsGrid = document.createElement('div');
            methodsGrid.className = 'cooking-methods-grid';
            
            defaultMethods.forEach((method, index) => {
                const methodElement = document.createElement('div');
                methodElement.className = 'cooking-method';
                methodElement.setAttribute('data-method', method.key);
                methodElement.textContent = method.name;
                
                methodsGrid.appendChild(methodElement);
            });
            
            container.appendChild(methodsGrid);
        }
    }

    initKitchenSection() {
        // 渲染烹饪方式选择器
        this.renderKitchenCookingMethods();
        
        // 初始化烹饪方式选择器事件监听
        const container = document.getElementById('kitchen-cooking-methods');
        if (container) {
            container.addEventListener('click', (e) => {
                if (e.target.classList.contains('cooking-method')) {
                    // 移除其他选中状态
                    container.querySelectorAll('.cooking-method').forEach(m => m.classList.remove('active'));
                    // 添加当前选中状态
                    e.target.classList.add('active');
                    // 更新选中的烹饪方式
                    const methodName = e.target.textContent.trim();
                    this.selectedCookingMethod = [methodName];
                    this.primaryCookingMethod = methodName;
                    // 更新显示
                    this.updateKitchenDisplay();
                }
            });
        }

        // 初始化合成按钮
        const synthesizeBtn = document.getElementById('synthesize-dish-btn');
        if (synthesizeBtn) {
            synthesizeBtn.addEventListener('click', () => {
                this.synthesizeDish();
            });
        }
    }

    synthesizeDish() {
        if (this.kitchenIngredients.length === 0) {
            alert('请先选择食材！');
            return;
        }

        // 计算合成菜品的营养和价格
        let totalNutrition = {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: { total: 0, unsaturated: 0, saturated: 0, trans: 0 },
            water: 0,
            minerals: 0,
            vitamins: 0  // 维生素含量
        };
        let totalPrice = 0;
        let ingredientNames = [];

        this.kitchenIngredients.forEach(item => {
            const ingredient = ingredientsData.find(ing => ing.id === item.id);
            if (ingredient) {
                // 累加营养成分
                totalNutrition.calories += ingredient.nutrition.calories * item.quantity;
                totalNutrition.carbs += ingredient.nutrition.carbs * item.quantity;
                totalNutrition.protein += ingredient.nutrition.protein * item.quantity;
                totalNutrition.fat.total += ingredient.nutrition.fat.total * item.quantity;
                totalNutrition.fat.unsaturated += ingredient.nutrition.fat.unsaturated * item.quantity;
                totalNutrition.fat.saturated += ingredient.nutrition.fat.saturated * item.quantity;
                totalNutrition.fat.trans += ingredient.nutrition.fat.trans * item.quantity;
                totalNutrition.water += ingredient.nutrition.water * item.quantity;
                totalNutrition.minerals += ingredient.nutrition.minerals * item.quantity;
                totalNutrition.vitamins += ingredient.nutrition.vitamins * item.quantity;
                
                // 累加价格
                totalPrice += ingredient.price * item.quantity;
                
                // 收集食材名称
                if (item.quantity > 1) {
                    ingredientNames.push(`${ingredient.name}×${item.quantity}`);
                } else {
                    ingredientNames.push(ingredient.name);
                }
            }
        });

        // 根据烹饪方式调整营养成分 - 使用科学的营养影响算法
        // 计算总的食材份量（基于实际重量）
        let totalIngredientPortion = 0;
        this.kitchenIngredients.forEach(item => {
            const ingredient = ingredientsData.find(d => d.id === item.id);
            if (ingredient && ingredient.portion) {
                // 从 "150g/份" 格式中提取重量
                const portionMatch = ingredient.portion.match(/(\d+)g/);
                if (portionMatch) {
                    totalIngredientPortion += parseInt(portionMatch[1]) * item.quantity;
                }
            }
        });
        
        // 使用主要烹饪方式进行营养计算
        const cookingMethodForCalculation = this.primaryCookingMethod || '';
        const adjustedNutrition = this.calculateNutritionWithCookingMethod(totalNutrition, cookingMethodForCalculation, totalIngredientPortion);
        totalNutrition = adjustedNutrition;

        // 创建合成菜品对象
        const dishName = this.primaryCookingMethod ? `${this.primaryCookingMethod}${ingredientNames.join('')}` : `${ingredientNames.join('')}`;
        const synthesizedDish = {
            id: Date.now(), // 使用时间戳作为唯一ID
            name: dishName,
            category: 'custom',
            price: Math.round(totalPrice * 10) / 10,
            emoji: this.getCookingEmoji(this.primaryCookingMethod || ''),
            portion: '自制/份',
            nutrition: totalNutrition,
            tags: ['自制菜品'],
            isCustom: true
        };

        // 先清空小厨房，避免重复计算
        this.kitchenIngredients = [];
        
        // 然后添加到购物车
        this.addToCart(synthesizedDish.id, synthesizedDish);
        
        // 重置烹饪方式选择
        this.resetCookingMethodSelection();
        
        this.updateKitchenDisplay();

        // 显示成功消息
        alert(`成功合成：${synthesizedDish.name}！已添加到餐盘中。`);
    }

    getCookingEmoji(cookingMethod) {
        const emojiMap = {
            '炒': '🍳',
            '蒸': '🥟',
            '煮': '🍲',
            '凉拌': '🥗'
        };
        return emojiMap[cookingMethod] || '🍽️';
    }

    // 重置烹饪方式选择状态
    resetCookingMethodSelection() {
        // 重置内部状态
        this.selectedCookingMethod = [];
        this.primaryCookingMethod = null;
        
        // 重置UI状态 - 移除所有按钮的active类
        const cookingMethodButtons = document.querySelectorAll('.cooking-method');
        cookingMethodButtons.forEach(button => {
            button.classList.remove('active');
        });
        
        // 更新营养预览（移除烹饪方式效果）
        this.updateKitchenNutritionPreview();
    }

    // 根据烹调方式科学计算营养成分
    calculateNutritionWithCookingMethod(baseNutrition, cookingMethodName, ingredientPortion = null) {
        // 检查NUTRITION_DATA是否可用
        if (!window.NUTRITION_DATA || !window.NUTRITION_DATA.cooking_methods) {
            console.warn('NUTRITION_DATA not available, using fallback calculation');
            return this.fallbackNutritionCalculation(baseNutrition, cookingMethodName);
        }

        // 查找对应的烹调方式数据
        const cookingMethod = this.findCookingMethodByName(cookingMethodName);
        if (!cookingMethod) {
            console.warn(`Cooking method "${cookingMethodName}" not found, using fallback`);
            return this.fallbackNutritionCalculation(baseNutrition, cookingMethodName);
        }

        // 创建调整后的营养数据副本
        const adjustedNutrition = JSON.parse(JSON.stringify(baseNutrition));

        // 计算份量比例（烹调方式数据基于100g，需要根据实际份量调整）
        // ingredientPortion 是总重量（克），需要转换为基于100g的比例
        let portionRatio = 1; // 默认比例为1（相当于100g）
        if (ingredientPortion && typeof ingredientPortion === 'number') {
            // 如果传入的是数字（总重量），直接计算比例
            portionRatio = ingredientPortion / 100;
        } else if (ingredientPortion && typeof ingredientPortion === 'string') {
            // 如果传入的是字符串格式（如"150g"），提取数字
            const weightMatch = ingredientPortion.match(/(\d+)/);
            if (weightMatch) {
                portionRatio = parseInt(weightMatch[1]) / 100;
            }
        }

        // 应用科学的营养影响算法
        // 1. 能量计算：基础能量 + (烹调方式增量 × 份量比例)
        adjustedNutrition.calories = Math.round(baseNutrition.calories + (cookingMethod.delta_kcal * portionRatio));

        // 2. 蛋白质计算：基础蛋白质 × 保留率
        adjustedNutrition.protein = Math.round(baseNutrition.protein * cookingMethod.protein_retention * 10) / 10;

        // 3. 脂肪计算：基础脂肪 + (烹调方式增量 × 份量比例)
        adjustedNutrition.fat.total = Math.round((baseNutrition.fat.total + (cookingMethod.delta_fat_g * portionRatio)) * 10) / 10;
        // 按比例调整脂肪子类型
        const fatRatio = adjustedNutrition.fat.total / (baseNutrition.fat.total || 1);
        adjustedNutrition.fat.unsaturated = Math.round(baseNutrition.fat.unsaturated * fatRatio * 10) / 10;
        adjustedNutrition.fat.saturated = Math.round(baseNutrition.fat.saturated * fatRatio * 10) / 10;
        adjustedNutrition.fat.trans = Math.round(baseNutrition.fat.trans * fatRatio * 10) / 10;

        // 4. 碳水化合物计算：基础碳水 + (烹调方式增量 × 份量比例)
        adjustedNutrition.carbs = Math.round((baseNutrition.carbs + (cookingMethod.delta_carbs_g * portionRatio)) * 10) / 10;

        // 5. 水分计算：基础水分 + (烹调方式增量 × 份量比例)
        adjustedNutrition.water = Math.round(baseNutrition.water + (cookingMethod.delta_water_g * portionRatio));

        // 6. 矿物质计算：基础矿物质 × 保留率
        adjustedNutrition.minerals = Math.round(baseNutrition.minerals * cookingMethod.mineral_retention);

        // 7. 维生素计算：基础维生素 × 保留率（维生素对热敏感，通常比矿物质损失更多）
        // 维生素保留率 = 矿物质保留率 × 0.9（维生素对热更敏感）
        const vitaminRetention = cookingMethod.mineral_retention * 0.9;
        adjustedNutrition.vitamins = Math.round(baseNutrition.vitamins * vitaminRetention);

        return adjustedNutrition;
    }

    // 根据中文名称查找烹调方式数据
    findCookingMethodByName(cookingMethodName) {
        if (!window.NUTRITION_DATA || !window.NUTRITION_DATA.cooking_methods) {
            return null;
        }

        const methods = window.NUTRITION_DATA.cooking_methods.methods;
        
        // 首先尝试精确匹配
        let method = methods.find(method => method.name_zh === cookingMethodName);
        
        // 如果精确匹配失败，尝试部分匹配（用于处理"煮"匹配"煮/汆/焯"的情况）
        if (!method) {
            method = methods.find(method => {
                // 检查是否包含目标名称，或者目标名称是否包含在方法名称中
                return method.name_zh.includes(cookingMethodName) || 
                       cookingMethodName.includes(method.name_zh.split('/')[0]);
            });
        }
        
        return method;
    }

    // 备用营养计算方法（当NUTRITION_DATA不可用时）
    fallbackNutritionCalculation(baseNutrition, cookingMethodName) {
        const adjustedNutrition = JSON.parse(JSON.stringify(baseNutrition));
        
        // 简化的备用计算
        const fallbackMultipliers = {
            '炒': { calories: 1.2, fat: 1.3, vitamins: 0.8 },
            '蒸': { calories: 1.0, fat: 1.0, vitamins: 0.9 },
            '煮': { calories: 1.0, fat: 1.0, vitamins: 0.7, water: 1.2 },
            '凉拌': { calories: 1.0, fat: 1.1, vitamins: 1.0 }
        };

        const multiplier = fallbackMultipliers[cookingMethodName] || fallbackMultipliers['炒'];
        adjustedNutrition.calories = Math.round(baseNutrition.calories * (multiplier.calories || 1));
        adjustedNutrition.fat.total = Math.round(baseNutrition.fat.total * (multiplier.fat || 1) * 10) / 10;
        adjustedNutrition.vitamins = Math.round(baseNutrition.vitamins * (multiplier.vitamins || 1));
        if (multiplier.water) {
            adjustedNutrition.water = Math.round(baseNutrition.water * multiplier.water);
        }

        return adjustedNutrition;
    }

    // 更新小厨房营养预览
    updateKitchenNutritionPreview() {
        const previewContainer = document.getElementById('kitchen-nutrition-preview');
        const caloriesElement = document.getElementById('preview-calories');
        const proteinElement = document.getElementById('preview-protein');
        const fatElement = document.getElementById('preview-fat');
        const carbsElement = document.getElementById('preview-carbs');

        // 检查是否有选中的食材
        if (!this.kitchenIngredients || this.kitchenIngredients.length === 0) {
            previewContainer.style.display = 'none';
            return;
        }

        // 计算基础营养值
        let totalNutrition = {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: { total: 0, unsaturated: 0, saturated: 0, trans: 0 },
            water: 0,
            minerals: 0,
            vitamins: 0  // 维生素含量
        };

        // 累加所有选中食材的营养值
        this.kitchenIngredients.forEach(item => {
            const ingredient = ingredientsData.find(ing => ing.id === item.id);
            if (ingredient) {
                totalNutrition.calories += ingredient.nutrition.calories * item.quantity;
                totalNutrition.carbs += ingredient.nutrition.carbs * item.quantity;
                totalNutrition.protein += ingredient.nutrition.protein * item.quantity;
                totalNutrition.fat.total += ingredient.nutrition.fat.total * item.quantity;
                totalNutrition.fat.unsaturated += ingredient.nutrition.fat.unsaturated * item.quantity;
                totalNutrition.fat.saturated += ingredient.nutrition.fat.saturated * item.quantity;
                totalNutrition.fat.trans += ingredient.nutrition.fat.trans * item.quantity;
                totalNutrition.water += ingredient.nutrition.water * item.quantity;
                totalNutrition.minerals += ingredient.nutrition.minerals * item.quantity;
                totalNutrition.vitamins += ingredient.nutrition.vitamins * item.quantity;
            }
        });

        // 如果选择了烹调方式，应用烹调方式的影响
        if (this.primaryCookingMethod) {
            // 计算总的食材份量（基于实际重量）
            let totalIngredientPortion = 0;
            this.kitchenIngredients.forEach(item => {
                const ingredient = ingredientsData.find(ing => ing.id === item.id);
                if (ingredient && ingredient.portion) {
                    // 从 "10g/份" 格式中提取重量
                    const portionMatch = ingredient.portion.match(/(\d+)g/);
                    if (portionMatch) {
                        totalIngredientPortion += parseInt(portionMatch[1]) * item.quantity;
                    }
                }
            });
            
            totalNutrition = this.calculateNutritionWithCookingMethod(totalNutrition, this.primaryCookingMethod, totalIngredientPortion);
        }

        // 更新显示
        caloriesElement.textContent = `${Math.round(totalNutrition.calories)} 千卡`;
        proteinElement.textContent = `${Math.round(totalNutrition.protein * 10) / 10} 克`;
        fatElement.textContent = `${Math.round(totalNutrition.fat.total * 10) / 10} 克`;
        carbsElement.textContent = `${Math.round(totalNutrition.carbs * 10) / 10} 克`;

        // 显示预览区域
        previewContainer.style.display = 'block';
    }

    renderCategoryTabs() {
        // 为成品大锅菜渲染分类标签
        if (this.mainCategory === 'ready-meals') {
            const categoryTabs = document.getElementById('ready-category-tabs');
            if (!categoryTabs) return;

            const categories = [
                { id: 'all', name: '全部', emoji: '🍽️' },
                { id: 'top20', name: 'Top20', emoji: '🏆' },
                { id: 'staple', name: '主食', emoji: '🍚' },
                { id: 'main', name: '主菜', emoji: '🍖' },
                { id: 'side', name: '配菜', emoji: '🥬' },
                { id: 'soup', name: '汤品', emoji: '🍲' },
                { id: 'drinks', name: '饮品', emoji: '🥤' },
                { id: 'snacks', name: '小吃', emoji: '🍿' }
            ];

            categoryTabs.innerHTML = categories.map(category => `
                <div class="category-tab ${this.selectedCategory === category.id ? 'active' : ''}" 
                     data-category="${category.id}">
                    ${category.emoji} ${category.name}
                </div>
            `).join('');

            // 为成品大锅菜的按钮添加事件监听器
            const tabButtons = categoryTabs.querySelectorAll('.category-tab');
            tabButtons.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.selectedCategory = tab.dataset.category;
                    this.resetPagination();
                    this.renderCategoryTabs();
                    this.renderDishes();
                    this.updateButtonStates();
                });
            });
        }
        // 为精品自助小厨房渲染食材分类标签
        else if (this.mainCategory === 'custom-kitchen') {
            const ingredientCategories = [
                { id: 'all', name: '全部', emoji: '🍽️' },
                { id: 'dairy', name: '乳制品类', emoji: '🥛' },
                { id: 'vegetables', name: '蔬菜类', emoji: '🥬' },
                { id: 'fruits', name: '水果类', emoji: '🍎' },
                { id: 'whole-grains', name: '全谷杂粮类', emoji: '🌾' },
                { id: 'protein', name: '豆鱼蛋肉类', emoji: '🥩' },
                { id: 'nuts-seeds', name: '坚果种子类', emoji: '🥜' }
            ];

            // 查找分类标签容器
            const categoryTabsContainer = document.getElementById('ingredient-category-tabs');
            if (!categoryTabsContainer) return;

            categoryTabsContainer.innerHTML = ingredientCategories.map(category => `
                <div class="category-tab ${this.selectedIngredientCategory === category.id ? 'active' : ''}"
                     data-ingredient-category="${category.id}">
                    ${category.emoji} ${category.name}
                </div>
            `).join('');

            // 为食材分类按钮添加事件监听器
            const ingredientTabButtons = categoryTabsContainer.querySelectorAll('.category-tab');
            ingredientTabButtons.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.selectedIngredientCategory = tab.dataset.ingredientCategory;
                    this.resetPagination();
                    this.renderCategoryTabs();
                    this.renderDishes();
                    this.updateButtonStates();
                });
            });
        }
    }



    getFilteredDishes() {
        let filtered = dishesData;

        // 根据主分类筛选
        if (this.mainCategory === 'ready-meals') {
            // 成品大锅菜的分类筛选
            if (this.selectedCategory !== 'all') {
                if (this.selectedCategory === 'top20') {
                    // Top20菜品列表
                    const top20Names = [
                        "西红柿炒蛋", "青菜", "醋溜土豆丝", "炸鸡", "紫菜蛋花汤",
                        "红烧肉圆", "青椒肉丝", "西红柿蛋花汤", "小米南瓜粥", "罗宋汤",
                        "白米饭", "干锅花菜", "蛋炒饭", "虾仁炒蛋", "牛排",
                        "麻婆豆腐", "白切鸡", "馄饨", "蒸蛋", "鸡汤"
                    ];
                    // 按指定顺序排序
                    filtered = filtered.filter(dish => top20Names.includes(dish.name))
                        .sort((a, b) => top20Names.indexOf(a.name) - top20Names.indexOf(b.name));
                } else if (this.selectedCategory === 'drinks') {
                    // 饮品分类 - 这里可以根据需要添加饮品数据
                    filtered = filtered.filter(dish => dish.category === 'drinks');
                } else {
                    filtered = filtered.filter(dish => dish.category === this.selectedCategory);
                }
            }
        } else if (this.mainCategory === 'custom-kitchen') {
            // 精品自助小厨房模式 - 显示食材数据
            filtered = ingredientsData;
            
            // 根据食材分类过滤
            if (this.selectedIngredientCategory !== 'all') {
                filtered = filtered.filter(ingredient => 
                    ingredient.ingredientCategory === this.selectedIngredientCategory
                );
            }
        }

        return filtered;
    }

    renderDishes() {
        // 根据mainCategory选择正确的grid元素
        const gridId = this.mainCategory === 'ready-meals' ? 'readyMealsGrid' : 'menuGrid';
        const dishesGrid = document.getElementById(gridId);
        
        // 如果找不到grid元素，直接返回（测试环境中可能不存在）
        if (!dishesGrid) {
            return;
        }
        
        const filteredDishes = this.getFilteredDishes();
        
        const startIndex = this.currentPage * this.dishesPerPage;
        const endIndex = startIndex + this.dishesPerPage;
        const dishesToShow = filteredDishes.slice(startIndex, endIndex);

        // Top20菜品列表
        const top20Names = [
            "西红柿炒蛋", "青菜", "醋溜土豆丝", "炸鸡", "紫菜蛋花汤",
            "红烧肉圆", "青椒肉丝", "西红柿蛋花汤", "小米南瓜粥", "罗宋汤",
            "白米饭", "干锅花菜", "蛋炒饭", "虾仁炒蛋", "牛排",
            "麻婆豆腐", "白切鸡", "馄饨", "蒸蛋", "鸡汤"
        ];

        dishesGrid.innerHTML = dishesToShow.map(item => {
            // 判断是菜品还是食材
            const isIngredient = item.id >= 1001; // 食材ID从1001开始
            const isTop20 = !isIngredient && top20Names.includes(item.name);
            
            if (isIngredient) {
                // 渲染食材卡片
                return `
                <div class="dish-card ingredient-card" data-dish-id="${item.id}">
                    <div class="ingredient-badge">🥬 食材</div>
                    <div class="dish-emoji">${item.emoji}</div>
                    <div class="dish-info">
                        <h3 class="dish-name">${item.name}</h3>
                        <p class="dish-portion">${item.portion}</p>
                        <div class="dish-price">¥${item.price}</div>
                        

                        
                        <div class="macronutrients">
                            <h4 class="macro-title">营养成分（每${item.portion}）</h4>
                            <div class="macro-item">
                                <span class="macro-label">能量</span>
                                <span class="macro-value">${item.nutrition.calories}卡</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">碳水化合物</span>
                                <span class="macro-value">${item.nutrition.carbs}g</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">蛋白质</span>
                                <span class="macro-value">${item.nutrition.protein}g</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">脂质</span>
                                <span class="macro-value">${item.nutrition.fat.total}g</span>
                            </div>
                        </div>
                        
                        ${item.vitaminHighlights ? `
                        <div class="vitamin-highlights">
                            <h5>维生素亮点</h5>
                            <div class="highlights-list">
                                ${(typeof item.vitaminHighlights === 'string' ? 
                                    item.vitaminHighlights.split(', ') : 
                                    item.vitaminHighlights
                                ).map(vitamin => `<span class="highlight-tag vitamin">${vitamin}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${item.mineralHighlights ? `
                        <div class="mineral-highlights">
                            <h5>矿物质亮点</h5>
                            <div class="highlights-list">
                                ${(typeof item.mineralHighlights === 'string' ? 
                                    item.mineralHighlights.split(', ') : 
                                    item.mineralHighlights
                                ).map(mineral => `<span class="highlight-tag mineral">${mineral}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="dish-tags">
                            ${item.tags.map(tag => `<span class="tag">${this.getTagName(tag)}</span>`).join('')}
                        </div>
                    </div>
                    <button class="add-btn" onclick="app.addToKitchen(${item.id})" id="btn-${item.id}">
                        <span class="add-icon">+</span>
                        <span class="add-text">加入小厨房</span>
                    </button>
                </div>
                `;
            } else {
                // 渲染菜品卡片（原有逻辑）
                return `
                <div class="dish-card" data-dish-id="${item.id}">
                    ${isTop20 ? '<div class="top20-badge">🏆 Top20</div>' : ''}
                    <div class="dish-emoji">${item.emoji}</div>
                    <div class="dish-info">
                        <h3 class="dish-name">${item.name}</h3>
                        <p class="dish-portion">${item.portion}</p>
                        <div class="dish-price">¥${item.price}</div>
                        
                        <div class="macronutrients">
                            <h4 class="macro-title">宏量营养素分布</h4>
                            <div class="macro-item">
                                <span class="macro-label">能量</span>
                                <span class="macro-value">${item.nutrition.calories}卡</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">碳水化合物</span>
                                <span class="macro-value">${item.nutrition.carbs}g</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">蛋白质</span>
                                <span class="macro-value">${item.nutrition.protein}g</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-label">脂质</span>
                                <span class="macro-value">${item.nutrition.fat.total}g</span>
                            </div>
                        </div>
                        
                        <div class="dish-tags">
                            ${item.tags.map(tag => `<span class="tag">${this.getTagName(tag)}</span>`).join('')}
                        </div>
                    </div>
                    <button class="add-btn" onclick="app.addToCart(${item.id})" id="btn-${item.id}">
                        <span class="add-icon">+</span>
                        <span class="add-text">加入餐盘</span>
                    </button>
                </div>
                `;
            }
        }).join('');
        
        this.renderPagination(filteredDishes.length);
        this.updateButtonStates();
    }

    updateButtonStates() {
        const totalPrice = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const remainingBudget = this.budget - totalPrice;
        
        // 获取当前页面显示的所有菜品按钮
        const buttons = document.querySelectorAll('.add-btn');
        buttons.forEach(button => {
            const dishId = parseInt(button.id.replace('btn-', ''));
            const dish = dishesData.find(d => d.id === dishId);
            
            if (dish) {
                const addIcon = button.querySelector('.add-icon');
                const addText = button.querySelector('.add-text');
                
                // 如果是无限制预算或预算充足
                if (this.budget === 999999 || remainingBudget >= dish.price) {
                    // 预算充足
                    button.disabled = false;
                    button.classList.remove('budget-insufficient');
                    addText.textContent = '加入餐盘';
                } else {
                    // 预算不足
                    button.disabled = true;
                    button.classList.add('budget-insufficient');
                    addText.textContent = '预算不足';
                }
            }
        });
    }

    renderPagination(totalDishes) {
        const totalPages = Math.ceil(totalDishes / this.dishesPerPage);
        // 根据mainCategory选择正确的分页容器
        const paginationId = this.mainCategory === 'custom-kitchen' ? 'customKitchenPagination' : 'pagination';
        const paginationContainer = document.getElementById(paginationId);
        
        if (totalPages <= 1) {
            paginationContainer.innerHTML = '';
            return;
        }

        let paginationHTML = '<div class="pagination-controls">';
        
        // 上一页按钮
        if (this.currentPage > 0) {
            paginationHTML += `<button class="pagination-btn" onclick="app.goToPage(${this.currentPage - 1})">‹ 上一页</button>`;
        }
        
        // 页码按钮
        for (let i = 0; i < totalPages; i++) {
            const isActive = i === this.currentPage ? 'active' : '';
            paginationHTML += `<button class="pagination-btn page-number ${isActive}" onclick="app.goToPage(${i})">${i + 1}</button>`;
        }
        
        // 下一页按钮
        if (this.currentPage < totalPages - 1) {
            paginationHTML += `<button class="pagination-btn" onclick="app.goToPage(${this.currentPage + 1})">下一页 ›</button>`;
        }
        
        paginationHTML += '</div>';
        paginationContainer.innerHTML = paginationHTML;
    }

    goToPage(pageNumber) {
        this.currentPage = pageNumber;
        this.renderDishes();
    }

    resetPagination() {
        this.currentPage = 0;
    }

    getTagName(tag) {
        const tagNames = {
            'low-fat': '低脂',
            'high-protein': '高蛋白',
            'high-fiber': '高纤维',
            'low-calorie': '低卡',
            'high-fat': '高脂',
            'high-vitamin': '高维生素'
        };
        return tagNames[tag] || tag;
    }

    getAllMealsPrice() {
        // 计算所有餐次的总价格
        let totalPrice = 0;
        
        // 计算各餐次的价格
        Object.keys(this.mealRecords).forEach(meal => {
            totalPrice += this.mealRecords[meal].reduce((sum, item) => sum + (item.price * item.quantity), 0);
        });
        
        // 加上全局购物车的价格（如果有的话）
        totalPrice += this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        return totalPrice;
    }

    addToCart(dishId, customDish = null) {
        // 如果提供了自定义菜品，使用它；否则从数据中查找
        let dish = customDish;
        if (!dish) {
            // 先从菜品数据中查找，如果没找到再从食材数据中查找
            dish = dishesData.find(d => d.id === dishId);
            if (!dish) {
                dish = ingredientsData.find(d => d.id === dishId);
            }
        }
        
        if (dish) {
            // 计算所有餐次的总价格
            const totalPrice = this.getAllMealsPrice();
            const remainingBudget = this.budget - totalPrice;
            
            // 检查预算是否足够
            if (remainingBudget >= dish.price) {
                // 直接添加到当前餐次，而不是全局购物车
                if (this.currentMeal && this.currentMeal !== 'total') {
                    const existingItem = this.mealRecords[this.currentMeal].find(item => item.id === dishId);
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        this.mealRecords[this.currentMeal].push({ 
                            ...dish, 
                            quantity: 1, 
                            mealType: this.currentMeal 
                        });
                    }
                } else {
                    // 如果没有选择餐次，添加到全局购物车
                    const existingItem = this.cart.find(item => item.id === dishId);
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        this.cart.push({ ...dish, quantity: 1 });
                    }
                }
                
                this.updateCartDisplay();
                this.updateNutritionChart();
                this.updateSuggestions();
                this.updateButtonStates();
                this.updateMealMonitoring();
            }
        }
    }

    addToKitchen(ingredientId) {
        // 从食材数据中查找
        const ingredient = ingredientsData.find(d => d.id === ingredientId);
        
        if (ingredient) {
            // 检查是否已经在小厨房中
            const existingItem = this.kitchenIngredients.find(item => item.id === ingredientId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                this.kitchenIngredients.push({ 
                    ...ingredient, 
                    quantity: 1 
                });
            }
            
            // 更新小厨房显示
            this.updateKitchenDisplay();
            // 更新营养预览
            this.updateKitchenNutritionPreview();
        }
    }

    removeFromKitchen(ingredientId) {
        const itemIndex = this.kitchenIngredients.findIndex(item => item.id === ingredientId);
        if (itemIndex !== -1) {
            if (this.kitchenIngredients[itemIndex].quantity > 1) {
                this.kitchenIngredients[itemIndex].quantity -= 1;
            } else {
                this.kitchenIngredients.splice(itemIndex, 1);
            }
            this.updateKitchenDisplay();
            // 更新营养预览
            this.updateKitchenNutritionPreview();
        }
    }

    updateKitchenDisplay() {
        const kitchenList = document.getElementById('kitchen-ingredients-list');
        const synthesizeBtn = document.getElementById('synthesize-dish-btn');
        
        if (!kitchenList) return;
        
        if (this.kitchenIngredients.length === 0) {
            kitchenList.innerHTML = `
                <div class="empty-kitchen">
                    <p>🥬 还没有选择食材，去选菜区挑选吧！</p>
                </div>
            `;
            if (synthesizeBtn) {
                synthesizeBtn.disabled = true;
                synthesizeBtn.textContent = '✨ 合成成品菜';
            }
        } else {
            kitchenList.innerHTML = this.kitchenIngredients.map(ingredient => `
                <div class="kitchen-ingredient-item">
                    <div class="ingredient-info">
                        <span class="ingredient-emoji">${ingredient.emoji}</span>
                        <span class="ingredient-name">${ingredient.name}</span>
                        <span class="ingredient-price">¥${ingredient.price}</span>
                    </div>
                    <div class="ingredient-controls">
                        <button class="quantity-btn" onclick="app.removeFromKitchen(${ingredient.id})">-</button>
                        <span class="quantity">${ingredient.quantity}</span>
                        <button class="quantity-btn" onclick="app.addToKitchen(${ingredient.id})">+</button>
                    </div>
                </div>
            `).join('');
            
            if (synthesizeBtn) {
                synthesizeBtn.disabled = false;
                const totalPrice = this.kitchenIngredients.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                synthesizeBtn.textContent = `✨ 合成成品菜 (¥${totalPrice.toFixed(1)})`;
            }
        }
    }

    removeFromCart(dishId) {
        // 如果有选择的餐次，从当前餐次中移除
        if (this.currentMeal && this.currentMeal !== 'total') {
            const mealItemIndex = this.mealRecords[this.currentMeal].findIndex(item => item.id === dishId);
            if (mealItemIndex > -1) {
                if (this.mealRecords[this.currentMeal][mealItemIndex].quantity > 1) {
                    this.mealRecords[this.currentMeal][mealItemIndex].quantity -= 1;
                } else {
                    this.mealRecords[this.currentMeal].splice(mealItemIndex, 1);
                }
            }
        } else {
            // 如果没有选择餐次，从全局购物车中移除
            const itemIndex = this.cart.findIndex(item => item.id === dishId);
            if (itemIndex > -1) {
                if (this.cart[itemIndex].quantity > 1) {
                    this.cart[itemIndex].quantity -= 1;
                } else {
                    this.cart.splice(itemIndex, 1);
                }
            }
        }
        
        this.updateCartDisplay();
        this.updateNutritionChart();
        this.updateSuggestions();
        this.updateButtonStates();
        this.updateMealMonitoring();
    }

    updateCartDisplay() {
        const cartItems = document.getElementById('cart-items');
        
        // 获取所有三餐的累计食材
        const allItems = this.getAllMealsItems();
        
        // 计算总价格（使用已有的getAllMealsPrice方法）
        const totalPrice = this.getAllMealsPrice();
        
        const totalPriceElement = document.getElementById('total-price');
        if (totalPriceElement) {
            totalPriceElement.textContent = `¥${totalPrice.toFixed(1)}`;
        }

        if (cartItems) {
            if (allItems.length === 0) {
                cartItems.innerHTML = '<p class="empty-cart">还没有选择菜品</p>';
            } else {
                cartItems.innerHTML = allItems.map(item => `
                    <div class="cart-item">
                        <span class="item-emoji">${item.emoji}</span>
                        <div class="item-info">
                            <span class="item-name">${item.name}</span>
                            <span class="item-price">¥${item.price} × ${item.quantity}</span>
                            ${item.mealTypes ? `<span class="meal-tags">${item.mealTypes.map(meal => this.getMealDisplayName(meal)).join('、')}</span>` : ''}
                        </div>
                        <div class="quantity-controls">
                            <button onclick="app.removeFromCart(${item.id})">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="app.addToCart(${item.id})">+</button>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // 更新预算进度表
        this.updateBudgetProgress(totalPrice);
    }

    // 新增方法：获取所有三餐的累计食材
    getAllMealsItems() {
        const itemsMap = new Map();
        
        // 遍历所有餐次的记录
        ['breakfast', 'lunch', 'dinner'].forEach(mealType => {
            if (this.mealRecords[mealType]) {
                this.mealRecords[mealType].forEach(item => {
                    const key = item.id;
                    if (itemsMap.has(key)) {
                        // 如果已存在该食材，累加数量并记录餐次
                        const existingItem = itemsMap.get(key);
                        existingItem.quantity += item.quantity;
                        if (!existingItem.mealTypes.includes(mealType)) {
                            existingItem.mealTypes.push(mealType);
                        }
                    } else {
                        // 如果不存在，创建新记录
                        itemsMap.set(key, {
                            ...item,
                            mealTypes: [mealType]
                        });
                    }
                });
            }
        });
        
        // 添加全局购物车中的食材
        this.cart.forEach(item => {
            const key = item.id;
            if (itemsMap.has(key)) {
                const existingItem = itemsMap.get(key);
                existingItem.quantity += item.quantity;
                if (!existingItem.mealTypes.includes('general')) {
                    existingItem.mealTypes.push('general');
                }
            } else {
                itemsMap.set(key, {
                    ...item,
                    mealTypes: ['general']
                });
            }
        });
        
        // 添加精品自助小厨房的食材
        if (this.kitchenIngredients && this.kitchenIngredients.length > 0) {
            this.kitchenIngredients.forEach(item => {
                const key = item.id;
                if (itemsMap.has(key)) {
                    const existingItem = itemsMap.get(key);
                    existingItem.quantity += item.quantity;
                    if (!existingItem.mealTypes.includes('custom-kitchen')) {
                        existingItem.mealTypes.push('custom-kitchen');
                    }
                } else {
                    itemsMap.set(key, {
                        ...item,
                        mealTypes: ['custom-kitchen']
                    });
                }
            });
        }
        
        return Array.from(itemsMap.values());
    }

    // 新增方法：获取餐次显示名称
    getMealDisplayName(mealType) {
        const mealNames = {
            'breakfast': '早餐',
            'lunch': '午餐', 
            'dinner': '晚餐',
            'general': '通用',
            'custom-kitchen': '精品自助小厨房'
        };
        return mealNames[mealType] || mealType;
    }

    updateBudgetProgress(totalPrice) {
        // 更新原有的预算进度显示
        const budgetTotal = document.getElementById('budget-total');
        const budgetUsed = document.getElementById('budget-used');
        const budgetRemaining = document.getElementById('budget-remaining');
        const budgetPercentage = document.getElementById('budget-percentage');
        const progressFill = document.getElementById('budget-progress-fill');

        // 更新新的紧凑预算使用情况显示
        const compactTotal = document.querySelector('.stat-value[data-type="total"]');
        const compactUsed = document.querySelector('.stat-value[data-type="used"]');
        const compactRemaining = document.querySelector('.stat-value[data-type="remaining"]');
        const compactPercentage = document.querySelector('.progress-percentage');
        const compactProgressFill = document.querySelector('.progress-bar-compact .progress-fill');

        // 处理无限制预算的情况
        if (this.budget >= 999999) {
            // 更新原有显示
            if (budgetTotal) budgetTotal.textContent = '无限制';
            if (budgetUsed) budgetUsed.textContent = `¥${totalPrice.toFixed(1)}`;
            if (budgetRemaining) budgetRemaining.textContent = '无限制';
            if (budgetPercentage) budgetPercentage.textContent = '0%';
            if (progressFill) {
                progressFill.style.width = '5%';
                progressFill.className = 'progress-fill safe';
            }

            // 更新紧凑显示
            if (compactTotal) compactTotal.textContent = '无限制';
            if (compactUsed) compactUsed.textContent = `¥${totalPrice.toFixed(1)}`;
            if (compactRemaining) compactRemaining.textContent = '无限制';
            if (compactPercentage) compactPercentage.textContent = '0%';
            if (compactProgressFill) {
                compactProgressFill.style.width = '5%';
                compactProgressFill.style.background = '#a8b8d8';
            }
            return;
        }

        const remaining = Math.max(0, this.budget - totalPrice);
        const percentage = Math.min(100, (totalPrice / this.budget) * 100);

        // 更新原有显示
        if (budgetTotal) budgetTotal.textContent = `¥${this.budget}`;
        if (budgetUsed) budgetUsed.textContent = `¥${totalPrice.toFixed(1)}`;
        if (budgetRemaining) budgetRemaining.textContent = `¥${remaining.toFixed(1)}`;
        if (budgetPercentage) budgetPercentage.textContent = `${percentage.toFixed(1)}%`;
        if (progressFill) {
            progressFill.style.width = `${percentage}%`;
            progressFill.className = 'progress-fill';
            if (percentage >= 90) {
                progressFill.classList.add('danger');
            } else if (percentage >= 60) {
                progressFill.classList.add('warning');
            } else {
                progressFill.classList.add('safe');
            }
        }

        // 更新紧凑显示
        if (compactTotal) compactTotal.textContent = `¥${this.budget}`;
        if (compactUsed) compactUsed.textContent = `¥${totalPrice.toFixed(1)}`;
        if (compactRemaining) compactRemaining.textContent = `¥${remaining.toFixed(1)}`;
        if (compactPercentage) compactPercentage.textContent = `${percentage.toFixed(1)}%`;
        if (compactProgressFill) {
            compactProgressFill.style.width = `${percentage}%`;
            // 根据使用率设置颜色
            if (percentage >= 90) {
                compactProgressFill.style.background = '#d4a574';
            } else if (percentage >= 60) {
                compactProgressFill.style.background = '#c7b299';
            } else {
                compactProgressFill.style.background = '#a8b8d8';
            }
        }
    }

    updateNutritionChart() {
        // 检查是否有任何菜品被选择（包括餐次记录和全局购物车）
        const hasAnyItems = this.cart.length > 0 || 
                           Object.values(this.mealRecords).some(meal => meal.length > 0);
        
        if (!hasAnyItems) {
            // 显示空状态
            this.showEmptyChartState();
            this.showEmptyEnergyProgress();
            this.showEmptyNutritionBars();
            this.updateOilSaltDisplay(); // 更新油盐显示为空状态
            return;
        }

        const totalNutrition = this.calculateTotalNutrition();
        this.updateEnergyProgress(totalNutrition.calories);
        this.updateNutritionBars(totalNutrition);
        this.updateOilSaltDisplay(); // 更新油盐摄入量显示
    }

    showEmptyChartState() {
        // 清空图表
        if (this.barChart) {
            this.barChart.destroy();
            this.barChart = null;
        }
        
        // 显示空状态消息
        const barCanvas = document.getElementById('nutritionBarChart');
        
        if (barCanvas) {
            const barCtx = barCanvas.getContext('2d');
            barCtx.clearRect(0, 0, barCanvas.width, barCanvas.height);
            barCtx.fillStyle = '#999';
            barCtx.font = '16px Arial';
            barCtx.textAlign = 'center';
            barCtx.fillText('请选择菜品查看营养摄入', barCanvas.width / 2, barCanvas.height / 2);
        }
    }

    showEmptyEnergyProgress() {
        const progressFill = document.querySelector('.energy-progress-fill');
        const progressPercentage = document.querySelector('.energy-progress-percentage');
        const currentCalories = document.querySelector('#energy-value');
        
        if (progressFill) {
            progressFill.style.width = '0%';
            progressFill.className = 'energy-progress-fill';
        }
        if (progressPercentage) {
            progressPercentage.textContent = '0%';
        }
        if (currentCalories) {
            currentCalories.textContent = '0/1300';
        }
    }

    showEmptyNutritionBars() {
        const container = document.querySelector('.nutrition-bars-container');
        if (container) {
            container.innerHTML = '<p class="empty-state">请选择菜品查看营养摄入详情</p>';
        }
    }

    updateEnergyProgress(calories) {
        const minCalories = 1300;
        const maxCalories = 2200;
        const midCalories = (minCalories + maxCalories) / 2; // 1750千卡作为中点
        
        // 计算进度百分比，基于1300-2200千卡范围
        let percentage;
        if (calories <= minCalories) {
            percentage = (calories / minCalories) * 50; // 0-50%对应0-1300千卡
        } else if (calories <= maxCalories) {
            percentage = 50 + ((calories - minCalories) / (maxCalories - minCalories)) * 50; // 50-100%对应1300-2200千卡
        } else {
            percentage = 100 + ((calories - maxCalories) / maxCalories) * 20; // 超过2200千卡继续增长，但增长速度放缓
        }
        
        const progressFill = document.querySelector('.energy-progress-fill');
        const progressPercentage = document.querySelector('.energy-progress-percentage');
        const currentCalories = document.querySelector('#energy-value');
        
        if (progressFill) {
            // 添加动画延迟以确保CSS过渡效果
            setTimeout(() => {
                progressFill.style.width = `${Math.min(percentage, 120)}%`; // 限制最大显示宽度
            }, 50);
            
            // 根据进度设置颜色
            progressFill.className = 'energy-progress-fill';
            if (calories > maxCalories) {
                progressFill.classList.add('danger'); // 超过2200千卡为危险
            } else if (calories < minCalories || calories > maxCalories * 0.9) {
                progressFill.classList.add('warning'); // 低于1300千卡或接近2200千卡为警告
            } else {
                progressFill.classList.add('safe'); // 1300-1980千卡为安全范围
            }
        }
        
        // 数值动画效果
        if (progressPercentage) {
            this.animateNumber(progressPercentage, parseFloat(progressPercentage.textContent) || 0, Math.min(percentage, 100), '%');
        }
        
        if (currentCalories) {
            // 更新能量摄入显示格式
            const currentValue = parseFloat(currentCalories.textContent.split(' / ')[0]) || 0;
            this.animateEnergyValue(currentCalories, currentValue, calories, minCalories, maxCalories);
        }
    }

    // 数值动画函数
    animateNumber(element, startValue, endValue, suffix = '') {
        const duration = 800; // 动画持续时间
        const startTime = performance.now();
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // 使用缓动函数
            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const currentValue = startValue + (endValue - startValue) * easeOutCubic;
            
            element.textContent = `${Math.round(currentValue)}${suffix}`;
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }

    // 能量摄入值动画函数
    animateEnergyValue(element, startValue, endValue, minCalories, maxCalories) {
        const duration = 800; // 动画持续时间
        const startTime = performance.now();
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // 使用缓动函数
            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const currentValue = startValue + (endValue - startValue) * easeOutCubic;
            
            element.textContent = `${Math.round(currentValue)}/1300`;
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }

    updateNutritionBars(nutrition) {
        const container = document.querySelector('.nutrition-bars-container');
        if (!container) return;

        const nutritionData = [
            { name: '碳水化合物', value: nutrition.carbs, unit: 'g', recommended: 250, color: '#4CAF50' },
            { name: '蛋白质', value: nutrition.protein, unit: 'g', recommended: 60, color: '#2196F3' },
            { name: '脂肪', value: nutrition.fat.total, unit: 'g', recommended: 65, color: '#FF9800' },
            { name: '水分', value: nutrition.water, unit: 'ml', recommended: 2000, color: '#00BCD4' },
            { name: '矿物质', value: nutrition.minerals, unit: 'mg', recommended: 800, color: '#9C27B0' },
            { name: '维生素', value: nutrition.vitamins, unit: 'mg', recommended: 100, color: '#E91E63' }
        ];

        let html = '<h4 class="nutrition-bars-title">营养摄入详情</h4>';
        
        nutritionData.forEach(item => {
            const percentage = Math.min((item.value / item.recommended) * 100, 100);
            html += `
                <div class="nutrition-bar-item">
                    <div class="nutrition-bar-label">
                        <span class="nutrition-name">${item.name}</span>
                        <span class="nutrition-value">${Math.round(item.value)}${item.unit}</span>
                    </div>
                    <div class="nutrition-bar-track">
                        <div class="nutrition-bar-fill" style="width: ${percentage}%; background-color: ${item.color}"></div>
                    </div>
                    <div class="nutrition-bar-percentage">${Math.round(percentage)}%</div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    updateBarChart(nutrition) {
        const canvas = document.getElementById('nutritionBarChart');
        if (!canvas) return;
        
        // 为图表添加键盘导航支持
        this.addChartAccessibility(canvas, nutrition);
        
        const ctx = canvas.getContext('2d');
        
        // 销毁现有图表
        if (this.barChart) {
            this.barChart.destroy();
        }
        
        // 定义柔和的彩色方案（降低亮度）
        const softColors = [
            'rgba(255, 99, 132, 0.7)',   // 柔和红色 - 热量
            'rgba(54, 162, 235, 0.7)',   // 柔和蓝色 - 碳水化合物
            'rgba(255, 206, 86, 0.7)',   // 柔和黄色 - 蛋白质
            'rgba(75, 192, 192, 0.7)',   // 柔和青色 - 脂肪
            'rgba(153, 102, 255, 0.7)',  // 柔和紫色 - 水分
            'rgba(255, 159, 64, 0.7)',   // 柔和橙色 - 矿物质
            'rgba(199, 199, 199, 0.7)'   // 柔和灰色 - 维生素
        ];
        
        const borderColors = [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(199, 199, 199, 1)'
        ];
        
        // 创建条形图数据
        const data = {
            labels: ['热量(kcal)', '碳水化合物(g)', '蛋白质(g)', '脂肪(g)', '水分(ml)', '矿物质(mg)', '维生素(mg)'],
            datasets: [{
                label: '营养摄入量',
                data: [
                    nutrition.calories,
                    nutrition.carbs,
                    nutrition.protein,
                    nutrition.fat.total,
                    nutrition.water,
                    nutrition.minerals,
                    nutrition.vitamins
                ],
                backgroundColor: softColors,
                borderColor: borderColors,
                borderWidth: 1
            }]
        };
        
        // 添加2000kcal基准线数据集
        if (nutrition.calories > 0) {
            data.datasets.push({
                label: '2000kcal基准线',
                data: [2000, 0, 0, 0, 0, 0, 0],
                type: 'line',
                borderColor: '#E74C3C',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                borderWidth: 2,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false,
                tension: 0
            });
        }
        
        const options = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '营养摄入监控',
                    font: {
                        size: 16,
                        weight: 'bold',
                        family: 'Source Han Sans CN, sans-serif'
                    },
                    color: '#333333'
                },
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        font: {
                            family: 'Source Han Sans CN, sans-serif'
                        },
                        color: '#333333',
                        usePointStyle: true,
                        padding: 16
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#333333',
                    bodyColor: '#333333',
                    borderColor: '#E0E0E0',
                    borderWidth: 1,
                    titleFont: {
                        family: 'Source Han Sans CN, sans-serif'
                    },
                    bodyFont: {
                        family: 'Source Han Sans CN, sans-serif'
                    },
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label || '';
                            const value = context.parsed.y;
                            const units = ['kcal', 'g', 'g', 'g', 'ml', 'mg', 'mg'];
                            const unit = units[context.dataIndex] || '';
                            const recommendedValues = [2000, 250, 60, 65, 2000, 800, 100];
                            const recommended = recommendedValues[context.dataIndex];
                            const percentage = recommended ? ((value / recommended) * 100).toFixed(1) : 0;
                            return [
                                `${label}: ${value}${unit}`,
                                `推荐值: ${recommended}${unit}`,
                                `达成率: ${percentage}%`
                            ];
                        }
                    }
                },
                // 添加数值标签插件配置
                datalabels: {
                    display: function(context) {
                        return context.dataset.label === '营养摄入量';
                    },
                    anchor: 'end',
                    align: 'top',
                    color: '#333333',
                    font: {
                        family: 'Source Han Sans CN, sans-serif',
                        size: 10,
                        weight: 'bold'
                    },
                    formatter: function(value, context) {
                        const units = ['kcal', 'g', 'g', 'g', 'ml', 'mg', 'mg'];
                        const unit = units[context.dataIndex] || '';
                        return value > 0 ? `${value}${unit}` : '';
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: '#F5F5F5'
                    },
                    ticks: {
                        font: {
                            family: 'Source Han Sans CN, sans-serif'
                        },
                        color: '#666666'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            family: 'Source Han Sans CN, sans-serif',
                            size: 11
                        },
                        color: '#666666',
                        maxRotation: 45
                    }
                }
            },
            animation: {
                duration: 800,
                easing: 'easeInOutQuart'
            }
        };
        
        // 注册datalabels插件
        Chart.register(ChartDataLabels);
        
        this.barChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: options,
            plugins: [ChartDataLabels]
        });

        // 生成条形图图例
        this.generateBarChartLegend(nutrition);
    }

    generateBarChartLegend(nutrition) {
        const legendContainer = document.getElementById('barLegendItems');
        if (!legendContainer) return;

        const labels = ['热量', '碳水化合物', '蛋白质', '脂肪', '水分', '矿物质', '维生素'];
        const values = [
            nutrition.calories,
            nutrition.carbs,
            nutrition.protein,
            nutrition.fat.total,
            nutrition.water,
            nutrition.minerals,
            nutrition.vitamins
        ];
        const units = ['kcal', 'g', 'g', 'g', 'ml', 'mg', 'mg'];
        // 使用与柱形图一致的颜色
        const colors = [
            'rgba(255, 99, 132, 0.7)',   // 柔和红色 - 热量
            'rgba(54, 162, 235, 0.7)',   // 柔和蓝色 - 碳水化合物
            'rgba(255, 206, 86, 0.7)',   // 柔和黄色 - 蛋白质
            'rgba(75, 192, 192, 0.7)',   // 柔和青色 - 脂肪
            'rgba(153, 102, 255, 0.7)',  // 柔和紫色 - 水分
            'rgba(255, 159, 64, 0.7)',   // 柔和橙色 - 矿物质
            'rgba(199, 199, 199, 0.7)'   // 柔和灰色 - 维生素
        ];

        // 计算热量百分比（基于2000kcal）
        const caloriePercentage = ((nutrition.calories / 2000) * 100).toFixed(1);

        legendContainer.innerHTML = labels.map((label, index) => {
            const value = values[index];
            const unit = units[index];
            const color = colors[index];
            
            let percentageText = '';
            if (index === 0) { // 热量
                percentageText = `<span class="legend-percentage">(${caloriePercentage}% of 2000kcal)</span>`;
            }

            return `
                <div class="legend-item" role="listitem" tabindex="0" 
                     aria-label="${label}: ${value.toFixed(1)}${unit}${index === 0 ? `, ${caloriePercentage}% of recommended daily intake` : ''}">
                    <div class="legend-item-left">
                        <div class="legend-color-dot" style="background-color: ${color};" 
                             aria-hidden="true"></div>
                        <span class="legend-label">${label}</span>
                    </div>
                    <div>
                        <span class="legend-value">${value.toFixed(1)}${unit}</span>
                        ${percentageText}
                    </div>
                </div>
            `;
        }).join('');

        // 为图例项添加键盘导航支持
        const legendItems = legendContainer.querySelectorAll('.legend-item');
        legendItems.forEach((item, index) => {
            item.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowDown':
                    case 'ArrowRight':
                        e.preventDefault();
                        const nextIndex = (index + 1) % legendItems.length;
                        legendItems[nextIndex].focus();
                        break;
                    case 'ArrowUp':
                    case 'ArrowLeft':
                        e.preventDefault();
                        const prevIndex = (index - 1 + legendItems.length) % legendItems.length;
                        legendItems[prevIndex].focus();
                        break;
                    case 'Enter':
                    case ' ':
                        e.preventDefault();
                        // 宣布详细信息
                        const label = labels[index];
                        const value = values[index];
                        const unit = units[index];
                        let announcement = `${label}: ${value.toFixed(1)}${unit}`;
                        if (index === 0) {
                            announcement += `, ${caloriePercentage}% of recommended daily intake`;
                        }
                        this.announceToScreenReader(announcement);
                        break;
                }
            });
        });
    }



    calculateTotalNutrition() {
        // 如果当前餐次是"total"（全天总览），计算所有餐次的营养总和
        if (this.currentMeal === 'total') {
            return this.calculateAllMealsNutrition();
        }
        
        // 如果有当前餐次，计算当前餐次的营养信息
        if (this.currentMeal && this.mealRecords[this.currentMeal]) {
            return this.mealRecords[this.currentMeal].reduce((total, item) => {
                const itemNutrition = item.nutrition;
                const quantity = item.quantity;
                
                return {
                    calories: total.calories + (itemNutrition.calories * quantity),
                    carbs: total.carbs + (itemNutrition.carbs * quantity),
                    protein: total.protein + (itemNutrition.protein * quantity),
                    fat: {
                        total: total.fat.total + (itemNutrition.fat.total * quantity),
                        unsaturated: total.fat.unsaturated + (itemNutrition.fat.unsaturated * quantity),
                        saturated: total.fat.saturated + (itemNutrition.fat.saturated * quantity),
                        trans: total.fat.trans + (itemNutrition.fat.trans * quantity)
                    },
                    water: total.water + (itemNutrition.water * quantity),
                    minerals: total.minerals + (itemNutrition.minerals * quantity),
                    vitamins: total.vitamins + (itemNutrition.vitamins * quantity)
                };
            }, {
                calories: 0,
                carbs: 0,
                protein: 0,
                fat: {
                    total: 0,
                    unsaturated: 0,
                    saturated: 0,
                    trans: 0
                },
                water: 0,
                minerals: 0,
                vitamins: 0  // 维生素含量
            });
        }
        
        // 如果没有当前餐次，计算全局购物车的营养信息
        return this.cart.reduce((total, item) => {
            const itemNutrition = item.nutrition;
            const quantity = item.quantity;
            
            return {
                calories: total.calories + (itemNutrition.calories * quantity),
                carbs: total.carbs + (itemNutrition.carbs * quantity),
                protein: total.protein + (itemNutrition.protein * quantity),
                fat: {
                    total: total.fat.total + (itemNutrition.fat.total * quantity),
                    unsaturated: total.fat.unsaturated + (itemNutrition.fat.unsaturated * quantity),
                    saturated: total.fat.saturated + (itemNutrition.fat.saturated * quantity),
                    trans: total.fat.trans + (itemNutrition.fat.trans * quantity)
                },
                water: total.water + (itemNutrition.water * quantity),
                minerals: total.minerals + (itemNutrition.minerals * quantity),
                vitamins: total.vitamins + (itemNutrition.vitamins * quantity)
            };
        }, {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: {
                total: 0,
                unsaturated: 0,
                saturated: 0,
                trans: 0
            },
            water: 0,
            minerals: 0,
            vitamins: 0  // 维生素含量
        });
    }

    // 计算油盐摄入量
    calculateOilSaltIntake() {
        const nutrition = this.calculateTotalNutrition();
        
        // 估算油摄入量：基于总脂肪含量，假设约60%来自烹饪用油
        const estimatedOil = nutrition.fat.total * 0.6;
        
        // 估算盐摄入量：基于钠含量计算，1g盐≈393mg钠
        // 钠含量存储在minerals字段中
        const estimatedSalt = (nutrition.minerals || 0) / 393;
        
        return {
            oil: Math.max(0, estimatedOil), // 确保不为负数
            salt: Math.max(0, estimatedSalt)
        };
    }

    // 更新油盐摄入量显示
    updateOilSaltDisplay() {
        const intake = this.calculateOilSaltIntake();
        
        // 更新油摄入量显示
        const oilValueElement = document.getElementById('oil-current');
        const oilProgressFill = document.getElementById('oil-progress');
        
        if (oilValueElement && oilProgressFill) {
            oilValueElement.textContent = intake.oil.toFixed(1);
            
            const oilPercentage = (intake.oil / this.dailyOilRecommendation) * 100;
            oilProgressFill.style.width = `${Math.min(oilPercentage, 100)}%`;
            
            // 设置颜色警告
            oilProgressFill.classList.remove('warning', 'danger');
            if (intake.oil >= this.dailyOilRecommendation) {
                oilProgressFill.classList.add('danger');
            } else if (intake.oil >= this.dailyOilRecommendation * 0.8) {
                oilProgressFill.classList.add('warning');
            }
        }
        
        // 更新盐摄入量显示
        const saltValueElement = document.getElementById('salt-current');
        const saltProgressFill = document.getElementById('salt-progress');
        
        if (saltValueElement && saltProgressFill) {
            saltValueElement.textContent = intake.salt.toFixed(1);
            
            const saltPercentage = (intake.salt / this.dailySaltRecommendation) * 100;
            saltProgressFill.style.width = `${Math.min(saltPercentage, 100)}%`;
            
            // 设置颜色警告
            saltProgressFill.classList.remove('warning', 'danger');
            if (intake.salt >= this.dailySaltRecommendation) {
                saltProgressFill.classList.add('danger');
            } else if (intake.salt >= this.dailySaltRecommendation * 0.8) {
                saltProgressFill.classList.add('warning');
            }
        }
    }

    // 计算所有餐次的总营养信息
    calculateAllMealsNutrition() {
        const allMealsNutrition = {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: {
                total: 0,
                unsaturated: 0,
                saturated: 0,
                trans: 0
            },
            water: 0,
            minerals: 0,
            vitamins: 0  // 维生素含量
        };

        // 遍历所有餐次
        ['breakfast', 'lunch', 'dinner'].forEach(meal => {
            if (this.mealRecords[meal]) {
                this.mealRecords[meal].forEach(item => {
                    const itemNutrition = item.nutrition;
                    const quantity = item.quantity;
                    
                    allMealsNutrition.calories += itemNutrition.calories * quantity;
                    allMealsNutrition.carbs += itemNutrition.carbs * quantity;
                    allMealsNutrition.protein += itemNutrition.protein * quantity;
                    allMealsNutrition.fat.total += itemNutrition.fat.total * quantity;
                    allMealsNutrition.fat.unsaturated += itemNutrition.fat.unsaturated * quantity;
                    allMealsNutrition.fat.saturated += itemNutrition.fat.saturated * quantity;
                    allMealsNutrition.fat.trans += itemNutrition.fat.trans * quantity;
                    allMealsNutrition.water += itemNutrition.water * quantity;
                    allMealsNutrition.minerals += itemNutrition.minerals * quantity;
                    allMealsNutrition.vitamins += itemNutrition.vitamins * quantity;
                });
            }
        });

        // 注释：全天总摄入量只计算已分配到三餐的数据，不包括当前购物车中的临时数据
        // 这确保了全天总摄入量不会随着单餐购物车的变化而改变

        return allMealsNutrition;
    }

    // 计算所有菜品的总营养信息（包括合成菜品），用于导出功能
    calculateTotalNutritionForExport() {
        const totalNutrition = {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: {
                total: 0,
                unsaturated: 0,
                saturated: 0,
                trans: 0
            },
            water: 0,
            minerals: 0,
            vitamins: 0  // 维生素含量
        };

        // 遍历所有餐次的数据
        ['breakfast', 'lunch', 'dinner'].forEach(meal => {
            if (this.mealRecords[meal]) {
                this.mealRecords[meal].forEach(item => {
                    const itemNutrition = item.nutrition;
                    const quantity = item.quantity;
                    
                    totalNutrition.calories += itemNutrition.calories * quantity;
                    totalNutrition.carbs += itemNutrition.carbs * quantity;
                    totalNutrition.protein += itemNutrition.protein * quantity;
                    totalNutrition.fat.total += itemNutrition.fat.total * quantity;
                    totalNutrition.fat.unsaturated += itemNutrition.fat.unsaturated * quantity;
                    totalNutrition.fat.saturated += itemNutrition.fat.saturated * quantity;
                    totalNutrition.fat.trans += itemNutrition.fat.trans * quantity;
                    totalNutrition.water += itemNutrition.water * quantity;
                    totalNutrition.minerals += itemNutrition.minerals * quantity;
                    totalNutrition.vitamins += itemNutrition.vitamins * quantity;
                });
            }
        });

        // 同时包含全局购物车中的数据（包括合成菜品）
        if (this.cart && this.cart.length > 0) {
            this.cart.forEach(item => {
                const itemNutrition = item.nutrition;
                const quantity = item.quantity;
                
                totalNutrition.calories += itemNutrition.calories * quantity;
                totalNutrition.carbs += itemNutrition.carbs * quantity;
                totalNutrition.protein += itemNutrition.protein * quantity;
                totalNutrition.fat.total += itemNutrition.fat.total * quantity;
                totalNutrition.fat.unsaturated += itemNutrition.fat.unsaturated * quantity;
                totalNutrition.fat.saturated += itemNutrition.fat.saturated * quantity;
                totalNutrition.fat.trans += itemNutrition.fat.trans * quantity;
                totalNutrition.water += itemNutrition.water * quantity;
                totalNutrition.minerals += itemNutrition.minerals * quantity;
                totalNutrition.vitamins += itemNutrition.vitamins * quantity;
            });
        }

        return totalNutrition;
    }

    addChartAccessibility(canvas, nutrition) {
        // 更新图表的aria-label，包含具体数据
        const nutritionSummary = [
            `热量: ${nutrition.calories.toFixed(1)}千卡`,
            `碳水化合物: ${nutrition.carbs.toFixed(1)}克`,
            `蛋白质: ${nutrition.protein.toFixed(1)}克`,
            `脂肪: ${nutrition.fat.toFixed(1)}克`,
            `水分: ${nutrition.water.toFixed(1)}毫升`,
            `矿物质: ${nutrition.minerals.toFixed(1)}毫克`,
            `维生素: ${nutrition.vitamins.toFixed(1)}毫克`
        ].join(', ');
        
        canvas.setAttribute('aria-label', `营养摄入柱状图: ${nutritionSummary}`);
        
        // 添加键盘事件监听
        canvas.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                // 朗读图表数据
                this.announceChartData(nutrition);
            }
        });
        
        // 更新图表描述
        const chartDescription = document.getElementById('chart-description');
        if (chartDescription) {
            chartDescription.textContent = `当前营养摄入数据: ${nutritionSummary}。按回车键或空格键获取详细信息。`;
        }
    }

    announceChartData(nutrition) {
        // 创建详细的营养数据描述
        const recommendations = {
            calories: 2000,
            carbs: 250,
            protein: 50,
            fat: 65,
            water: 2000,
            minerals: 1000,
            vitamins: 100  // 维生素含量
        };

        const details = [
            `热量: ${nutrition.calories.toFixed(1)}千卡，推荐值${recommendations.calories}千卡，达成率${((nutrition.calories/recommendations.calories)*100).toFixed(1)}%`,
            `碳水化合物: ${nutrition.carbs.toFixed(1)}克，推荐值${recommendations.carbs}克，达成率${((nutrition.carbs/recommendations.carbs)*100).toFixed(1)}%`,
            `蛋白质: ${nutrition.protein.toFixed(1)}克，推荐值${recommendations.protein}克，达成率${((nutrition.protein/recommendations.protein)*100).toFixed(1)}%`,
            `脂肪: ${nutrition.fat.total.toFixed(1)}克，推荐值${recommendations.fat}克，达成率${((nutrition.fat.total/recommendations.fat)*100).toFixed(1)}%`,
            `水分: ${nutrition.water.toFixed(1)}毫升，推荐值${recommendations.water}毫升，达成率${((nutrition.water/recommendations.water)*100).toFixed(1)}%`,
            `矿物质: ${nutrition.minerals.toFixed(1)}毫克，推荐值${recommendations.minerals}毫克，达成率${((nutrition.minerals/recommendations.minerals)*100).toFixed(1)}%`,
            `维生素: ${nutrition.vitamins.toFixed(1)}毫克，推荐值${recommendations.vitamins}毫克，达成率${((nutrition.vitamins/recommendations.vitamins)*100).toFixed(1)}%`
        ];

        // 使用屏幕阅读器朗读
        const announcement = `营养摄入详细数据: ${details.join('; ')}`;
        this.announceToScreenReader(announcement);
    }

    announceToScreenReader(message) {
        // 创建临时的aria-live区域来朗读消息
        const liveRegion = document.createElement('div');
        liveRegion.setAttribute('aria-live', 'polite');
        liveRegion.setAttribute('aria-atomic', 'true');
        liveRegion.className = 'sr-only';
        liveRegion.textContent = message;
        
        document.body.appendChild(liveRegion);
        
        // 短暂延迟后移除元素
        setTimeout(() => {
            document.body.removeChild(liveRegion);
        }, 1000);
    }

    generateNutritionChartHTML(nutrition) {
        return `
            <div style="background: #ffffff; padding: 20px; font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #333; border-radius: 8px; border: 1px solid #e9ecef; font-weight: 500; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;">
                <div style="margin-bottom: 24px; padding: 16px; border: 2px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                    <h3 style="margin: 0 0 14px 0; text-align: center; font-size: 28px; font-weight: 700; color: #2c3e50; letter-spacing: 0.5px;">营养摘要</h3>
                    <div style="display: flex; justify-content: space-around; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 18px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">总热量</div>
                            <div style="font-size: 32px; font-weight: 700; color: #495057; letter-spacing: 0.5px;">${Math.round(nutrition.calories)} 卡</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 18px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">总价格</div>
                            <div style="font-size: 32px; font-weight: 700; color: #495057; letter-spacing: 0.5px;">¥${this.getAllMealsPrice().toFixed(1)}</div>
                        </div>
                    </div>
                </div>
                
                ${this.generateMealMonitoringHTML()}
                
                <!-- 营养摄入详情和营养分析模块并排显示 -->
                <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                    ${this.generateNutritionPieChartHTML(nutrition)}
                    ${this.generateNutritionAnalysisModuleHTML(nutrition)}
                </div>
                
                <div style="margin-top: 20px; padding: 16px; border: 2px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                    <h4 style="margin: 0 0 12px 0; font-size: 22px; font-weight: 600; text-align: center; color: #2c3e50; letter-spacing: 0.5px; font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;">🍽️ 购物车详情</h4>
                    ${this.getAllMealsItems().length > 0 ? `
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6; font-size: 16px; line-height: 1.6; color: #495057; font-weight: 500; letter-spacing: 0.3px; font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;">
                            ${this.getAllMealsItems().map(item => `${item.emoji}${item.name}×${item.quantity}(¥${(item.price * item.quantity).toFixed(1)})`).join(' • ')}
                        </div>
                    ` : `
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6; text-align: center;">
                            <div style="font-size: 18px; color: #6c757d; font-weight: 500; letter-spacing: 0.3px; font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;">🛒 暂无选择的菜品，请先选择一些菜品再导出报告</div>
                        </div>
                    `}
                </div>
                
                ${this.generateBalanceEvaluationHTML()}
            </div>
        `;
    }

    // 生成三餐分配监控HTML
    generateMealMonitoringHTML() {
        const breakfastNutrition = this.calculateMealNutrition('breakfast');
        const lunchNutrition = this.calculateMealNutrition('lunch');
        const dinnerNutrition = this.calculateMealNutrition('dinner');
        const totalNutrition = this.calculateAllMealsNutrition();
        
        const dailyCalorieTarget = 2000; // 每日推荐热量
        
        const breakfastPercent = totalNutrition.calories > 0 ? (breakfastNutrition.calories / totalNutrition.calories * 100) : 0;
        const lunchPercent = totalNutrition.calories > 0 ? (lunchNutrition.calories / totalNutrition.calories * 100) : 0;
        const dinnerPercent = totalNutrition.calories > 0 ? (dinnerNutrition.calories / totalNutrition.calories * 100) : 0;
        const totalPercent = (totalNutrition.calories / dailyCalorieTarget * 100);
        
        return `
            <div style="margin-bottom: 24px; padding: 16px; border: 2px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                <h4 style="margin: 0 0 16px 0; color: #2c3e50; font-size: 24px; font-weight: 600; text-align: center; letter-spacing: 0.5px;">🍽️ 三餐分配监控</h4>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 16px;">
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: #495057; font-size: 14px;">🌅 早餐</span>
                            <span style="font-weight: 700; color: #28a745; font-size: 14px;">${Math.round(breakfastNutrition.calories)} 卡</span>
                        </div>
                        <div style="background: #e9ecef; height: 12px; border-radius: 6px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; width: ${breakfastPercent}%; border-radius: 6px; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 6px; font-size: 14px; color: #6c757d; font-weight: 500;">${breakfastPercent.toFixed(1)}%</div>
                    </div>
                    
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: #495057; font-size: 14px;">🌞 午餐</span>
                            <span style="font-weight: 700; color: #007bff; font-size: 14px;">${Math.round(lunchNutrition.calories)} 卡</span>
                        </div>
                        <div style="background: #e9ecef; height: 12px; border-radius: 6px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #007bff, #6610f2); height: 100%; width: ${lunchPercent}%; border-radius: 6px; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 6px; font-size: 14px; color: #6c757d; font-weight: 500;">${lunchPercent.toFixed(1)}%</div>
                    </div>
                    
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: #495057; font-size: 14px;">🌙 晚餐</span>
                            <span style="font-weight: 700; color: #fd7e14; font-size: 14px;">${Math.round(dinnerNutrition.calories)} 卡</span>
                        </div>
                        <div style="background: #e9ecef; height: 12px; border-radius: 6px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #fd7e14, #e83e8c); height: 100%; width: ${dinnerPercent}%; border-radius: 6px; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 6px; font-size: 14px; color: #6c757d; font-weight: 500;">${dinnerPercent.toFixed(1)}%</div>
                    </div>
                    
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: #495057; font-size: 14px;">📊 每日总计</span>
                            <span style="font-weight: 700; color: #6f42c1; font-size: 14px;">${Math.round(totalNutrition.calories)} 卡</span>
                        </div>
                        <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #6f42c1, #e83e8c); height: 100%; width: ${Math.min(totalPercent, 100)}%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 3px; font-size: 14px; color: #6c757d;">${totalPercent.toFixed(1)}%</div>
                    </div>
                </div>
            </div>
        `;
    }

    // 生成营养摄入详情条形图HTML
    generateNutritionPieChartHTML(nutrition) {
        // 每日推荐摄入量标准（成年人）
        const dailyRecommended = {
            carbs: 250,      // 碳水化合物 250g
            protein: 60,     // 蛋白质 60g  
            fat: 60,         // 脂肪 60g
            water: 1500,     // 水分 1500ml
            minerals: 800,   // 矿物质 800mg（主要包括钙、铁、锌等）
            vitamins: 100   // 维生素 100mg（维生素C、B族等总和）
        };

        // 计算营养素数据和每日推荐占比
        const nutritionData = [
            { 
                name: '碳水化合物', 
                value: nutrition.carbs, 
                recommended: dailyRecommended.carbs,
                unit: 'g', 
                color: '#4CAF50', 
                emoji: '🌾' 
            },
            { 
                name: '蛋白质', 
                value: nutrition.protein, 
                recommended: dailyRecommended.protein,
                unit: 'g', 
                color: '#2196F3', 
                emoji: '🥩' 
            },
            { 
                name: '脂肪', 
                value: nutrition.fat.total, 
                recommended: dailyRecommended.fat,
                unit: 'g', 
                color: '#FF9800', 
                emoji: '🥑' 
            },
            { 
                name: '水分', 
                value: nutrition.water, 
                recommended: dailyRecommended.water,
                unit: 'ml', 
                color: '#00BCD4', 
                emoji: '💧' 
            },
            { 
                name: '矿物质', 
                value: nutrition.minerals, 
                recommended: dailyRecommended.minerals,
                unit: 'mg', 
                color: '#9C27B0', 
                emoji: '⚡' 
            },
            { 
                name: '维生素', 
                value: nutrition.vitamins, 
                recommended: dailyRecommended.vitamins,
                unit: 'mg', 
                color: '#E91E63', 
                emoji: '🍎' 
            }
        ];
        
        const nutritionBars = nutritionData.map(item => {
            // 计算每日推荐占比
            const percentage = item.recommended > 0 ? (item.value / item.recommended * 100) : 0;
            // 限制最大显示为150%，避免条形图过长
            const displayPercentage = Math.min(percentage, 150);
            
            // 特殊处理维生素的状态判断
            let status;
            if (item.name === '维生素') {
                if (item.value > 2500) {
                    status = 'excessive';
                } else if (item.value >= 100) {
                    status = 'sufficient';
                } else {
                    status = 'insufficient';
                }
            } else {
                // 其他营养素使用原有逻辑
                status = percentage >= 100 ? 'sufficient' : percentage >= 80 ? 'adequate' : 'insufficient';
            }
            
            return {
                ...item,
                percentage: percentage,
                displayPercentage: displayPercentage,
                status: status
            };
        });

        return `
            <div style="flex: 1; padding: 12px; border: 1px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 16px; font-weight: 600; text-align: center;">📊 营养摄入详情（每日推荐占比）</h4>
                
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    ${nutritionBars.map(item => {
                        // 根据营养状态确定颜色
                        const statusColor = item.status === 'sufficient' ? '#28a745' : 
                                          item.status === 'adequate' ? '#ffc107' : 
                                          item.status === 'excessive' ? '#ff6b35' : '#dc3545';
                        const statusText = item.status === 'sufficient' ? (item.name === '维生素' ? '达标' : '充足') : 
                                         item.status === 'adequate' ? '适中' : 
                                         item.status === 'excessive' ? '超标' : '不足';
                        
                        return `
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <span style="font-size: 14px;">${item.emoji}</span>
                                    <span style="font-weight: 600; color: #495057; font-size: 14px;">${item.name}</span>
                                    <span style="font-size: 14px; color: ${statusColor}; font-weight: 600; background: ${statusColor}20; padding: 1px 4px; border-radius: 8px;">${statusText}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 14px; color: #6c757d; font-weight: 500;">${Math.round(item.value)}${item.unit} / ${item.recommended}${item.unit}</span>
                                    <span style="font-size: 14px; color: ${statusColor}; font-weight: 700; min-width: 50px; text-align: right;">${item.percentage.toFixed(1)}%</span>
                                </div>
                            </div>
                            <div style="background: #f8f9fa; height: 18px; border-radius: 9px; overflow: hidden; border: 1px solid #dee2e6; position: relative;">
                                <!-- 100%参考线 -->
                                <div style="position: absolute; left: 66.67%; top: 0; bottom: 0; width: 1px; background: #28a745; opacity: 0.6; z-index: 2;"></div>
                                <div style="position: absolute; left: 66.67%; top: -16px; font-size: 9px; color: #28a745; font-weight: 600; transform: translateX(-50%);">100%</div>
                                
                                <div style="background: linear-gradient(90deg, ${statusColor}, ${statusColor}dd); height: 100%; width: ${item.displayPercentage * 0.667}%; border-radius: 9px; transition: width 0.5s ease; position: relative; z-index: 1;">
                                    ${item.displayPercentage > 22 ? `
                                        <div style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); color: white; font-size: 10px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">
                                            ${item.percentage.toFixed(1)}%
                                        </div>
                                    ` : ''}
                                </div>
                                ${item.displayPercentage <= 22 && item.percentage > 0 ? `
                                    <div style="position: absolute; left: ${(item.displayPercentage * 0.667) + 2}%; top: 50%; transform: translateY(-50%); color: ${statusColor}; font-size: 10px; font-weight: 600;">
                                        ${item.percentage.toFixed(1)}%
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
                
                <div style="margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                        <div style="font-size: 11px; color: #6c757d;">
                            <strong>营养状态：</strong>
                            <span style="color: #28a745;">●</span> 充足(≥100%) 
                            <span style="color: #ffc107;">●</span> 适中(80-99%) 
                            <span style="color: #dc3545;">●</span> 不足(<80%)
                        </div>
                        <div style="font-size: 11px; color: #6c757d;">
                            <strong>达标率：</strong>${nutritionBars.filter(item => item.percentage >= 80).length}/${nutritionBars.length} 项
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // 生成均衡评价HTML
    generateBalanceEvaluationHTML() {
        // 每日推荐量标准
        const dailyRecommended = {
            dairy: { min: 360, max: 480, unit: 'ml' },      // 乳制品 360-480ml
            fruit: { min: 300, max: 500, unit: 'g' },       // 水果 300-500g
            vegetable: { min: 200, max: 400, unit: 'g' },   // 蔬菜 200-400g
            grain: { min: 300, max: 800, unit: 'g' },       // 全谷杂粮 300-800g
            protein: { min: 150, max: 400, unit: 'g' },     // 豆鱼蛋肉 150-400g
            nuts: { min: 15, max: 35, unit: 'g' }           // 坚果 15-35g
        };

        // 三餐配比：早:中:晚 = 0.3:0.4:0.3
        const mealRatio = { breakfast: 0.3, lunch: 0.4, dinner: 0.3 };

        // 计算各类食物的实际摄入量
        const foodIntake = this.calculateFoodCategoryIntake();
        
        // 计算总营养素
        const totalNutrition = this.calculateAllMealsNutrition();
        
        // 评价各类食物
        const evaluations = Object.keys(dailyRecommended).map(category => {
            const intake = foodIntake[category] || 0;
            const recommended = dailyRecommended[category];
            const minThreshold = recommended.min;
            const maxThreshold = recommended.max;
            
            // 计算评价状态
            let status, statusText, statusColor;
            if (intake < minThreshold * 0.8) {
                status = 'severely_insufficient';
                statusText = '明显不足';
                statusColor = '#dc3545';
            } else if (intake < minThreshold) {
                status = 'insufficient';
                statusText = '偏少';
                statusColor = '#fd7e14';
            } else if (intake <= maxThreshold) {
                status = 'adequate';
                statusText = '达标';
                statusColor = '#28a745';
            } else if (intake <= maxThreshold * 1.2) {
                status = 'excessive';
                statusText = '偏多';
                statusColor = '#fd7e14';
            } else {
                status = 'severely_excessive';
                statusText = '明显超量';
                statusColor = '#dc3545';
            }

            return {
                category,
                name: this.getFoodCategoryName(category),
                emoji: this.getFoodCategoryEmoji(category),
                intake,
                recommended,
                status,
                statusText,
                statusColor,
                percentage: intake / ((minThreshold + maxThreshold) / 2) * 100
            };
        });

        // 宏量营养素分析
        const macroAnalysis = this.analyzeMacronutrients(totalNutrition);
        
        // 生成建议文案
        const suggestions = this.generateNutritionSuggestions(evaluations, macroAnalysis);

        return `
            <div style="margin-bottom: 15px; padding: 12px; border: 1px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 16px; font-weight: 600; text-align: center;">⚖️ 均衡评价</h4>
                
                <!-- 六类食物评价 -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px;">
                    ${evaluations.map(item => `
                        <div style="padding: 8px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <span style="font-size: 14px;">${item.emoji}</span>
                                    <span style="font-weight: 600; color: #495057; font-size: 14px;">${item.name}</span>
                                </div>
                                <span style="font-size: 14px; color: ${item.statusColor}; font-weight: 600; background: ${item.statusColor}20; padding: 1px 4px; border-radius: 8px;">${item.statusText}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <span style="font-size: 14px; color: #6c757d;">实际: ${Math.round(item.intake)}${item.recommended.unit}</span>
                                <span style="font-size: 14px; color: #6c757d;">推荐: ${item.recommended.min}-${item.recommended.max}${item.recommended.unit}</span>
                            </div>
                            <div style="background: #e9ecef; height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: ${item.statusColor}; height: 100%; width: ${Math.min(item.percentage, 150)}%; border-radius: 3px; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- 宏量营养素异常提示 -->
                ${macroAnalysis.warnings.length > 0 ? `
                    <div style="margin-bottom: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px;">
                        <div style="font-weight: 600; color: #856404; margin-bottom: 4px; font-size: 14px;">⚠️ 宏量营养素异常</div>
                        <div style="font-size: 14px; color: #856404; line-height: 1.3;">
                            ${macroAnalysis.warnings.join(' • ')}
                        </div>
                    </div>
                ` : ''}

                <!-- 营养建议 -->
                ${suggestions.length > 0 ? `
                    <div style="padding: 8px; background: #e8f5e8; border: 1px solid #c3e6cb; border-radius: 6px;">
                        <div style="font-weight: 600; color: #155724; margin-bottom: 6px; font-size: 14px;">💡 营养建议</div>
                        <div style="display: flex; flex-direction: column; gap: 3px;">
                            ${suggestions.map(suggestion => `
                                <div style="font-size: 14px; color: #155724; line-height: 1.3;">• ${suggestion}</div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            </div>
        `;
    }

    // 计算各类食物摄入量
    calculateFoodCategoryIntake() {
        const allItems = this.getAllMealsItems();
        const intake = {
            dairy: 0,      // 乳制品
            fruit: 0,      // 水果
            vegetable: 0,  // 蔬菜
            grain: 0,      // 全谷杂粮
            protein: 0,    // 豆鱼蛋肉
            nuts: 0        // 坚果
        };

        allItems.forEach(item => {
            // 首先在dishesData中查找
            let dish = dishesData.find(d => d.id === item.id);
            
            // 如果在dishesData中没找到，则在ingredientsData中查找
            if (!dish && typeof ingredientsData !== 'undefined') {
                dish = ingredientsData.find(d => d.id === item.id);
            }
            
            if (dish) {
                const quantity = item.quantity;
                const portionWeight = this.extractPortionWeight(dish.portion);
                
                // 根据菜品分类和名称判断食物类别
                if (this.isDairy(dish)) {
                    intake.dairy += portionWeight * quantity;
                } else if (this.isFruit(dish)) {
                    intake.fruit += portionWeight * quantity;
                } else if (this.isVegetable(dish)) {
                    intake.vegetable += portionWeight * quantity;
                } else if (this.isGrain(dish)) {
                    intake.grain += portionWeight * quantity;
                } else if (this.isProtein(dish)) {
                    intake.protein += portionWeight * quantity;
                } else if (this.isNuts(dish)) {
                    intake.nuts += portionWeight * quantity;
                }
            }
        });

        return intake;
    }

    // 提取份量重量（g或ml）
    extractPortionWeight(portion) {
        const match = portion.match(/(\d+(?:\.\d+)?)(g|ml)/);
        return match ? parseFloat(match[1]) : 0;
    }

    // 判断食物类别的辅助函数
    isDairy(dish) {
        const dairyKeywords = ['牛奶', '酸奶', '奶茶', '豆浆', '奶昔', '奶', '豆奶'];
        return dairyKeywords.some(keyword => dish.name.includes(keyword));
    }

    isFruit(dish) {
        const fruitKeywords = ['苹果', '香蕉', '橙子', '葡萄', '草莓', '西瓜', '梨', '桃子', '柠檬', '果汁', '水果', '橙汁', '蓝莓', '车厘子', '奇异果', '猕猴桃'];
        return fruitKeywords.some(keyword => dish.name.includes(keyword)) || dish.category === 'fruit';
    }

    isVegetable(dish) {
        const vegetableKeywords = ['青菜', '白菜', '菠菜', '西红柿', '黄瓜', '胡萝卜', '土豆', '洋葱', '青椒', '茄子', '豆角', '冬瓜', '南瓜', '蘑菇', '木耳', '芹菜', '韭菜', '豆苗', '萝卜', '莲藕', '花菜', '西兰花', '包菜', '生菜'];
        return vegetableKeywords.some(keyword => dish.name.includes(keyword)) || 
               dish.category === 'side' || dish.category === 'vegetable';
    }

    isGrain(dish) {
        const grainKeywords = ['米饭', '面条', '面包', '馒头', '包子', '饺子', '粥', '燕麦', '全麦', '杂粮', '饭', '面', '粉'];
        return grainKeywords.some(keyword => dish.name.includes(keyword)) || dish.category === 'staple';
    }

    isProtein(dish) {
        const proteinKeywords = ['肉', '鱼', '虾', '蛋', '豆腐', '鸡', '猪', '牛', '羊', '鸭', '排骨', '丸子', '肉丝', '肉片', '肉丁'];
        return proteinKeywords.some(keyword => dish.name.includes(keyword)) || dish.category === 'main';
    }

    isNuts(dish) {
        const nutsKeywords = ['坚果', '花生', '核桃', '杏仁', '腰果', '开心果', '瓜子', '芝麻', '夏威夷果', '松子', '巴西坚果', '椰子'];
        return nutsKeywords.some(keyword => dish.name.includes(keyword));
    }

    // 获取食物类别名称
    getFoodCategoryName(category) {
        const names = {
            dairy: '乳制品',
            fruit: '水果',
            vegetable: '蔬菜',
            grain: '全谷杂粮',
            protein: '豆鱼蛋肉',
            nuts: '坚果'
        };
        return names[category] || category;
    }

    // 获取食物类别表情符号
    getFoodCategoryEmoji(category) {
        const emojis = {
            dairy: '🥛',
            fruit: '🍎',
            vegetable: '🥬',
            grain: '🌾',
            protein: '🥩',
            nuts: '🥜'
        };
        return emojis[category] || '🍽️';
    }

    // 分析宏量营养素
    analyzeMacronutrients(nutrition) {
        const totalCalories = nutrition.calories;
        const warnings = [];

        if (totalCalories > 0) {
            // 计算各营养素占总热量的百分比
            const carbsPercent = (nutrition.carbs * 4) / totalCalories * 100;
            const proteinPercent = (nutrition.protein * 4) / totalCalories * 100;
            const fatPercent = (nutrition.fat.total * 9) / totalCalories * 100;

            // 检查异常情况
            if (fatPercent > 35) {
                warnings.push(`脂肪占比过高(${fatPercent.toFixed(1)}%)`);
            }
            if (proteinPercent < 15) {
                warnings.push(`蛋白质占比偏低(${proteinPercent.toFixed(1)}%)`);
            }
            if (carbsPercent < 45) {
                warnings.push(`碳水化合物占比偏低(${carbsPercent.toFixed(1)}%)`);
            }
        }

        return { warnings };
    }

    // 生成营养建议
    generateNutritionSuggestions(evaluations, macroAnalysis) {
        const suggestions = [];
        
        evaluations.forEach(item => {
            if (item.status === 'severely_insufficient' || item.status === 'insufficient') {
                switch (item.category) {
                    case 'dairy':
                        suggestions.push('建议在早餐/加餐补200-240ml奶');
                        break;
                    case 'fruit':
                        suggestions.push('水果加1个拳头大小（约150g）即可');
                        break;
                    case 'vegetable':
                        suggestions.push('加深绿色蔬菜80-120g');
                        break;
                    case 'protein':
                        suggestions.push('加蛋/豆腐/鱼虾50-80g');
                        break;
                    case 'nuts':
                        suggestions.push('坚果一到三茶匙8-20g即可');
                        break;
                }
            } else if (item.status === 'excessive' || item.status === 'severely_excessive') {
                if (item.category === 'grain') {
                    suggestions.push('减饭30-50g或半份换全谷');
                }
            }
        });

        // 限制最多显示4条建议
        return suggestions.slice(0, 4);
    }

    // 生成营养分析模块HTML
    generateNutritionAnalysisModuleHTML(nutrition) {
        // 调用现有的generateNutritionAnalysis函数获取分析内容
        const analysisHTML = generateNutritionAnalysis(nutrition);
        
        return `
            <div style="flex: 1; padding: 12px; border: 1px solid #e9ecef; border-radius: 8px; background: #ffffff;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 16px; font-weight: 600; text-align: center;">🔍 营养分析</h4>
                ${analysisHTML}
            </div>
        `;
    }

    updateSuggestions() {
        const suggestionsContainer = document.getElementById('suggestions');
        if (!suggestionsContainer) return; // 防止在测试环境中出现错误
        
        const totalPrice = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const remainingBudget = this.budget - totalPrice;

        let suggestions = [];

        if (this.cart.length === 0) {
            suggestions.push('💡 建议先选择一个主食作为基础');
        } else {
            const totalNutrition = this.calculateTotalNutrition();
            const hasStaple = this.cart.some(item => item.category === 'staple');
            const hasMain = this.cart.some(item => item.category === 'main');
            const hasSoup = this.cart.some(item => item.category === 'soup');

            if (!hasStaple) {
                suggestions.push('🍚 建议添加主食以获得充足的碳水化合物');
            }
            if (!hasMain) {
                suggestions.push('🍖 建议添加主菜以获得优质蛋白质');
            }
            if (!hasSoup && remainingBudget >= 4) {
                suggestions.push('🍲 建议添加汤品以补充水分');
            }

            if (totalNutrition.calories < 400) {
                suggestions.push('⚡ 当前热量较低，建议增加食物');
            } else if (totalNutrition.calories > 800) {
                suggestions.push('⚠️ 当前热量较高，注意控制');
            }

            if (remainingBudget < 0) {
                suggestions.push('💰 超出预算，建议调整选择');
            } else if (remainingBudget > 20) {
                suggestions.push('💡 预算充足，可以添加更多营养食物');
            }
        }

        suggestionsContainer.innerHTML = suggestions.map(suggestion => 
            `<div class="suggestion-item">${suggestion}</div>`
        ).join('');
    }

    // 三餐监控系统方法
    initMealMonitoring() {
        // 初始化当前餐次显示
        this.updateCurrentMealDisplay();
        
        // 更新三餐监控显示
        this.updateMealMonitoring();
    }

    switchMealTab(mealType) {
        // 更新当前标签页
        this.currentMealTab = mealType;
        // 同时更新当前餐次，确保营养计算使用正确的数据
        this.currentMeal = mealType;
        
        // 更新标签页样式
        const tabs = document.querySelectorAll('.meal-tab');
        tabs.forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.meal === mealType) {
                tab.classList.add('active');
            }
        });
        
        // 更新面板显示
        const panels = document.querySelectorAll('.meal-panel');
        panels.forEach(panel => {
            panel.classList.remove('active');
            if (panel.id === `${mealType}-panel`) {
                panel.classList.add('active');
            }
        });
        
        // 更新显示内容
        this.updateMealMonitoring();
        // 更新营养图表，包括油盐监控
        this.updateNutritionChart();
    }

    setCurrentMeal(mealType) {
        this.currentMeal = mealType;
        
        // 重新分配购物车中的菜品到当前餐次
        this.redistributeCartToMeal();
        
        // 更新显示
        this.updateMealMonitoring();
    }

    redistributeCartToMeal() {
        // 注释掉清空当前餐次记录的逻辑，确保数据持久化
        // this.mealRecords[this.currentMeal] = [];
        
        // 将购物车中的菜品分配到当前餐次（只添加新的，不清空已有的）
        this.cart.forEach(item => {
            // 检查是否已经存在相同的菜品，避免重复添加
            const existingItem = this.mealRecords[this.currentMeal].find(record => record.id === item.id);
            if (!existingItem) {
                this.mealRecords[this.currentMeal].push({
                    ...item,
                    mealType: this.currentMeal
                });
            }
        });
        
        // 注释掉清空其他餐次记录的错误逻辑，确保三餐菜品选择独立保存
        // Object.keys(this.mealRecords).forEach(meal => {
        //     if (meal !== this.currentMeal) {
        //         this.mealRecords[meal] = [];
        //     }
        // });
    }

    switchToMeal(mealType) {
        // 同时切换当前餐次和标签页
        this.setCurrentMeal(mealType);
        this.switchMealTab(mealType);
        
        // 更新当前餐次显示
        this.updateCurrentMealDisplay();
    }

    updateCurrentMealDisplay() {
        const currentMealDisplay = document.getElementById('current-meal-display');
        if (currentMealDisplay) {
            const mealNames = {
                'breakfast': '早餐',
                'lunch': '午餐',
                'dinner': '晚餐'
            };
            currentMealDisplay.textContent = mealNames[this.currentMeal] || '早餐';
        }
    }

    calculateMealNutrition(mealType) {
        const mealItems = this.mealRecords[mealType] || [];
        
        return mealItems.reduce((total, item) => {
            // 首先尝试使用item中的营养信息（如果存在）
            let nutrition = item.nutrition;
            
            // 如果item中没有营养信息，则从dishesData中查找
            if (!nutrition) {
                const dish = dishesData.find(d => d.id === item.id);
                if (dish) {
                    nutrition = dish.nutrition;
                }
            }
            
            if (nutrition) {
                total.calories += nutrition.calories * item.quantity;
                total.carbs += nutrition.carbs * item.quantity;
                total.protein += nutrition.protein * item.quantity;
                total.fat += nutrition.fat.total * item.quantity;
                total.water += nutrition.water * item.quantity;
                total.minerals += nutrition.minerals * item.quantity + ((nutrition.sodium || 0) * item.quantity);
                total.vitamins += nutrition.vitamins * item.quantity;
                total.sodium += (nutrition.sodium || 0) * item.quantity;
            }
            return total;
        }, {
            calories: 0,
            carbs: 0,
            protein: 0,
            fat: 0,
            water: 0,
            minerals: 0,
            vitamins: 0,  // 维生素含量
            sodium: 0
        });
    }

    updateMealMonitoring() {
        // 更新各餐次的进度显示
        ['breakfast', 'lunch', 'dinner'].forEach(meal => {
            this.updateMealProgress(meal);
        });
        
        // 更新全天总览
        this.updateTotalOverview();
        
        // 更新全天总摄入显示
        this.updateDailyTotal();
    }

    updateMealProgress(mealType) {
        const nutrition = this.calculateMealNutrition(mealType);
        const target = this.mealTargets[mealType];
        
        // 计算进度百分比（基于目标最大值）
        const percentage = Math.min((nutrition.calories / target.max) * 100, 100);
        const calories = Math.round(nutrition.calories);
        
        // 更新进度条
        const progressFill = document.getElementById(`${mealType}-progress`);
        if (progressFill) {
            progressFill.style.width = `${percentage}%`;
            
            // 根据摄入情况调整颜色
            if (nutrition.calories < target.min) {
                progressFill.style.background = 'linear-gradient(90deg, #FFA726, #FF9800)'; // 橙色 - 不足
            } else if (nutrition.calories <= target.max) {
                progressFill.style.background = 'linear-gradient(90deg, #4CAF50, #66BB6A)'; // 绿色 - 适宜
            } else {
                progressFill.style.background = 'linear-gradient(90deg, #F44336, #EF5350)'; // 红色 - 过量
            }
        }
        
        // 更新当前摄入量 (nutrition-cafeteria.html 格式)
        const currentElement = document.getElementById(`${mealType}-current`);
        if (currentElement) {
            currentElement.textContent = `${calories} kcal`;
        }
        
        // 更新百分比 (nutrition-cafeteria.html 格式)
        const percentElement = document.getElementById(`${mealType}-percent`);
        if (percentElement) {
            percentElement.textContent = `${percentage.toFixed(1)}%`;
        }
        
        // 同时更新 nutrition-monitoring-system.html 格式的元素
        const percentageElement = document.getElementById(`${mealType}-percentage`);
        if (percentageElement) {
            percentageElement.textContent = `${calories} kcal (${Math.round(percentage)}%)`;
        }
        
        // 更新餐次总计 (nutrition-monitoring-system.html 格式)
        const totalElement = document.getElementById(`${mealType}-total`);
        if (totalElement) {
            totalElement.textContent = calories;
        }
        
        // 更新目标完成度 (nutrition-monitoring-system.html 格式)
        const targetPercentElement = document.getElementById(`${mealType}-target-percent`);
        if (targetPercentElement) {
            targetPercentElement.textContent = `${Math.round(percentage)}%`;
        }
        
        // 更新剩余目标 (nutrition-monitoring-system.html 格式)
        const remainingElement = document.getElementById(`${mealType}-remaining`);
        if (remainingElement) {
            const remaining = Math.max(0, target.min - nutrition.calories);
            const remainingMax = Math.max(0, target.max - nutrition.calories);
            if (remaining > 0) {
                remainingElement.textContent = `${Math.round(remaining)}-${Math.round(remainingMax)}`;
            } else {
                remainingElement.textContent = '已达标';
            }
        }
    }

    updateTotalOverview() {
        // 更新全天总览面板中的各餐次数据
        ['breakfast', 'lunch', 'dinner'].forEach(meal => {
            const nutrition = this.calculateMealNutrition(meal);
            const element = document.getElementById(`total-${meal}`);
            if (element) {
                element.textContent = `${Math.round(nutrition.calories)} kcal`;
            }
        });
        
        // 更新全天总计
        const totalCalories = ['breakfast', 'lunch', 'dinner'].reduce((sum, meal) => {
            const nutrition = this.calculateMealNutrition(meal);
            return sum + nutrition.calories;
        }, 0);
        
        const totalElement = document.getElementById('total-all');
        if (totalElement) {
            totalElement.textContent = `${Math.round(totalCalories)} kcal`;
        }
        
        // 更新全天总览进度条
        const totalProgressFill = document.getElementById('total-progress');
        if (totalProgressFill) {
            const percentage = Math.min((totalCalories / this.dailyCalorieRange.max) * 100, 100);
            totalProgressFill.style.width = `${percentage}%`;
            
            // 根据摄入情况调整进度条颜色
            totalProgressFill.className = 'meal-progress-fill';
            if (totalCalories < this.dailyCalorieRange.min) {
                totalProgressFill.classList.add('warning'); // 摄入不足
            } else if (totalCalories <= this.dailyCalorieRange.max) {
                totalProgressFill.classList.add('safe'); // 摄入适宜
            } else {
                totalProgressFill.classList.add('danger'); // 摄入过量
            }
        }
        
        // 更新全天总览统计信息
        const totalCurrentElement = document.getElementById('total-current');
        if (totalCurrentElement) {
            totalCurrentElement.textContent = `${Math.round(totalCalories)} kcal`;
        }
        
        const totalPercentElement = document.getElementById('total-percent');
        if (totalPercentElement) {
            const percentage = (totalCalories / this.dailyCalorieRange.max) * 100;
            totalPercentElement.textContent = `${percentage.toFixed(1)}%`;
        }
    }

    updateDailyTotal() {
        // 计算全天总摄入（累计所有餐次：早餐、午餐、晚餐）
        const totalNutrition = this.calculateAllMealsNutrition();
        
        // 注意：全天总摄入显示模块已被移除
        
        // 更新营养成分显示（显示所有餐次累计数据）
        this.updateNutritionChart();
        this.updateNutritionBars(totalNutrition);
        
        // 同步更新每餐的进度条数据
        this.updateAllMealProgress();
        
        // 如果存在营养监控系统，同步更新其数据
        if (typeof window.nutritionSystem !== 'undefined' && window.nutritionSystem.updateTotalDisplay) {
            // 同步mealRecords数据到营养监控系统
            window.nutritionSystem.mealRecords = this.mealRecords;
            window.nutritionSystem.updateTotalDisplay();
        }
    }
    
    updateAllMealProgress() {
        // 更新所有餐次的进度条
        ['breakfast', 'lunch', 'dinner'].forEach(mealType => {
            this.updateMealProgress(mealType);
        });
    }
}

// 保存餐食计划
function saveMealPlan() {
    if (app.cart.length === 0) {
        alert('请先选择菜品');
        return;
    }

    const mealPlan = {
        dishes: app.cart,
        totalPrice: app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
        totalNutrition: app.calculateTotalNutrition(),
        timestamp: new Date().toISOString()
    };

    localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
    alert('餐食计划已保存！');
}

// 分享餐食计划
function shareMealPlan() {
    if (app.cart.length === 0) {
        alert('请先选择菜品');
        return;
    }

    const dishNames = app.cart.map(item => `${item.name} x${item.quantity}`).join('、');
    const totalPrice = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const totalCalories = Math.round(app.calculateTotalNutrition().calories);

    const shareText = `我的营养餐食计划：${dishNames}。总价：¥${totalPrice.toFixed(1)}，总热量：${totalCalories}卡。来自智能营养食堂！`;

    if (navigator.share) {
        navigator.share({
            title: '我的营养餐食计划',
            text: shareText
        });
    } else {
        navigator.clipboard.writeText(shareText).then(() => {
            alert('分享内容已复制到剪贴板！');
        });
    }
}

// 初始化应用
// 导出营养分析报告功能 - 自动转换为饼图
// 生成营养分析报告
function generateNutritionAnalysis(nutrition) {
    let analysis = '';
    let recommendations = [];
    let warnings = [];
    let positives = [];
    
    // 热量分析
    const calorieRatio = nutrition.calories / 2000;
    if (calorieRatio < 0.8) {
        warnings.push('热量摄入不足，可能影响基础代谢和日常活动');
        recommendations.push('增加主食和健康脂肪的摄入');
    } else if (calorieRatio > 1.2) {
        warnings.push('热量摄入过多，可能导致体重增加');
        recommendations.push('适当减少高热量食物，增加运动量');
    } else {
        positives.push('热量摄入适中，符合日常需求');
    }
    
    // 蛋白质分析
    const proteinRatio = nutrition.protein / 55;
    if (proteinRatio < 0.8) {
        warnings.push('蛋白质摄入不足，可能影响肌肉维护和免疫功能');
        recommendations.push('增加瘦肉、鱼类、豆类等优质蛋白质');
    } else if (proteinRatio > 1.5) {
        warnings.push('蛋白质摄入过多，可能增加肾脏负担');
        recommendations.push('适当减少蛋白质摄入，保持均衡');
    } else {
        positives.push('蛋白质摄入充足，有利于身体健康');
    }
    
    // 碳水化合物分析
    const carbRatio = nutrition.carbs / 275;
    if (carbRatio < 0.7) {
        warnings.push('碳水化合物摄入不足，可能影响大脑功能和体力');
        recommendations.push('适当增加全谷物、薯类等复合碳水化合物');
    } else if (carbRatio > 1.3) {
        warnings.push('碳水化合物摄入过多，可能导致血糖波动');
        recommendations.push('减少精制糖和简单碳水化合物的摄入');
    } else {
        positives.push('碳水化合物摄入合理，能提供稳定能量');
    }
    
    // 脂肪分析
    const fatRatio = nutrition.fat.total / 61;
    if (fatRatio < 0.6) {
        warnings.push('脂肪摄入不足，可能影响脂溶性维生素吸收');
        recommendations.push('适当增加坚果、橄榄油等健康脂肪');
    } else if (fatRatio > 1.3) {
        warnings.push('脂肪摄入过多，可能增加心血管疾病风险');
        recommendations.push('减少油炸食品，选择蒸煮烹饪方式');
    } else {
        positives.push('脂肪摄入适量，有助于营养平衡');
    }
    
    // 水分分析
    const waterRatio = nutrition.water / 1750;
    if (waterRatio < 0.8) {
        warnings.push('水分摄入不足，可能影响新陈代谢');
        recommendations.push('增加饮水量，多吃含水量高的食物');
    } else {
        positives.push('水分摄入充足，有利于身体代谢');
    }
    
    // 维生素和矿物质分析
    const vitaminRatio = nutrition.vitamins / 100;
    const mineralRatio = nutrition.minerals / 1000;
    
    if (vitaminRatio < 0.8) {
        warnings.push('维生素摄入不足，可能影响免疫力');
        recommendations.push('增加新鲜蔬菜和水果的摄入');
    } else {
        positives.push('维生素摄入充足，有助于增强免疫力');
    }
    
    if (mineralRatio < 0.8) {
        warnings.push('矿物质摄入不足，可能影响骨骼健康');
        recommendations.push('增加奶制品、绿叶蔬菜等富含矿物质的食物');
    } else {
        positives.push('矿物质摄入充足，有利于骨骼健康');
    }
    
    // 生成分析报告
    analysis += '<div style="margin-bottom: 12px;">';
    analysis += '<div style="font-weight: 600; color: #27ae60; margin-bottom: 6px;">✅ 营养优势：</div>';
    if (positives.length > 0) {
        positives.forEach(positive => {
            analysis += `<div style="margin-left: 10px; margin-bottom: 3px; font-size: 14px;">• ${positive}</div>`;
        });
    } else {
        analysis += '<div style="margin-left: 10px; color: #7f8c8d; font-size: 14px;">暂无明显营养优势</div>';
    }
    analysis += '</div>';
    
    if (warnings.length > 0) {
        analysis += '<div style="margin-bottom: 12px;">';
        analysis += '<div style="font-weight: 600; color: #e74c3c; margin-bottom: 6px;">⚠️ 需要注意：</div>';
        warnings.forEach(warning => {
            analysis += `<div style="margin-left: 10px; margin-bottom: 3px; font-size: 14px;">• ${warning}</div>`;
        });
        analysis += '</div>';
    }
    
    if (recommendations.length > 0) {
        analysis += '<div style="margin-bottom: 8px;">';
        analysis += '<div style="font-weight: 600; color: #3498db; margin-bottom: 6px;">💡 改善建议：</div>';
        recommendations.forEach(recommendation => {
            analysis += `<div style="margin-left: 10px; margin-bottom: 3px; font-size: 14px;">• ${recommendation}</div>`;
        });
        analysis += '</div>';
    }
    
    return analysis;
}

// 营养评价模块
function generateNutritionEvaluation(nutrition) {
    // 六类食物推荐量标准（每日）
    const dailyRecommendations = {
        dairy: { min: 360, max: 480, unit: 'ml' },      // 乳制品
        fruit: { min: 300, max: 500, unit: 'g' },       // 水果
        vegetable: { min: 200, max: 400, unit: 'g' },   // 蔬菜
        grain: { min: 300, max: 800, unit: 'g' },       // 全谷杂粮
        protein: { min: 150, max: 400, unit: 'g' },     // 豆鱼蛋肉
        nuts: { min: 15, max: 35, unit: 'g' }           // 坚果
    };

    // 三餐配比：早:中:晚 = 0.3:0.4:0.3
    const mealRatios = {
        breakfast: 0.3,
        lunch: 0.4,
        dinner: 0.3
    };

    // 计算六类食物摄入量
    function calculateFoodCategoryIntake() {
        const intake = {
            dairy: 0,
            fruit: 0,
            vegetable: 0,
            grain: 0,
            protein: 0,
            nuts: 0
        };

        // 获取所有三餐的菜品
        const allMealsItems = app.getAllMealsItems();
        
        // 遍历所有菜品，根据名称和标签推断食物类别
        allMealsItems.forEach(item => {
            // 先在dishesData中查找
            let dish = dishesData.find(d => d.id === item.id);
            
            // 如果在dishesData中没找到，再在ingredientsData中查找
            if (!dish) {
                dish = ingredientsData.find(d => d.id === item.id);
            }
            
            if (!dish) return;

            // 根据菜品名称和标签推断食物类别
            const categoryMapping = identifyFoodCategory(dish);
            
            // 根据分量计算实际摄入量
            const portionWeight = extractPortionWeight(dish.portion);
            const quantity = item.quantity || 1;
            const actualIntake = portionWeight * quantity;

            // 累加到对应类别
            Object.keys(categoryMapping).forEach(category => {
                if (categoryMapping[category] > 0) {
                    intake[category] += actualIntake * categoryMapping[category];
                }
            });
        });

        return intake;
    }

    // 识别食物类别
    function identifyFoodCategory(dish) {
        const mapping = {
            dairy: 0,
            fruit: 0,
            vegetable: 0,
            grain: 0,
            protein: 0,
            nuts: 0
        };

        const name = dish.name.toLowerCase();
        const tags = dish.tags || [];

        // 乳制品识别
        if (name.includes('奶') || name.includes('酸奶') || name.includes('牛奶') || 
            name.includes('奶酪') || name.includes('黄油') || tags.includes('dairy')) {
            mapping.dairy = 1.0;
        }

        // 水果识别
        if (name.includes('果') || name.includes('苹果') || name.includes('香蕉') || 
            name.includes('橙') || name.includes('葡萄') || name.includes('草莓') ||
            name.includes('蓝莓') || name.includes('猕猴桃') || name.includes('菠萝') ||
            name.includes('芒果') || tags.includes('fruit')) {
            mapping.fruit = 1.0;
        }

        // 蔬菜识别
        if (name.includes('菜') || name.includes('萝卜') || name.includes('白菜') ||
            name.includes('青菜') || name.includes('菠菜') || name.includes('韭菜') ||
            name.includes('茄子') || name.includes('黄瓜') || name.includes('西红柿') ||
            name.includes('青椒') || name.includes('洋葱') || name.includes('胡萝卜') ||
            name.includes('花菜') || name.includes('西兰花') || name.includes('冬瓜') ||
            name.includes('丝瓜') || name.includes('竹笋') || name.includes('蘑菇') ||
            tags.includes('vegetable')) {
            mapping.vegetable = 1.0;
        }

        // 全谷杂粮识别
        if (name.includes('米饭') || name.includes('粥') || name.includes('面') ||
            name.includes('饭团') || name.includes('土豆') || name.includes('南瓜') ||
            name.includes('玉米') || name.includes('燕麦') || name.includes('小米') ||
            name.includes('糙米') || name.includes('全麦') || dish.category === 'staple') {
            mapping.grain = 1.0;
        }

        // 豆鱼蛋肉识别
        if (name.includes('肉') || name.includes('鸡') || name.includes('鱼') ||
            name.includes('虾') || name.includes('蟹') || name.includes('蛋') ||
            name.includes('豆腐') || name.includes('豆') || name.includes('排骨') ||
            name.includes('牛') || name.includes('猪') || name.includes('鸭') ||
            tags.includes('high-protein') || dish.category === 'main') {
            mapping.protein = 1.0;
        }

        // 坚果识别
        if (name.includes('花生') || name.includes('核桃') || name.includes('杏仁') ||
            name.includes('腰果') || name.includes('松子') || name.includes('瓜子') ||
            name.includes('芝麻') || tags.includes('nuts') || tags.includes('nuts-seeds')) {
            mapping.nuts = 1.0;
        }

        return mapping;
    }

    // 提取分量重量（克或毫升）
    function extractPortionWeight(portion) {
        const match = portion.match(/(\d+)(g|ml)/);
        return match ? parseInt(match[1]) : 100; // 默认100g
    }

    // 评价等级判定
    function evaluateIntake(actual, min, max) {
        const lowerThreshold = min * 0.8;
        const upperThreshold = max * 1.2;

        if (actual < lowerThreshold) {
            return { level: 'severely_insufficient', color: '#e74c3c', text: '明显不足' };
        } else if (actual < min) {
            return { level: 'slightly_insufficient', color: '#f39c12', text: '偏少' };
        } else if (actual <= max) {
            return { level: 'adequate', color: '#27ae60', text: '达标' };
        } else if (actual <= upperThreshold) {
            return { level: 'slightly_excessive', color: '#f39c12', text: '偏多' };
        } else {
            return { level: 'severely_excessive', color: '#e74c3c', text: '明显超量' };
        }
    }

    // 生成建议文案
    function generateSuggestions(evaluations) {
        const suggestions = [];
        
        if (evaluations.dairy.level.includes('insufficient')) {
            suggestions.push('建议在早餐/加餐补200-240ml奶');
        }
        if (evaluations.fruit.level.includes('insufficient')) {
            suggestions.push('加1个拳头大小水果（约150g）即可');
        }
        if (evaluations.vegetable.level.includes('insufficient')) {
            suggestions.push('加深绿色蔬菜80-120g');
        }
        if (evaluations.grain.level.includes('excessive')) {
            suggestions.push('减饭30-50g或半份换全谷');
        }
        if (evaluations.protein.level.includes('insufficient')) {
            suggestions.push('加蛋/豆腐/鱼虾50-80g');
        }
        if (evaluations.nuts.level.includes('insufficient')) {
            suggestions.push('加入坚果一茶匙8-10g即可');
        }

        return suggestions.slice(0, 4); // 最多4条
    }

    // 宏量营养素分析
    function analyzeMacronutrients(nutrition) {
        const totalCalories = nutrition.calories;
        const carbCalories = nutrition.carbs * 4;
        const proteinCalories = nutrition.protein * 4;
        const fatCalories = nutrition.fat.total * 9;

        const carbPercent = (carbCalories / totalCalories) * 100;
        const proteinPercent = (proteinCalories / totalCalories) * 100;
        const fatPercent = (fatCalories / totalCalories) * 100;

        const warnings = [];
        if (fatPercent > 35) {
            warnings.push(`脂肪供能比过高(${fatPercent.toFixed(1)}%)，建议控制在35%以下`);
        }
        if (proteinPercent < 15) {
            warnings.push(`蛋白质供能比偏低(${proteinPercent.toFixed(1)}%)，建议提高到15%以上`);
        }
        if (carbPercent < 45) {
            warnings.push(`碳水化合物供能比偏低(${carbPercent.toFixed(1)}%)，建议提高到45%以上`);
        }

        return {
            carbPercent: carbPercent.toFixed(1),
            proteinPercent: proteinPercent.toFixed(1),
            fatPercent: fatPercent.toFixed(1),
            warnings
        };
    }

    // 执行评价
    const intake = calculateFoodCategoryIntake();
    const evaluations = {};
    
    Object.keys(dailyRecommendations).forEach(category => {
        const rec = dailyRecommendations[category];
        evaluations[category] = {
            actual: intake[category],
            ...evaluateIntake(intake[category], rec.min, rec.max),
            unit: rec.unit,
            range: `${rec.min}-${rec.max}${rec.unit}`
        };
    });

    const suggestions = generateSuggestions(evaluations);
    const macroAnalysis = analyzeMacronutrients(nutrition);

    // 生成HTML
    let html = '<div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 8px;">';
    html += '<h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">营养评价</h3>';
    
    // 六类食物评价
    html += '<div style="margin-bottom: 15px;">';
    html += '<h4 style="margin: 0 0 10px 0; color: #34495e; font-size: 14px;">六类食物摄入评价</h4>';
    
    const categoryNames = {
        dairy: '乳制品',
        fruit: '水果',
        vegetable: '蔬菜',
        grain: '全谷杂粮',
        protein: '豆鱼蛋肉',
        nuts: '坚果'
    };

    Object.keys(evaluations).forEach(category => {
        const eval = evaluations[category];
        html += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 6px 10px; background: rgba(255,255,255,0.7); border-radius: 4px;">`;
        html += `<span style="font-weight: 500;">${categoryNames[category]}</span>`;
        html += `<span style="color: ${eval.color}; font-weight: 600;">${eval.actual.toFixed(0)}${eval.unit} (${eval.text})</span>`;
        html += `</div>`;
    });
    html += '</div>';

    // 宏量营养素分析
    if (macroAnalysis.warnings.length > 0) {
        html += '<div style="margin-bottom: 15px;">';
        html += '<h4 style="margin: 0 0 10px 0; color: #34495e; font-size: 14px;">宏量营养素分析</h4>';
        html += `<div style="margin-bottom: 8px; font-size: 12px; color: #7f8c8d;">碳水${macroAnalysis.carbPercent}% | 蛋白${macroAnalysis.proteinPercent}% | 脂肪${macroAnalysis.fatPercent}%</div>`;
        macroAnalysis.warnings.forEach(warning => {
            html += `<div style="color: #e74c3c; font-size: 12px; margin-bottom: 4px;">⚠️ ${warning}</div>`;
        });
        html += '</div>';
    }

    // 改善建议
    if (suggestions.length > 0) {
        html += '<div>';
        html += '<h4 style="margin: 0 0 10px 0; color: #34495e; font-size: 14px;">改善建议</h4>';
        suggestions.forEach(suggestion => {
            html += `<div style="color: #3498db; font-size: 12px; margin-bottom: 4px;">💡 ${suggestion}</div>`;
        });
        html += '</div>';
    }

    html += '</div>';
    return html;
}

function exportNutritionChart(format = 'png') {
    console.log('=== 导出营养分析报告开始 ===');
    console.log('exportNutritionChart函数被调用，格式:', format);
    
    // 检查html2canvas库是否加载
    console.log('检查html2canvas库:', typeof html2canvas);
    if (typeof html2canvas === 'undefined') {
        console.error('html2canvas库未加载！');
        alert('导出功能需要html2canvas库，请检查网络连接或刷新页面重试。');
        return;
    }
    console.log('html2canvas库已正确加载');
    
    try {
        console.log('进入try块');
        
        // 检查是否有应用实例
        if (!window.app) {
            console.error('window.app未定义');
            alert('系统初始化中，请稍后再试...');
            return;
        }
        
        console.log('window.app存在，购物车内容:', window.app.cart);
        console.log('购物车长度:', window.app.cart.length);
        console.log('购物车详细数据:', JSON.stringify(window.app.cart, null, 2));
        console.log('餐次记录:', window.app.mealRecords);
        console.log('开始导出流程...');
        
        // 检查是否有任何菜品被选择（包括餐次记录和全局购物车）
        const hasAnyItems = window.app.cart.length > 0 || 
                           Object.values(window.app.mealRecords).some(meal => meal.length > 0);
        const isCartEmpty = !hasAnyItems;
        console.log('是否有任何菜品:', hasAnyItems);
        console.log('购物车是否为空:', isCartEmpty);
        
        // 创建导出容器 - 修复定位问题
        const exportContainer = document.createElement('div');
        exportContainer.style.cssText = `
            background: #ffffff;
            padding: 50px;
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            width: 1400px;
            min-height: 900px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            visibility: hidden;
            opacity: 0;
            display: block;
            font-size: 22px;
            line-height: 1.8;
            color: #222;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            letter-spacing: 0.5px;
            box-sizing: border-box;
            pointer-events: none;
        `;
        console.log('导出容器已创建');
        
        console.log('跳过标题和预算信息');
        
        // 添加报告标题和基本信息
        const reportHeader = document.createElement('div');
        reportHeader.style.cssText = `
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            border-bottom: 3px solid #007bff;
        `;
        reportHeader.innerHTML = `
            <h1 style="color: #007bff; margin: 0 0 15px 0; font-size: 36px; font-weight: bold;">营养分析报告</h1>
            <p style="color: #666; margin: 0; font-size: 18px;">生成时间: ${new Date().toLocaleString('zh-CN')}</p>
        `;
        exportContainer.appendChild(reportHeader);
        
        // 如果购物车为空，显示完整的空状态报告
        if (isCartEmpty) {
            console.log('购物车为空，生成空状态营养报告');
            const emptyStateReport = document.createElement('div');
            emptyStateReport.style.cssText = `
                padding: 40px;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-radius: 15px;
                margin: 20px 0;
                border: 2px dashed #dee2e6;
            `;
            emptyStateReport.innerHTML = `
                <div style="text-align: center; margin-bottom: 40px;">
                    <div style="font-size: 80px; margin-bottom: 20px;">🍽️</div>
                    <h2 style="color: #495057; margin: 0 0 15px 0; font-size: 28px;">暂无菜品数据</h2>
                    <p style="color: #6c757d; margin: 0 0 30px 0; font-size: 16px; line-height: 1.6;">
                        您还没有添加任何菜品到购物车。<br>
                        请先选择一些菜品，然后再生成营养分析报告。
                    </p>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #007bff; margin: 0 0 20px 0; font-size: 22px;">📊 营养摄入建议</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                            <h4 style="color: #28a745; margin: 0 0 10px 0; font-size: 18px;">🔥 每日热量</h4>
                            <p style="margin: 0; color: #495057; font-size: 16px;">成人建议: 1800-2400 kcal</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545;">
                            <h4 style="color: #dc3545; margin: 0 0 10px 0; font-size: 18px;">🥩 蛋白质</h4>
                            <p style="margin: 0; color: #495057; font-size: 16px;">建议: 50-80g/天</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <h4 style="color: #e67e22; margin: 0 0 10px 0; font-size: 18px;">🍞 碳水化合物</h4>
                            <p style="margin: 0; color: #495057; font-size: 16px;">建议: 225-325g/天</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <h4 style="color: #17a2b8; margin: 0 0 10px 0; font-size: 18px;">🥑 脂肪</h4>
                            <p style="margin: 0; color: #495057; font-size: 16px;">建议: 44-78g/天</p>
                        </div>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border: 1px solid #bbdefb;">
                        <h4 style="color: #1976d2; margin: 0 0 15px 0; font-size: 18px;">💡 健康饮食小贴士</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #495057; line-height: 1.8;">
                            <li>保持营养均衡，合理搭配主食、蛋白质和蔬菜</li>
                            <li>控制油脂摄入，选择健康的烹饪方式</li>
                            <li>多吃新鲜蔬菜水果，补充维生素和纤维</li>
                            <li>适量饮水，保持身体水分平衡</li>
                            <li>规律用餐，避免暴饮暴食</li>
                        </ul>
                    </div>
                </div>
            `;
            exportContainer.appendChild(emptyStateReport);
        } else {
            console.log('购物车有内容，开始计算营养数据');
            // 计算营养数据 - 包含所有菜品（餐次记录 + 全局购物车 + 精品自助小厨房）
            const nutrition = window.app.calculateAllMealsNutrition();
            console.log('营养数据计算结果:', nutrition);
            
            // 添加营养分析内容
            const nutritionContent = document.createElement('div');
            const nutritionHTML = window.app.generateNutritionChartHTML(nutrition);
            console.log('生成的营养HTML长度:', nutritionHTML.length);
            console.log('生成的营养HTML前500字符:', nutritionHTML.substring(0, 500));
            
            nutritionContent.innerHTML = nutritionHTML;
            exportContainer.appendChild(nutritionContent);
            console.log('营养内容已添加到导出容器');
        }
        
        // 将容器添加到页面
        document.body.appendChild(exportContainer);
        console.log('导出容器已添加到页面');
        
        // 等待DOM更新后再检查尺寸
        setTimeout(() => {
            console.log('=== 导出容器详细信息 ===');
            console.log('导出容器的实际高度:', exportContainer.offsetHeight);
            console.log('导出容器的实际宽度:', exportContainer.offsetWidth);
            console.log('导出容器的innerHTML长度:', exportContainer.innerHTML.length);
            console.log('导出容器的scrollHeight:', exportContainer.scrollHeight);
            console.log('导出容器的scrollWidth:', exportContainer.scrollWidth);
            console.log('导出容器的样式:', window.getComputedStyle(exportContainer));
            console.log('导出容器的位置:', exportContainer.getBoundingClientRect());
            console.log('导出容器的子元素数量:', exportContainer.children.length);
            
            if (exportContainer.children.length > 0) {
                console.log('第一个子元素:', exportContainer.children[0]);
                console.log('第一个子元素的尺寸:', exportContainer.children[0].offsetWidth, 'x', exportContainer.children[0].offsetHeight);
            }
            
            // 直接导出，不创建图表
            performHtml2CanvasExport();
        }, 100);
         
         // html2canvas导出函数
         function performHtml2CanvasExport() {
             console.log('开始使用html2canvas渲染...');
             console.log('导出容器尺寸:', exportContainer.offsetWidth, 'x', exportContainer.offsetHeight);
             console.log('导出容器内容长度:', exportContainer.innerHTML.length);
             console.log('导出容器样式:', exportContainer.style.cssText);
             
             // 检查容器是否在DOM中
             console.log('容器是否在DOM中:', document.body.contains(exportContainer));
             
             // 临时显示容器以确保html2canvas能正确渲染
             const originalVisibility = exportContainer.style.visibility;
             const originalOpacity = exportContainer.style.opacity;
             const originalDisplay = exportContainer.style.display;
             const originalPosition = exportContainer.style.position;
             const originalTop = exportContainer.style.top;
             const originalLeft = exportContainer.style.left;
             const originalZIndex = exportContainer.style.zIndex;
             
             // 设置容器为可见但不影响页面布局
             exportContainer.style.visibility = 'visible';
             exportContainer.style.opacity = '1';
             exportContainer.style.display = 'block';
             exportContainer.style.position = 'absolute';
             exportContainer.style.top = '0px';
             exportContainer.style.left = '0px';
             exportContainer.style.zIndex = '9999';
             
             console.log('临时显示容器后的尺寸:', exportContainer.offsetWidth, 'x', exportContainer.offsetHeight);
             
             // 优化的html2canvas配置 - 高清文字渲染
             const html2canvasOptions = {
                backgroundColor: '#ffffff',
                scale: 2,  // 降低到2倍分辨率提高兼容性
                useCORS: true,
                allowTaint: true,
                logging: true,  // 开启日志便于调试
                width: exportContainer.offsetWidth,
                height: exportContainer.offsetHeight,
                pixelRatio: 1,  // 固定为1提高兼容性
                foreignObjectRendering: false,  // 关闭以提高兼容性
                removeContainer: false,  // 不自动移除容器
                imageTimeout: 30000,  // 增加超时时间
                scrollX: 0,
                scrollY: 0,
                windowWidth: exportContainer.offsetWidth,
                windowHeight: exportContainer.offsetHeight,
                onclone: function(clonedDoc) {
                    console.log('html2canvas克隆文档完成');
                    const clonedContainer = clonedDoc.body.querySelector('div');
                    if (clonedContainer) {
                        console.log('克隆容器找到，尺寸:', clonedContainer.offsetWidth, 'x', clonedContainer.offsetHeight);
                        // 确保克隆容器可见
                        clonedContainer.style.position = 'static';
                        clonedContainer.style.visibility = 'visible';
                        clonedContainer.style.display = 'block';
                        clonedContainer.style.opacity = '1';
                        
                        // 优化文字渲染
                        clonedContainer.style.webkitFontSmoothing = 'antialiased';
                        clonedContainer.style.mozOsxFontSmoothing = 'grayscale';
                        clonedContainer.style.textRendering = 'optimizeLegibility';
                        
                        // 优化所有子元素
                        const allElements = clonedContainer.querySelectorAll('*');
                        allElements.forEach(el => {
                            el.style.webkitFontSmoothing = 'antialiased';
                            el.style.mozOsxFontSmoothing = 'grayscale';
                            el.style.textRendering = 'optimizeLegibility';
                        });
                        
                        console.log('克隆容器优化完成');
                    } else {
                        console.error('未找到克隆容器！');
                    }
                }
             };
            
            console.log('html2canvas配置:', html2canvasOptions);
            console.log('开始调用html2canvas...');
            
             html2canvas(exportContainer, html2canvasOptions).then(canvas => {
                console.log('html2canvas渲染成功');
                console.log('Canvas尺寸:', canvas.width, 'x', canvas.height);
                
                // 检查Canvas是否为空 - 修复检测逻辑
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                let isEmpty = true;
                
                // 简化检测：只要有任何非透明的像素就认为不是空白
                for (let i = 3; i < data.length; i += 4) {
                    if (data[i] > 0) { // 检查alpha通道，大于0表示有内容
                        isEmpty = false;
                        break;
                    }
                }
                console.log('Canvas是否为空白:', isEmpty);
                console.log('Canvas尺寸检查:', canvas.width, 'x', canvas.height);
                
                if (isEmpty) {
                    console.warn('生成的Canvas是空白的！');
                    console.log('导出容器HTML内容:', exportContainer.innerHTML.substring(0, 1000));
                    console.log('导出容器是否可见:', exportContainer.offsetWidth > 0 && exportContainer.offsetHeight > 0);
                    alert('导出的图片是空白的，请检查内容是否正确显示');
                    
                    // 恢复容器原始样式
                    exportContainer.style.visibility = originalVisibility;
                    exportContainer.style.opacity = originalOpacity;
                    exportContainer.style.display = originalDisplay;
                    exportContainer.style.position = originalPosition;
                    exportContainer.style.top = originalTop;
                    exportContainer.style.left = originalLeft;
                    exportContainer.style.zIndex = originalZIndex;
                    
                    document.body.removeChild(exportContainer);
                    return;
                }
                
                // 创建下载链接 - 优化为高清版本
                const link = document.createElement('a');
                const timestamp = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-') + '_' + 
                                new Date().toLocaleTimeString('zh-CN').replace(/:/g, '-');
                link.download = `营养分析报告_高清版_${timestamp}.png`;
                
                // 使用最高质量PNG格式输出
                const dataURL = canvas.toDataURL('image/png', 1.0);
                link.href = dataURL;
                
                // 检查生成的图片数据
                console.log('生成的高清图片数据URL长度:', dataURL.length);
                console.log('图片数据URL前100字符:', dataURL.substring(0, 100));
                console.log('Canvas最终尺寸:', canvas.width, 'x', canvas.height, '像素');
                
                link.click();
                
                // 恢复容器原始样式
                exportContainer.style.visibility = originalVisibility;
                exportContainer.style.opacity = originalOpacity;
                exportContainer.style.display = originalDisplay;
                exportContainer.style.position = originalPosition;
                exportContainer.style.top = originalTop;
                exportContainer.style.left = originalLeft;
                exportContainer.style.zIndex = originalZIndex;
                
                // 清理
                document.body.removeChild(exportContainer);
                
                console.log('导出成功完成');
                alert('营养分析报告导出成功！');
            }).catch(error => {
                console.error('html2canvas导出失败:', error);
                console.error('错误详情:', error.message);
                console.error('错误堆栈:', error.stack);
                
                // 恢复容器原始样式
                exportContainer.style.visibility = originalVisibility;
                exportContainer.style.opacity = originalOpacity;
                exportContainer.style.display = originalDisplay;
                exportContainer.style.position = originalPosition;
                exportContainer.style.top = originalTop;
                exportContainer.style.left = originalLeft;
                exportContainer.style.zIndex = originalZIndex;
                
                document.body.removeChild(exportContainer);
                alert('导出图片失败: ' + error.message);
            });
         }
        
    } catch (error) {
        console.error('导出函数执行出错:', error);
        console.error('错误详情:', error.message);
        console.error('错误堆栈:', error.stack);
        alert('导出功能出现错误: ' + error.message);
        return;
    }
}


function showExportOptions() {
    console.log('=== showExportOptions函数被调用 ===');
    
    const exportOptions = document.getElementById('export-options');
    
    if (!exportOptions) {
        console.error('找不到export-options元素');
        alert('找不到导出选项容器');
        return;
    }
    
    console.log('找到exportOptions元素:', exportOptions);
    console.log('当前style.display:', exportOptions.style.display);
    
    // 极简逻辑：直接切换显示状态
    if (exportOptions.style.display === 'none' || exportOptions.style.display === '') {
        console.log('显示导出选项');
        exportOptions.style.display = 'block';
        alert('导出选项已显示');
    } else {
        console.log('隐藏导出选项');
        exportOptions.style.display = 'none';
        alert('导出选项已隐藏');
    }
}

const app = new NutritionCafeteria();

// 初始化应用程序
app.init();

// 将应用实例暴露到全局作用域
window.app = app;
window.saveMealPlan = saveMealPlan;
window.shareMealPlan = shareMealPlan;
window.showExportOptions = showExportOptions;
window.exportNutritionChart = exportNutritionChart;

// 简化的导出测试函数
window.testSimpleExport = function() {
    console.log('开始简化导出测试');
    
    // 创建一个简单的测试容器
    const testDiv = document.createElement('div');
    testDiv.style.cssText = `
        width: 400px;
        height: 300px;
        background: white;
        padding: 20px;
        border: 1px solid #ccc;
        position: absolute;
        top: 0;
        left: 0;
        font-family: Arial, sans-serif;
    `;
    testDiv.innerHTML = `
        <h2 style="color: #333; margin: 0 0 20px 0;">测试导出</h2>
        <p style="color: #666; margin: 10px 0;">这是一个简单的测试内容</p>
        <div style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
            测试区域
        </div>
    `;
    
    document.body.appendChild(testDiv);
    
    console.log('测试容器已创建，尺寸:', testDiv.offsetWidth, 'x', testDiv.offsetHeight);
    
    // 使用html2canvas导出
    html2canvas(testDiv, {
        backgroundColor: '#ffffff',
        scale: 1,
        logging: true,
        useCORS: true,
        allowTaint: true
    }).then(canvas => {
        console.log('简化测试导出成功，画布尺寸:', canvas.width, 'x', canvas.height);
        
        // 检查画布是否为空
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const isEmpty = imageData.data.every(pixel => pixel === 0 || pixel === 255);
        
        console.log('画布是否为空:', isEmpty);
        
        if (!isEmpty) {
            // 下载图片
            const link = document.createElement('a');
            link.download = 'test-export.png';
            link.href = canvas.toDataURL();
            link.click();
            console.log('简化测试导出完成');
        } else {
            console.error('简化测试生成的画布为空！');
        }
        
        // 清理测试容器
        document.body.removeChild(testDiv);
    }).catch(error => {
        console.error('简化测试导出失败:', error);
        document.body.removeChild(testDiv);
    });
};

// 确保导出按钮文字显示
document.addEventListener('DOMContentLoaded', function() {
    const exportBtn = document.querySelector('.export-btn.primary');
    if (exportBtn) {
        exportBtn.textContent = '📊 导出营养分析报告';
        exportBtn.style.fontSize = '1rem';
        exportBtn.style.fontWeight = 'bold';
        exportBtn.style.color = 'white';
        exportBtn.style.display = 'flex';
        exportBtn.style.alignItems = 'center';
        exportBtn.style.justifyContent = 'center';
        exportBtn.style.gap = '8px';
        exportBtn.style.whiteSpace = 'nowrap';
        exportBtn.style.overflow = 'visible';
        exportBtn.style.textOverflow = 'clip';
        exportBtn.style.minWidth = '200px';
        exportBtn.style.padding = '12px 16px';
    }

});
    </script>
</body>
</html>